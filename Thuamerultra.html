<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>THUAMER ULTRA · MMORPG Hiper Complejo V2.0</title>
<style>
  /* Reset y fondo oscuro futurista */
  body {
    margin: 0;
    overflow: hidden;
    background: #0a001a;
    font-family: 'Share Tech Mono', monospace;
    color: #0ff;
    font-size: 12px;
  }
  canvas { display: block; image-rendering: pixelated; }
  
  /* HUD principal */
  #ui {
    position: fixed;
    top: 10px;
    left: 10px;
    background: rgba(0, 0, 20, 0.85);
    padding: 10px 14px;
    border: 2px solid #0ff;
    border-radius: 6px;
    font-size: 12px;
    z-index: 20;
    box-shadow: 0 0 12px #0ff;
  }
  
  /* Chat futurista */
  #chat {
    position: fixed;
    bottom: 10px;
    left: 10px;
    width: 600px;
    height: 220px;
    background: rgba(0, 0, 0, 0.9);
    border: 2px solid #0ff;
    padding: 8px;
    overflow-y: auto;
    font-size: 11px;
    line-height: 1.3;
    box-shadow: 0 0 15px #0ff;
  }
  #chat span { display: block; animation: fadeIn 0.3s ease; }
  
  /* Minimap */
  #mm {
    position: fixed;
    top: 10px;
    right: 10px;
    width: 200px;
    height: 200px;
    background: rgba(0, 0, 0, 0.95);
    border: 2px solid #0ff;
    box-shadow: 0 0 12px #0ff;
  }
  
  /* Leaderboard */
  #lb {
    position: fixed;
    top: 220px;
    right: 10px;
    width: 200px;
    height: 280px;
    background: rgba(0, 0, 20, 0.9);
    border: 2px solid #0ff;
    padding: 8px;
    overflow-y: auto;
    font-size: 10px;
    box-shadow: 0 0 12px #0ff;
  }

  /* Efecto glow */
  .glow {
    text-shadow: 0 0 6px #0ff, 0 0 12px #0ff, 0 0 18px #0ff;
  }

  @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }

</style>
</head>
<body>
<canvas id="c"></canvas>

<div id="ui">Cargando THUAMER ULTRA V2.0...</div>
<div id="chat">» Bienvenido a THUAMER ULTRA V2.0<br>» Cargando mundo hiper complejo...</div>
<canvas id="mm" width="200" height="200"></canvas>
<div id="lb">
  <b>TOP LVL GLOBAL</b><br>
  <span id="leaderboard">
    1. GodSlayer 999<br>
    2. GrokUltra 950<br>
    3. 0rb1t4lsn4k3r 888<br>
    4. RaidBoss 777<br>
    5. LootKing 666<br>
    6. PvPGod 555<br>
    7. GrindPro 444<br>
    8. QuestMaster 333<br>
    9. CraftLegend 222<br>
    10.Tú? <span id="yourRank">1</span>
  </span>
</div>

<script>
/* ==============================
   MOTOR ECS Y QUADTREE BASE
   ============================== */
const Engine={time:{now:0,dt:0,last:0},run(cb){function loop(t){Engine.time.now=t;Engine.time.dt=Math.min((t-Engine.time.last)/1000,1/60);Engine.time.last=t;cb();requestAnimationFrame(loop);}requestAnimationFrame(loop);}};
const ECS={nextId:1,entities:{},create(comps){const id=this.nextId++;this.entities[id]={...comps};return id;},get(id){return this.entities[id]},destroy(id){delete this.entities[id];},query(filter){return Object.entries(this.entities).filter(([_,e])=>filter(e)).map(([id])=>+id);}};
const CPos=(x,y,r=12)=> ({pos:{x,y,r}}); const CVel=(vx=0,vy=0)=> ({vel:{x:vx,y:vy}}); const CSprite=(color,size=16)=> ({sprite:{color,size}});
const CPlayer=(lvl=1,hp=250,mhp=250,mana=120,mmn=120,str=20,agi=20,int=20,sta=20,inv:[],skills:[],quests:[],target:null,path:[],craft:{mat:{},rec:{}})=> ({player:{lvl,hp,mhp,mana,mmn,str,agi,int,sta,inv,skills,quests,target,path,craft}});
const CMob=(hp,mhp,lvl,col='#f44',type='goblin')=> ({mob:{hp,mhp,lvl,col,type}});
const CNPC=(n,quests)=> ({npc:{n,quests}});
const CItem=(type,val=1)=> ({item:{type,val}});
const CPortal=(toX,toY)=> ({portal:{toX,toY}});
const CProjectile=(dmg,toX,toY)=> ({proj:{dmg,toX,toY,speed:400}});

/* ==============================
   CANVAS Y RENDERER
   ============================== */
const C=document.getElementById('c'),ctx=C.getContext('2d');let W,H;function resize(){W=C.width=innerWidth;H=C.height=innerHeight;ctx.imageSmoothingEnabled=false;}resize();addEventListener('resize',resize);
const Renderer={ctx,cam:{x:0,y:0},clear(){ctx.fillStyle='#000';ctx.fillRect(0,0,W,H);}};

/* ==============================
   MUNDO Y TILES
   ============================== */
const World={size:4096*24,tiles:null,getTile(x,y){const tx=x/24|0,ty=y/24|0;return tx>=0&&tx<4096&&ty>=0&&ty<4096?this.tiles[ty][tx]:13;},isSolid(id){return id>=7;},init(){this.tiles=[];for(let y=0;y<4096;y++){this.tiles[y]=[];for(let x=0;x<4096;x++)this.tiles[y][x]=Math.random()*14|0;}}};World.init();
const tileColors=['#020','#040','#060','#080','#0a0','#220','#330','#440','#550','#660','#480','#240','#120','#000','#111'];

/* ==============================
   QUADTREE PARA ENTIDADES
   ============================== */
const QuadTree=class{constructor(x,y,w,h){this.bounds={x,y,w,h};this.entities=[];this.divided=false;this.children=null;}subdivide(){const hw=this.bounds.w/2,hh=this.bounds.h/2;this.children=[new QuadTree(this.bounds.x,this.bounds.y,hw,hh),new QuadTree(this.bounds.x+hw,this.bounds.y,hw,hh),new QuadTree(this.bounds.x,this.bounds.y+hh,hw,hh),new QuadTree(this.bounds.x+hw,this.bounds.y+hh,hw,hh)];this.divided=true;}insert(e){if(this.children){for(let i=0;i<4;i++)this.children[i].insert(e);}else{this.entities.push(e);if(this.entities.length>4)this.subdivideAndInsert();}}subdivideAndInsert(){for(let e of this.entities)for(let i=0;i<4;i++)this.children[i].insert(e);this.entities=[];}query(rect,cb){if(!this.intersect(rect,this.bounds))return;this.entities.forEach(cb);if(this.divided)this.children?.forEach(c=>c.query(rect,cb));}intersect(r1,r2){return!(r1.x+r1.w<r2.x||r1.x>r2.x+r2.w||r1.y+r1.h<r2.y||r1.y>r2.y+r2.h);}};

let qt=new QuadTree(0,0,World.size,World.size);function updateQT(){qt=new QuadTree(0,0,World.size,World.size);ECS.query(e=>e.pos).forEach(id=>{const p=ECS.get(id).pos;qt.insert({x:p.x-p.r,y:p.y-p.r,w:p.r*2,h:p.r*2,id});});}

/* ==============================
   INPUT
   ============================== */
const Input={keys:{},mouse:{x:0,y:0,btns:0},init(){document.addEventListener('keydown',e=>{const k=e.key.toLowerCase();Input.keys[k]=1;});document.addEventListener('keyup',e=>{Input.keys[e.key.toLowerCase()]=0;});C.addEventListener('mousemove',e=>{Input.mouse.x=e.clientX;Input.mouse.y=e.clientY;});C.addEventListener('mousedown',e=>{Input.mouse.btns|=1<<e.button;});C.addEventListener('mouseup',e=>{Input.mouse.btns&=~(1<<e.button);});}};Input.init();

/* ==============================
   PARTICULAS Y AUDIO
   ============================== */
let particles=[],pPool=[];
const FX={spawn(x,y,color){let p=pPool.pop()||{x,y,vx:Math.random()*100-50,vy:Math.random()*100-150,life:1,col:color};p.x=x;p.y=y;p.life=1;pPool.push(p);particles.push(p);},update(){particles=particles.filter(p=>{p.x+=p.vx*Engine.time.dt;p.y+=p.vy*Engine.time.dt;p.vy+=200*Engine.time.dt;p.life-=Engine.time.dt*2;if(p.life>0){ctx.save();ctx.globalAlpha=p.life;ctx.fillStyle=p.col;ctx.fillRect(p.x-Renderer.cam.x,p.y-Renderer.cam.y,6,6);ctx.restore();return false;}return true;});}};

let audioCtx;function initAudio(){audioCtx=new AudioContext();}function beep(freq=440,dur=0.1,type='square',vol=0.3){const o=audioCtx.createOscillator(),g=audioCtx.createGain();o.connect(g);g.connect(audioCtx.destination);o.frequency.value=freq;o.type=type;g.gain.setValueAtTime(vol,audioCtx.currentTime);g.gain.exponentialRampToValueAtTime(0.01,audioCtx.currentTime+dur);o.start(audioCtx.currentTime);o.stop(audioCtx.currentTime+dur);}

/* ==============================
   CHAT, SAVE, LOAD
   ============================== */
let playerID;
function addChat(msg){const chat=document.getElementById('chat');const sp=document.createElement('span');sp.textContent='» '+msg;chat.appendChild(sp);chat.scrollTop=chat.scrollHeight;}
function saveGame(){const p=ECS.get(playerID).player;localStorage.setItem('thuamer',JSON.stringify({pos:ECS.get(playerID).pos,player:p}));addChat('¡Guardado!');beep(523,0.1);}
function loadGame(){const s=localStorage.getItem('thuamer');if(s){const data=JSON.parse(s);playerID=ECS.create({...data.pos,...data.player});addChat('¡Carga OK!');return true;}return false;}

/* ==============================
   INICIALIZACION
   ============================== */
initAudio();
if(!loadGame()){
  playerID=ECS.create(CPos(World.size*0.5,World.size*0.5,16),CVel(),CSprite('#0ff',24),CPlayer(1,300,300,150,150,25,25,25,25,[{n:'Slash',cd:0,maxCd:0.8},{n:'Fire',cd:0,maxCd:2},{n:'Heal',cd:0,maxCd:3},{n:'Dash',cd:0,maxCd:1.5}],[]));
}

/* ==============================
   GENERACION DE MOBS, NPCs, ITEMS, PORTALS
   ============================== */
for(let i=0;i<800;i++)ECS.create(CPos(Math.random()*World.size,Math.random()*World.size),CVel(),CSprite('#f55',12+(Math.random()*8)),CMob(150+Math.random()*400,150+Math.random()*400,Math.random()*40+1));
ECS.create(CPos(World.size/2+1500,World.size/2+1500,32),CVel(),CSprite('#ff0',40),CMob(12000,12000,250,'#ff0','BOSS'));
for(let i=0;i<150;i++)ECS.create(CPos(Math.random()*World.size,Math.random()*World.size),CVel(),CSprite('#0a0',20),CNPC(`NPC${i}`,[{id:i,desc:'Mata 50 goblin',goal:50,progress:0,type:'kill'},{id:i+150,desc:'Mata 20 wave',goal:20,progress:0,type:'kill'}]));
for(let i=0;i<800;i++)ECS.create(CPos(Math.random()*World.size,Math.random()*World.size),CVel(),CSprite('#ff0',8),CItem('loot'));
ECS.create(CPos(World.size*0.3,World.size*0.3),CVel(),CSprite('#f0f',36),CPortal(World.size*0.7,World.size*0.7));

addChat('¡Bienvenido! Busca NPCs verdes (E), grindea quests, craftea, al boss amarillo!');
</script>
</body>
</html>
