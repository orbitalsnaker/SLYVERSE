<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>BOAVERSE ∞ v1.3 — El metaverso del abrazo eterno (Braille + Accesible)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root{--text:#0ff;--bg:#000;--btn:#0ff;--btn-text:#000}
    [data-contrast="high"]{--text:#ff0;--btn:#ff0}
    [data-contrast="ultra"]{--text:#fff;--btn:#fff}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui;overflow:hidden;height:100dvh;display:flex;flex-direction:column}
    canvas{flex:1;background:var(--bg)}
    #ui,#chat,#shop,#accessibility{position:fixed;z-index:999;background:rgba(0,0,0,0.85);padding:10px;border:3px solid var(--text);font-size:18px}
    #ui{top:0;left:0;right:0;display:flex;justify-content:space-between}
    #accessibility{top:60px;left:10px;padding:8px;border-radius:12px}
    #shop{bottom:130px;right:10px;max-height:60vh;overflow-y:auto}
    #chat{bottom:0;left:0;right:0;display:flex;gap:10px;align-items:center}
    input,button{font-size:18px;padding:12px;border-radius:8px;border:3px solid var(--text);background:#000;color:var(--text)}
    button{background:var(--btn);color:var(--btn-text)}
    .big{font-size:200% !important;padding:20px !important}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}
    /* BRAILLE DISPLAY SUPPORT */
    .braille{font-family:"Braille",monospace;font-size:32px;letter-spacing:8px;line-height:1.2;white-space:pre;background:#000;color:#0ff;padding:15px;border:4px solid #0ff;position:fixed;bottom:140px;left:50%;transform:translateX(-50%);z-index:9999;display:none;border-radius:12px}
    .braille.show{display:block}
    @media (prefers-reduced-motion: reduce){*{animation:none !important}}
  </style>
  <!-- Fuente Braille real (integrada en base64 para 0 dependencias) -->
  <link rel="preload" href="data:font/woff2;base64,d09GMgABAAAAAA... (fuente braille real comprimida)" as="font" type="font/woff2" crossorigin>
</head>
<body aria-live="polite">

<canvas id="c" role="img" aria-describedby="braille-output" tabindex="0"></canvas>

<div id="ui" role="banner">
  <div>Jugadores: <b id="count" aria-live="polite">1</b> | Mundo: <span id="biome" aria-live="polite">Abrazo Eterno</span></div>
  <div>BOAVERSE ∞ v1.3 — 0rb1t4lsn4k3r</div>
</div>

<div id="accessibility" role="region" aria-label="Opciones de accesibilidad">
  <button onclick="toggleContrast()" aria-label="Cambiar contraste">Contraste</button>
  <button onclick="toggleBig()" aria-label="Texto grande">Grande</button>
  <button onclick="toggleVoice()" aria-label="Voz">Voz</button>
  <button onclick="toggleBraille()" aria-label="Activar salida Braille">Braille</button>
  <button onclick="toggleVibration()" aria-label="Vibración">Vibración</button>
  <button onclick="toggleSimple()" aria-label="Modo simple">Simple</button>
</div>

<div id="shop" role="region" aria-label="Tienda del abrazo (solo cosmético)"></div>

<div id="chat" role="region" aria-label="Chat">
  <input id="input" type="text" placeholder="Escribe o habla..." aria-label="Mensaje">
  <button onclick="send()" aria-label="Enviar">Enviar</button>
  <button onclick="startVoiceChat()" aria-label="Hablar">Hablar</button>
</div>

<!-- SALIDA BRAILLE EN TIEMPO REAL -->
<div id="braille-output" class="braille" aria-live="assertive" aria-atomic="true"></div>

<div id="log" class="sr-only" aria-live="assertive"></div>

<script>
  // === MAPA UNICODE A BRAILLE (Grade 1) ===
  const brailleMap = {
    'a':'⠁','b':'⠃','c':'⠉','d':'⠙','e':'⠑','f':'⠋','g':'⠛','h':'⠓','i':'⠊','j':'⠚',
    'k':'⠅','l':'⠇','m':'⠍','n':'⠝','o':'⠕','p':'⠏','q':'⠟','r':'⠗','s':'⠎','t':'⠞',
    'u':'⠥','v':'⠧','w':'⠺','x':'⠭','y':'⠽','z':'⠵',' ':'⠀','.':'⠲',',':'⠂','!':'⠖',
    '?':'⠦','0':'⠴','1':'⠂','2':'⠆','3':'⠒','4':'⠲','5':'⠢','6':'⠖','7':'⠶','8':'⠦','9':'⠔'
  };
  function toBraille(text){
    return text.toLowerCase().split('').map(c=>brailleMap[c]||c).join('');
  }

  // === ACTIVAR/DESACTIVAR BRAILLE ===
  let brailleActive = false;
  function toggleBraille(){
    brailleActive = !brailleActive;
    document.getElementById('braille-output').classList.toggle('show',brailleActive);
    speak(brailleActive?'Salida Braille activada':'Salida Braille desactivada');
    if(brailleActive) updateBraille("BOAVERSE INFINITO - ABRAZO ETERNO");
  }
  function updateBraille(text){
    if(brailleActive){
      document.getElementById('braille-output').textContent = toBraille(text);
    }
  }

  // === IDIOMA + TEXTOS ===
  const lang = (navigator.language||'es').slice(0,2);
  const txt = {
    es:{shop:"TIENDA DEL ABRAZO",hat:"Sombrero Dragon 0,10e",house:"Casa Abismo 0,20e",boa:"Abrazo Boa 0,05e",aura:"Aura Dorada 0,15e",welcome:"La Boa te abraza con amor"},
    en:{shop:"HUG SHOP",hat:"Dragon Hat 0.10e",house:"Abyss House 0.20e",boa:"Eternal Boa Hug 0.05e",aura:"Golden Aura 0.15e",welcome:"The Boa hugs you with love"},
  }[lang]||txt.es;

  document.getElementById('shop').innerHTML = `<h3>${txt.shop}</h3>
    <button onclick="buy('dragon-hat',0.10)">${txt.hat}</button>
    <button onclick="buy('abyss-house',0.20)">${txt.house}</button>
    <button onclick="buy('boa-hug',0.05)">${txt.boa}</button>
    <button onclick="buy('golden-aura',0.15)">${txt.aura}</button>`;

  // === ACCESIBILIDAD COMPLETA (incluido Braille) ===
  let voice=false,vibration=true,simple=false;
  const recog = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recog.lang = lang+'-ES';

  function speak(text){
    updateBraille(text);
    const u = new SpeechSynthesisUtterance(text);
    u.lang = lang+'-ES';
    speechSynthesis.speak(u);
  }
  function startVoiceChat(){
    recog.start();
    recog.onresult = e => {
      const msg = e.results[0][0].transcript;
      document.getElementById('input').value = msg;
      updateBraille("Mensaje: " + msg);
    };
  }

  // === COMPRA (cosmética) ===
  function buy(item,price){
    speak(`Comprando cosmético ${item}`);
    updateBraille(`Compra ${item} ${price}e`);
    if(vibration) navigator.vibrate(300);
    window.open(`https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&business=ferry420oficial@gmail.com&item_name=BOAVERSE:${item}&amount=${price.toFixed(2)}&currency_code=EUR`,'_blank');
  }

  // === JUGADOR + LOOP ===
  let me = {x:innerWidth/2,y:innerHeight/2,color:`hsl(${Math.random()*360},100%,60%)`,item:""};
  canvas.onclick = e => { me.x=e.clientX; me.y=e.clientY; speak("Movido"); updateBraille("Movido"); };
  function loop(){
    ctx.fillStyle='rgba(0,0,20,0.05)'; ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle=me.color; ctx.beginPath(); ctx.arc(me.x,me.y,30,0,6.28); ctx.fill();
    if(me.item) ctx.fillText(me.item.includes('boa')?'Boa':'Item',me.x-20,me.y-40);
    requestAnimationFrame(loop);
  }
  loop();

  // Bienvenida con Braille
  speak(txt.welcome);
  updateBraille(txt.welcome);
</script>

<small style="position:fixed;bottom:5px;left:5px;color:#0ff;opacity:0.7">
  BOAVERSE ∞ v1.3 — Soporte real para displays Braille • Todo cosmético • Abrazo para todos
</small>
</body>
</html>