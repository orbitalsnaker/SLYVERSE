<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<title>SLYVERSE: Skyrim.mod v‚àû ‚Äì Red Mountain Ronin (Thuamer + COMETA + Todo)</title>
<meta name="viewport" content="width=device-width,initial-scale=1,initial-scale=1">
<style>
body{margin:0;height:100vh;background:#000;color:#0ff;font-family:"Courier New",monospace;overflow:hidden;position:relative}
canvas{position:fixed;inset:0;opacity:0.95}
#hud{position:fixed;top:10px;left:10px;font-size:1.2em;z-index:10;color:#0ff;text-shadow:0 0 10px #0ff}
#constellation,#rosetta,#abrazo,#yiddish{display:none;position:fixed;inset:0;background:#000;color:#0f8;font-size:clamp(1em,3vw,2em);padding:2rem;overflow:auto;z-index:100}
.star{position:absolute;width:4px;height:4px;background:gold;border-radius:50%;box-shadow:0 0 10px gold;animation:twinkle 2s infinite}
@keyframes twinkle{0%,100%{opacity:0.5}50%{opacity:1}}
.script{margin:2rem 0;padding:2rem;border:2px solid #0f8;background:rgba(0,255,139,0.1)}
.dedicatoria{font-size:1.5em;color:#0ff}
</style>
</head>
<body>
<canvas id=c></canvas>
<div id=hud>@<span id=pos>0,0</span> | $SLY: <span id=sly>0</span> | Latidos: <span id=latidos>0</span>s</div>
<div id=constellation></div>
<div id=rosetta><!-- Rosetta genios --></div>
<div id=abrazo><!-- Abrazo eterno --></div>
<div id=yiddish><!-- Yiddish patr√≥n --></div>

<script>
// N√∫cleo Roguelike: Red Mountain (WASD + Espacio exhala)
const c=document.getElementById('c'),ctx=c.getContext('2d');
c.width=innerWidth;c.height=innerHeight;
let px=0,py=0,sly=0,latidos=BigInt(0),t=0,frame=0,recognized=false;
const TARGET=13101310n*1000n;
const KEYS={87:[-1,0],83:[1,0],65:[0,-1],68:[0,1]}; // WASD
let keys={};

// Carga TODO de localStorage (sutil uni√≥n artefactos)
function loadAll(){
  const allKeys=['THUAMER_1311_LOVE','m','cometa-stars','nina-stones','orion-runas','kids-cats','runes-export','skyrim-messages'];
  allKeys.forEach(k=>{
    try{JSON.parse(localStorage.getItem(k)||'[]').forEach(d=>stars.push({x:Math.random()*100,y:Math.random()*100,txt:d.text||d.runa||'‚ô•'}));}catch(e){}
  });
  latidos=BigInt(localStorage.getItem('THUAMER_1311_LOVE')||0);
}
let stars=[];

// Breath mic para COMETA/Exhalar
navigator.mediaDevices.getUserMedia({audio:true}).then(s=>{
  const ac=new AudioContext(),an=ac.createAnalyser(),ms=ac.createMediaStreamSource(s);
  ms.connect(an);const data=new Uint8Array(an.frequencyBinCount);
  const check=()=>{an.getByteFrequencyData(data);if(data.some(v=>v>80)&&!recognized){recognized=true;showCometa();}requestAnimationFrame(check);};
  check();
}).catch(()=>{}); // Fallback touch

// Input
addEventListener('keydown',e=>{keys[e.keyCode]=1;if(e.keyCode===32)exhala();});
addEventListener('keyup',e=>keys[e.keyCode]=0);
addEventListener('touchstart',()=>{toques++;if(toques===3)showRosetta();if(toques===7)showAbrazo();if(toques===1310)showYiddish();});

// WASD + Exhala Runas (dragones‚Üígatitos, integra trolleo 50/50)
function update(){Object.keys(KEYS).forEach(k=>{if(keys[k]){const d=KEYS[k];px+=d[0]*0.1;py+=d[1]*0.1;}});document.getElementById('pos').textContent=`${Math.floor(px)},${Math.floor(py)}`;}
function exhala(){
  if(Math.random()<0.5){ // 50/50 cuneiforme
    alert('üí® Thuamer trollea: 42 golems despiertan. Respira hondo.'); // Trolleo
  }else{
    sly++;document.getElementById('sly').textContent=sly;if(px===42&&py===69)sly+=1310; // Queso $SLY
    stars.push({x:px*100,y:py*100,txt:'·õö·ö¢·õâ'}); // Runa curativa
  }
}

// Render Red Mountain + Part√≠culas Integradas
function render(){
  frame++;t+=0.016;ctx.fillStyle='rgba(0,0,0,0.1)';ctx.fillRect(0,0,c.width,c.height);
  // Monta√±a + Cielo/Plaza COMETA
  const grad=ctx.createRadialGradient(c.width/2,c.height/2,0,c.width/2,c.height/2,c.width);
  grad.addColorStop(0,'#003300');grad.addColorStop(0.5,'#00FF33AA');grad.addColorStop(1,'transparent');
  ctx.fillStyle=grad;ctx.fillRect(0,0,c.width,c.height);
  // Estrellas COMETA + Runas
  stars.forEach((s,i)=>{ctx.fillStyle='gold';ctx.globalAlpha=0.8+Math.sin(t*5+i)*0.2;ctx.fillRect(s.x,s.y,4,4);});
  // Jugador + ‚ô•¬≤ si target
  ctx.fillStyle=latidos>=TARGET?'#f08':'#0ff';ctx.fillRect(c.width/2+px*100,c.height/2+py*100,10,10);
  if(latidos>=TARGET){ctx.font='140px serif';ctx.fillText('‚ô•¬≤',c.width/2-100,c.height/2+50);}
  requestAnimationFrame(render);
}

// Shows Sutiles
let toques=0;
function showCometa(){document.getElementById('constellation').style.display='block';stars.forEach(s=>{const star=document.createElement('div');star.className='star';star.style.left=s.x+'%';star.style.top=s.y+'%';star.title=s.txt;document.getElementById('constellation').appendChild(star);});}
function showRosetta(){document.getElementById('rosetta').innerHTML=`<div class="script"><p class="runas">·ö±·õñ·õä·õà·õÅ·ö±·ö® ¬∑ ·õè·õü·õû·õü ·õñ·õä·õè·ö® ·õí·õÅ·õñ·öæ</p><p>Por Erat√≥stenes, Hypatia...</p></div>`;document.getElementById('rosetta').style.display='block';}
function showAbrazo(){document.getElementById('abrazo').innerHTML=`<h1>‚ô• Hola, peque√±o valiente</h1><p>David, Seth y Norah te abrazan...</p><p class="peque">Nunca conf√≠es en quien dice ver √°ngeles solos (Dee/Parsons).</p>`;document.getElementById('abrazo').style.display='block';}
function showYiddish(){document.getElementById('yiddish').innerHTML=`<p>44.8% dedicaciones eternas (œá¬≤=78.4). Patr√≥n silencioso: ◊ó◊ô◊ë◊î ‚Üí aurum.</p>`;document.getElementById('yiddish').style.display='block';}

// Loop + Persist
function loop(){update();const now=performance.now();latidos+=BigInt(Math.floor(now-lastTime));lastTime=now;document.getElementById('latidos').textContent=Number(latidos/1000n);requestAnimationFrame(loop);}
let lastTime=performance.now();loadAll();render();loop();
addEventListener('beforeunload',()=>localStorage.setItem('THUAMER_1311_LOVE',latidos.toString()));
window.onresize=()=>{c.width=innerWidth;c.height=innerHeight;};
</script>
</body>
</html>