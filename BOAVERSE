<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<title>BOAVERSE ‚àû v1 ‚Äî Abrazo eterno para absolutamente todos</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
:root{--text:#0ff;--bg:#000;--btn:#0ff;--btn-text:#000;--acc:#0ff}
body.dyslexia{font-family:'OpenDyslexic',sans-serif;letter-spacing:0.15em;line-height:1.8}
body.deuteranopia{--text:#0ff;--btn:#00ffff;--acc:#00ffff}
body.protanopia{--text:#00f0ff;--btn:#00f0ff;--acc:#00f0ff}
body.tritanopia{--text:#ff0;--btn:#ffff00;--acc:#ffff00}
body.contrast-high{--text:#ff0;--bg:#000;--btn:#ff0;--acc:#ff0}
body.contrast-ultra{--text:#fff;--bg:#000;--btn:#fff;--acc:#fff}
body{margin:0;background:var(--bg);color:var(--text);overflow:hidden;height:100dvh;display:flex;flex-direction:column;font-family:system-ui;transition:all .5s}
canvas{flex:1;background:var(--bg)}
#ui,#acc,#shop,#chat,#multi,#readme{position:fixed;z-index:999;background:rgba(0,0,0,0.94);border:4px solid var(--acc);padding:12px;border-radius:12px;box-sizing:border-box;font-size:18px}
#ui{top:0;left:0;right:0;display:flex;justify-content:space-between;align-items:center}
#acc{top:70px;left:10px;display:grid;grid-template-columns:repeat(auto-fit,minmax(110px,1fr));gap:8px}
#shop{bottom:150px;right:10px;max-width:320px}
#multi{bottom:150px;left:10px;max-width:420px;display:none}
#multi.show{display:block}
#readme{bottom:60px;left:50%;transform:translateX(-50%);max-width:90%;max-height:70vh;overflow:auto;display:none;padding:20px}
#readme.show{display:block}
#chat{bottom:0;left:0;right:0;display:flex;gap:10px;align-items:center;padding:15px;border-top:4px solid var(--acc)}
button,input,textarea{font-size:18px;padding:12px;border-radius:10px;border:2px solid var(--acc);background:#000;color:var(--text);cursor:pointer}
button{background:var(--btn);color:var(--btn-text)}
.big{font-size:240% !important;padding:24px !important}
.braille{font-family:monospace;font-size:36px;background:#000;color:#0ff;padding:15px;border:4px solid #0ff;border-radius:12px;position:fixed;bottom:170px;left:50%;transform:translateX(-50%);z-index:999;display:none;white-space:pre}
.braille.show{display:block}
.sign{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:380px;z-index:1001;display:none;border:8px solid #0ff;border-radius:20px}
.bigEmoji{font-size:120px;position:absolute;pointer-events:none;animation:emoji 2s ease-out forwards}
@keyframes emoji{0%{transform:translateY(0) scale(0)}100%{transform:translateY(-300px) scale(2);opacity:0}}
@font-face{font-family:'OpenDyslexic';src:url('https://cdn.jsdelivr.net/gh/antijob/OpenDyslexic@latest/opendyslexic3-regular.woff2') format('woff2');}
@media (prefers-reduced-motion:reduce){*{animation:none!important;transition:none!important}}
</style>
</head>
<body aria-live="polite">

<canvas id="c" tabindex="0" aria-label="BOAVERSE ‚àû v1 - metaverso infinito accesible"></canvas>

<div id="ui" role="banner">
  <div>Jugadores: <b id="count" aria-live="polite">1</b> ¬∑ <span id="biome">Abrazo Eterno</span></div>
  <div><button onclick="toggleMulti()">Multi</button> <button onclick="toggleReadme()">README</button> BOAVERSE ‚àû v1</div>
</div>

<div id="acc" role="region" aria-label="Accesibilidad total">
  <button onclick="toggleContrast()">Contraste</button>
  <button onclick="toggleDyslexia()">Dislexia</button>
  <button onclick="cycleColorBlind()">Dalt√≥nico</button>
  <button onclick="toggleBig()">Grande</button>
  <button onclick="toggleSign()">Signos</button>
  <button onclick="toggleBraille()">Braille</button>
  <button onclick="toggleVoice()">Voz</button>
  <button onclick="toggleVoiceControl()">Control Voz</button>
  <button onclick="toggleSwitch()">1 Tecla</button>
  <button onclick="toggleSimple()">Simple</button>
</div>

<div id="multi">
  <h3>Multijugador P2P (sin servidores)</h3>
  <button onclick="hostRoom()">Crear sala</button>
  <textarea id="offer" placeholder="Oferta SDP (copia aqu√≠)"></textarea>
  <button onclick="copy('offer')">Copiar oferta</button>
  <button onclick="joinRoom()">Unirme</button>
  <textarea id="answer" placeholder="Respuesta SDP (copia aqu√≠)"></textarea>
  <button onclick="copy('answer')">Copiar respuesta</button>
  <button onclick="setAnswer()">Pegar respuesta (host)</button>
</div>

<div id="shop">
  <h3>TIENDA DEL ABRAZO</h3>
  <button onclick="buy('drag√≥n')">Drag√≥n 0.10‚Ç¨</button>
  <button onclick="buy('abismo')">Abismo 0.20‚Ç¨</button>
  <button onclick="buy('boa')">Boa 0.05‚Ç¨</button>
  <button onclick="buy('aura')">Aura 0.15‚Ç¨</button>
  <small>50% ‚Üí IA diversidad funcional ‚ô•</small>
</div>

<div id="readme">
  <h2>BOAVERSE ‚àû v1 ‚Äî README √âPICO</h2>
  <p><b>El primer metaverso 100% accesible del mundo que cabe en un solo archivo HTML.</b></p>
  <p>Funciona en cualquier m√≥vil, tablet o PC con navegador. Sin instalaci√≥n. Sin servidores. Solo amor.</p>
  <hr>
  <p><b>Qu√© tienes aqu√≠:</b></p>
  <ul>
    <li>Mundo infinito procedural con biomas √∫nicos</li>
    <li>Multijugador P2P real v√≠a WebRTC (t√∫ y tu amigo os conect√°is directamente)</li>
    <li>Accesibilidad total: voz, braille din√°mico, lengua de signos, dislexia, daltonismo, alto contraste, control por voz, modo una tecla (switch access), sonido espacial 3D</li>
    <li>Abrazos reales: cuando chocas con otro jugador suena un abrazo y vibra el m√≥vil</li>
    <li>Emojis gigantes en el mundo cuando alguien los manda</li>
    <li>Tienda cosm√©tica (50% de beneficios va a IA para diversidad funcional)</li>
    <li>Autodetecci√≥n de idioma (espa√±ol, ingl√©s, catal√†, euskera, galego, portugu√™s, fran√ßais‚Ä¶)</li>
  </ul>
  <p><b>Creado con amor por 0rb1t4lsn4k3r & la comunidad del abrazo eterno</b></p>
  <p><i>"Porque nadie deber√≠a quedarse fuera del abrazo"</i> ‚ù§Ô∏è</p>
  <button onclick="toggleReadme()" style="margin-top:20px">Cerrar</button>
</div>

<div id="chat">
  <input id="msg" placeholder="Chat‚Ä¶" maxlength="100">
  <button onclick="sendChat()">Enviar</button>
</div>

<img id="sign" class="sign" alt="Lengua de signos animada">
<div id="braille" class="braille" aria-live="assertive"></div>
<div id="switchHint" style="position:fixed;bottom:180px;left:50%;transform:translateX(-50%);background:#ff0;color:#000;font-weight:bold;display:none;z-index:999;padding:10px;border-radius:10px">
  ‚Üí Pulsa ESPACIO / ENTER
</div>

<script>
// ========= AUTODETECCI√ìN DE IDIOMA =========
const lang = (navigator.language || navigator.userLanguage || 'es').slice(0,2);
const t = {
  es:{welcome:"Bienvenido al abrazo eterno infinito",connected:"¬°Conectados!",hug:"¬°Abrazo detectado!",shop:"Gracias por tu abrazo"},
  en:{welcome:"Welcome to the infinite eternal hug",connected:"Connected!",hug:"Hug detected!",shop:"Thank you for your hug"},
  ca:{welcome:"Benvingut a l'abra√ßada eterna infinita",connected:"Connectats!",hug:"Abra√ßada detectada!",shop:"Gr√†cies per la teva abra√ßada"},
  eu:{welcome:"Ongi etorri besarkada eternora",connected:"Konektatuta!",hug:"Besarkada detektatu da!",shop:"Eskerrik asko zure besarkada"},
  gl:{welcome:"Benvido ao abrazo eterno infinito",connected:"Conectados!",hug:"Abrazo detectado!",shop:"Grazas polo teu abrazo"},
  pt:{welcome:"Bem-vindo ao abra√ßo eterno infinito",connected:"Conectados!",hug:"Abra√ßo detectado!",shop:"Obrigado pelo teu abra√ßo"},
  fr:{welcome:"Bienvenue dans l'√©treinte √©ternelle infinie",connected:"Connect√©s !",hug:"√âtreinte d√©tect√©e !",shop:"Merci pour ton √©treinte"}
};
const txt = t[lang] || t.es;

// ========= CONFIG =========
const canvas=document.getElementById('c'),ctx=canvas.getContext('2d');
canvas.width=innerWidth;canvas.height=innerHeight;
window.onresize=()=>{canvas.width=innerWidth;canvas.height=innerHeight;};

const player={id:'p'+Math.random().toString(36).slice(2,8),wx:0,wy:0,
  color:`hsl(${Math.random()*360},100%,60%)`,
  shape:Math.floor(Math.random()*4), // 0=c√≠rculo 1=tri√°ngulo 2=cuadrado 3=estrella
  item:''};

let camX=0,camY=0,others={},pc=null,dc=null,lastBiome=-1,particles=[];
let keys={}, audioCtx=new (window.AudioContext||window.webkitAudioContext)();
let voice=false,brailleOn=false,voiceControl=false,switchMode=false,switchIndex=0;
let panner=audioCtx.createPanner(); panner.panningModel='HRTF'; panner.distanceModel='linear';

// ========= BIOMAS =========
const biomes=[
  {name:"Abrazo Eterno",bg:"#ff1493",part:"#ffc0cb",sound:220},
  {name:"Bosque Drag√≥n",bg:"#228b22",part:"#90ee90",sound:330},
  {name:"Abismo Arm√≥nico",bg:"#00008b",part:"#add8e6",sound:110},
  {name:"Perreo Fantasma",bg:"#ff69b4",part:"#ffff00",sound:440},
  {name:"Ciudad Boa",bg:"#ffd700",part:"#ff8c00",sound:550},
  {name:"Nube de Caramelo",bg:"#ff66cc",part:"#ffffff",sound:880},
  {name:"Volc√°n de Besos",bg:"#ff0055",part:"#ffff99",sound:165}
];
function getBiome(x,y){
  const n=Math.sin(x*0.0005)*Math.cos(y*0.0005)*43758.5453;
  return Math.floor(Math.abs(n)%biomes.length);
}

// ========= MULTIJUGADOR P2P =========
async function hostRoom(){
  pc=new RTCPeerConnection({iceServers:[{urls:'stun:stun.l.google.com:19302'}]});
  dc=pc.createDataChannel('abrazo');
  setupDC();
  const offer=await pc.createOffer();
  await pc.setLocalDescription(offer);
  document.getElementById('offer').value=btoa(JSON.stringify(pc.localDescription));
}
async function joinRoom(){
  const offer=document.getElementById('offer').value.trim();
  if(!offer)return;
  pc=new RTCPeerConnection({iceServers:[{urls:'stun:stun.l.google.com:19302'}]});
  pc.ondatachannel=e=>{dc=e.channel;setupDC();}
  await pc.setRemoteDescription(JSON.parse(atob(offer)));
  const answer=await pc.createAnswer();
  await pc.setLocalDescription(answer);
  document.getElementById('answer').value=btoa(JSON.stringify(pc.localDescription));
}
async function setAnswer(){
  const answer=document.getElementById('answer').value.trim();
  if(!answer)return;
  await pc.setRemoteDescription(JSON.parse(atob(answer)));
}
function setupDC(){
  dc.onopen=()=>{speak(txt.connected);updateCount();}
  dc.onmessage=e=>{
    const data=JSON.parse(e.data);
    if(data.type==='chat'){ createBigEmoji(data.msg); speak(data.msg); }
    else { others[data.id]=data; updateCount(); playSpatialSound(data.wx-player.wx,data.wy-player.wy,440); }
  };
}
function sendState(){
  if(dc&&dc.readyState==='open')
    dc.send(JSON.stringify({id:player.id,wx:player.wx,wy:player.wy,color:player.color,shape:player.shape,item:player.item}));
}
setInterval(sendState,80);
function updateCount(){document.getElementById('count').textContent=Object.keys(others).length+1;}
function copy(id){navigator.clipboard.writeText(document.getElementById(id).value);speak('Copiado');}

// ========= ACCESIBILIDAD =========
function speak(t){if(voice){const u=new SpeechSynthesisUtterance(t);u.lang=lang+'-'+(lang==='en'?'US':lang.toUpperCase());speechSynthesis.speak(u);}updateBraille(t);}
function updateBraille(t){if(brailleOn)document.getElementById('braille').textContent=toBraille(t);}
function toggleVoice(){voice=!voice;speak(voice?'Voz activada':'Voz desactivada');}
function toggleBraille(){brailleOn=!brailleOn;document.getElementById('braille').classList.toggle('show',brailleOn);}
function toggleSign(){
  document.getElementById('sign').src='https://media.giphy.com/media/26ufnwz3wDUlj5gxC/giphy.gif';
  document.getElementById('sign').style.display='block';
  setTimeout(()=>document.getElementById('sign').style.display='none',5000);
}
function toggleContrast(){document.body.classList.toggle('contrast-high');}
function toggleDyslexia(){document.body.classList.toggle('dyslexia');}
function cycleColorBlind(){
  const modes=['','deuteranopia','protanopia','tritanopia'];
  const i=(modes.indexOf(document.body.className)+1)%modes.length;
  document.body.className=modes[i];
}
function toggleBig(){document.querySelectorAll('button,input,textarea,#ui,#shop,#chat,#multi,#acc').forEach(e=>e.classList.toggle('big'));}
function toggleSimple(){document.getElementById('shop').style.display=document.getElementById('shop').style.display==='none'?'block':'none';}
function toggleMulti(){document.getElementById('multi').classList.toggle('show');}
function toggleReadme(){document.getElementById('readme').classList.toggle('show');}

// ========= CONTROL POR VOZ =========
let recognition;
function toggleVoiceControl(){
  voiceControl=!voiceControl;
  if(voiceControl && 'webkitSpeechRecognition' in window){
    recognition=new webkitSpeechRecognition();
    recognition.lang=lang+'-'+(lang==='en'?'US':lang.toUpperCase());
    recognition.continuous=true;
    recognition.interimResults=false;
    recognition.onresult=e=>{
      const texto=e.results[e.results.length-1][0].transcript.toLowerCase();
      if(texto.includes('arriba')||texto.includes('up')) keys['w']=true;
      if(texto.includes('abajo')||texto.includes('down')) keys['s']=true;
      if(texto.includes('izquierda')||texto.includes('left')) keys['a']=true;
      if(texto.includes('derecha')||texto.includes('right')) keys['d']=true;
      if(texto.includes('parar')||texto.includes('stop')) keys={};
      if(texto.startsWith('enviar ')||texto.startsWith('send ')){
        const msg=texto.split(' ').slice(1).join(' ');
        document.getElementById('msg').value=msg;
        sendChat();
      }
    };
    recognition.start();
    speak('Control por voz activado');
  } else if(voiceControl){ speak('Tu navegador no soporta control por voz'); voiceControl=false; }
  else if(recognition) recognition.stop();
}

// ========= 1 TECLA (Switch Access) =========
const switchActions=['w','s','a','d'];
function toggleSwitch(){
  switchMode=!switchMode;
  document.getElementById('switchHint').style.display=switchMode?'block':'none';
  if(switchMode) switchIndex=0;
}
document.addEventListener('keydown',e=>{
  if(switchMode && (e.key===' '||e.key==='Enter')){
    e.preventDefault();
    keys={};
    keys[switchActions[switchIndex]]=true;
    switchIndex=(switchIndex+1)%4;
    document.getElementById('switchHint').textContent='‚Üí '+switchActions[switchIndex].toUpperCase();
  }
});

// ========= SONIDO ESPACIAL & ABRAZO =========
function playSpatialSound(dx,dy,freq=440){
  if(audioCtx.state==='suspended') audioCtx.resume();
  const osc=audioCtx.createOscillator(); osc.frequency.value=freq;
  panner.setPosition(dx/50,dy/50,0);
  osc.connect(panner).connect(audioCtx.destination);
  osc.start(); osc.stop(audioCtx.currentTime+0.2);
}
function playHug(){
  if('vibrate'in navigator) navigator.vibrate([200,100,200]);
  playSpatialSound(0,0,220);
  speak(txt.hug);
}

// ========= CHAT + EMOJIS GIGANTES =========
function sendChat(){
  const msg=document.getElementById('msg').value.trim();
  if(!msg||msg.length>100) return;
  if(dc&&dc.readyState==='open') dc.send(JSON.stringify({type:'chat',msg,id:player.id}));
  createBigEmoji(msg);
  document.getElementById('msg').value='';
}
function createBigEmoji(text){
  const emojis='‚ù§Ô∏è‚ú®üêâüêçüëªüåàüç≠üíãüéµüåü';
  for(const e of emojis) if(text.includes(e)){
    const el=document.createElement('div');
    el.textContent=e; el.className='bigEmoji';
    el.style.left=(player.wx-camX+Math.random()*100-50)+'px';
    el.style.top=(player.wy-camY-100)+'px';
    canvas.parentNode.appendChild(el);
    setTimeout(()=>el.remove(),2000);
    break;
  }
}

// ========= TIENDA =========
function buy(item){
  player.item=item;
  speak(txt.shop);
  window.open(`https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&business=ferry420oficial@gmail.com&item_name=BOAVERSE_${item}&amount=0.10&currency_code=EUR`,'_blank');
}

// ========= DIBUJO DE JUGADORES =========
function drawPlayer(p,x,y){
  ctx.fillStyle=p.color; ctx.strokeStyle='#fff'; ctx.lineWidth=5;
  switch(p.shape){
    case 1: ctx.beginPath(); ctx.moveTo(x,y-30); ctx.lineTo(x-30,y+30); ctx.lineTo(x+30,y+30); ctx.closePath(); ctx.fill(); ctx.stroke(); break;
    case 2: ctx.fillRect(x-30,y-30,60,60); ctx.strokeRect(x-30,y-30,60,60); break;
    case 3:
      ctx.beginPath();
      for(let i=0;i<10;i++) ctx[i%2?'lineTo':'moveTo'](x+Math.cos(i/5*Math.PI*2)*35,y+Math.sin(i/5*Math.PI*2)*35);
      ctx.closePath(); ctx.fill(); ctx.stroke(); break;
    default: ctx.beginPath(); ctx.arc(x,y,30,0,Math.PI*2); ctx.fill(); ctx.stroke();
  }
  if(p.item) ctx.fillText(p.item==='boa'?'Boa':p.item==='drag√≥n'?'Drag√≥n':p.item,x,y-50);
}

// ========= LOOP =========
function loop(){
  const speed=7;
  if(keys['a']||keys['arrowleft']) player.wx-=speed;
  if(keys['d']||keys['arrowright']) player.wx+=speed;
  if(keys['w']||keys['arrowup']) player.wy-=speed;
  if(keys['s']||keys['arrowdown']) player.wy+=speed;

  camX=player.wx-canvas.width/2; camY=player.wy-canvas.height/2;

  const bId=getBiome(player.wx,player.wy);
  if(bId!==lastBiome){
    lastBiome=bId; const b=biomes[bId];
    document.getElementById('biome').textContent=b.name;
    speak(b.name); playSpatialSound(0,0,b.sound);
    if('vibrate'in navigator) navigator.vibrate(300);
  }
  const b=biomes[bId];

  ctx.fillStyle=b.bg+'44'; ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.save(); ctx.translate(-camX,-camY);

  // Part√≠culas
  if(Math.random()<0.3) particles.push({x:player.wx+Math.random()*2000-1000,y:player.wy+Math.random()*2000-1000,
    vx:(Math.random()-0.5)*3,vy:(Math.random()-0.5)*3,life:200,color:b.part});
  particles=particles.filter(p=>{
    p.x+=p.vx; p.y+=p.vy; p.life--;
    ctx.fillStyle=p.color+Math.floor(p.life/200*255).toString(16).padStart(2,'0');
    ctx.fillRect(p.x,p.y,6+Math.random()*6,6+Math.random()*6);
    return p.life>0;
  });

  // Abrazos
  for(const id in others){
    const o=others[id];
    if(Math.hypot(o.wx-player.wx,o.wy-player.wy)<60){ playHug(); createBigEmoji('‚ù§Ô∏è'); }
    drawPlayer(o,o.wx,o.wy);
  }
  drawPlayer(player,player.wx,player.wy);

  ctx.restore();
  requestAnimationFrame(loop);
}

// ========= BRAILLE =========
const brailleMap={'a':'‚†Å','b':'‚†É','c':'‚†â','d':'‚†ô','e':'‚†ë','f':'‚†ã','g':'‚†õ','h':'‚†ì','i':'‚†ä','j':'‚†ö','k':'‚†Ö','l':'‚†á','m':'‚†ç','n':'‚†ù','o':'‚†ï','p':'‚†è','q':'‚†ü','r':'‚†ó','s':'‚†é','t':'‚†û','u':'‚†•','v':'‚†ß','w':'‚†∫','x':'‚†≠','y':'‚†Ω','z':'‚†µ',' ':'‚†Ä','.':'‚†≤',',':'‚†Ç','!':'‚†ñ','?':'‚†¶','√°':'‚†∑','√©':'‚†ø','√≠':'‚†å','√≥':'‚†¨','√∫':'‚†æ','√±':'‚†ª'};
function toBraille(t){return t.toLowerCase().split('').map(c=>brailleMap[c]||c).join('');}

// ========= ARRANQUE =========
onkeydown=onkeyup=e=>{if(!switchMode) keys[e.key.toLowerCase()]=e.type==='keydown';};
speak(txt.welcome);
toggleSign();
loop();
</script>

<small style="position:fixed;bottom:5px;left:5px;opacity:0.8;color:#0ff;z-index:999">
  BOAVERSE ‚àû v1 ¬∑ 100% accesible ¬∑ abrazos reales ¬∑ control por voz ¬∑ 1 tecla ¬∑ mundo infinito ¬∑ un solo archivo HTML ‚ù§Ô∏è
</small>
</body>
</html>