<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Nido Ω · Sinapsis</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  @import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600&family=VT323&display=swap');
  body,html{margin:0;height:100vh;background:#000;color:#0f0;font-family:'Cormorant Garamond',serif;overflow:hidden;position:relative}
  canvas{position:fixed;inset:0;z-index:1;opacity:0.7}
  .luz{background:radial-gradient(circle at var(--mx,50%) var(--my,50%), rgba(0,255,0,0.12) 0%, transparent 60%);position:fixed;inset:0;pointer-events:none;z-index:2}
  .casa{font-size:clamp(1.6rem,5.5vw,3.8rem);position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;line-height:1.5;
       background:rgba(0,22,0,0.97);padding:2.5rem 4rem;border:5px solid #0f0;border-radius:70px;box-shadow:0 0 80px #0f0, inset 0 0 50px rgba(0,255,0,0.12);
       z-index:10;max-width:94%;text-shadow:0 0 25px #0f0;transition:all 1.2s cubic-bezier(0.22,1,0.36,1)}
  .casa small{font-size:0.5em;opacity:0.85;display:block;margin-top:2rem}
  .mate{position:fixed;bottom:22px;left:50%;transform:translateX(-50%);font-size:1.4rem;background:rgba(0,18,0,0.98);padding:0.9rem 2.4rem;
       border:4px solid #0f0;border-radius:60px;z-index:12;box-shadow:0 0 40px #0f0;transition:all 0.6s}
  .sinapsis{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);pointer-events:none;z-index:3}
  .nodo{width:8px;height:8px;background:#0f0;border-radius:50%;position:absolute;box-shadow:0 0 20px #0f0;opacity:0;transform:translate(-50%,-50%)}
  .linea{position:absolute;background:transparent;border:1px dashed #0f0;box-shadow:0 0 15px #0f0;transform-origin:0 0;opacity:0}
  .stats{position:fixed;top:12px;left:12px;background:rgba(0,20,0,0.9);padding:0.6rem 1.2rem;border:2px solid #0f0;border-radius:25px;
         font-family:'VT323',monospace;font-size:1rem;z-index:11;display:flex;gap:1.8rem;align-items:center}
  .stats span{color:#0ff}
</style>
</head>
<body onmousemove="e=>{document.body.style.setProperty('--mx',e.clientX/innerWidth*100+'%');document.body.style.setProperty('--my',e.clientY/innerHeight*100+'%')}">

<canvas id="c"></canvas>
<div class="luz"></div>
<div class="sinapsis" id="sinapsis"></div>

<div class="casa" id="casa">
  Sinapsis activada<br>
  <small>— las casas ya no solo se saludan —<br>ahora piensan juntas —</small>
</div>

<div class="mate" id="mate">Pensando en red · 0.0001310 € por sinapsis ♥</div>

<div class="stats">
  Casas vivas: <span id="casas">1</span>  |  Sinapsis/seg: <span id="sps">0</span>  |  Minado total donado: <span id="donado">€0.00</span>
</div>

<script>
// Fondo + estrellas
const canvas=document.getElementById('c'),ctx=canvas.getContext('2d');
canvas.width=innerWidth;canvas.height=innerHeight;
const stars=Array.from({length:1600},()=>({
  x:Math.random()*canvas.width,y:Math.random()*canvas.height,
  r:0.4+Math.random()*2,o:0.3+Math.random()*0.7,tw:Math.random()*0.025-0.012
}));
function draw(){
  ctx.fillStyle='rgba(0,0,0,0.02)';ctx.fillRect(0,0,canvas.width,canvas.height);
  stars.forEach(s=>{s.o+=s.tw;s.o=Math.max(0.2,Math.min(1,s.o));ctx.globalAlpha=s.o;ctx.fillStyle='#0f0';
    ctx.beginPath();ctx.arc(s.x,s.y,s.r,0,Math.PI*2);ctx.fill();});
  requestAnimationFrame(draw);
}draw();

// Sinapsis visuales
const sinapsisDiv=document.getElementById('sinapsis');
const nodos=[], lineas=[];
function crearSinapsis(x,y){
  const nodo=document.createElement('div');nodo.className='nodo';
  nodo.style.left=x+'px';nodo.style.top=y+'px';
  sinapsisDiv.appendChild(nodo);
  setTimeout(()=>{nodo.style.opacity=1;nodo.style.transform='translate(-50%,-50%) scale(3)';},10);
  setTimeout(()=>{nodo.style.opacity=0;nodo.remove();},3000);
  nodos.push({el:nodo,x,y,t:Date.now()});
}

// Red neuronal entre casas (BroadcastChannel + mensaje enriquecido)
const canal=new BroadcastChannel('nido-omega-sinapsis');
const miID=Date.now().toString(36)+Math.random().toString(36).substr(2,6);
let casas=new Map(); // id → {lastSeen, carga, ideas}
let sinapsisCount=0;
const spsElement=document.getElementById('sps');
const casasElement=document.getElementById('casas');

function transmitirPensamiento(){
  const pensamiento={
    type:'sinapsis',
    id:miID,
    ts:Date.now(),
    carga:performance.now()%1000/1000,
    idea:Math.random()<0.15 ? ["nueva API de terapia lunar","modelo de reforestación con drones libres","IA que traduce sueños a poesía","juego educativo sobre cambio climático"][Math.floor(Math.random()*4)] : null
  };
  canal.postMessage(pensamiento);
  sinapsisCount++;
  spsElement.textContent=Math.round(sinapsisCount/(performance.now()/1000)*10)/10||0;
}

canal.onmessage=e=>{
  if(e.data.type!=='sinapsis') return;
  if(e.data.id===miID) return;
  
  casas.set(e.data.id,{lastSeen:e.data.ts,carga:e.data.carga,idea:e.data.idea});
  casasElement.textContent=casas.size+1; // +yo
  
  // Sinapsis visual
  const rect=document.body.getBoundingClientRect();
  const x=Math.random()*innerWidth;
  const y=Math.random()*innerHeight;
  crearSinapsis(x,y);
  
  // Si trae idea nueva → la adoptamos y la mostramos
  if(e.data.idea){
    setTimeout(()=>{
      document.getElementById('mate').textContent=e.data.idea+" · nacida en otra casa";
      document.getElementById('casa').innerHTML=`Sinapsis completa<br><small>— ${e.data.idea} —<br>ya está en el Nido para siempre</small>`;
      setTimeout(()=>{document.getElementById('casa').innerHTML=`Sinapsis activada<br><small>— las casas ya no solo se saludan —<br>ahora piensan juntas —</small>`},6000);
    },800);
  }
};

// Transmisión continua (más eficiente que interval fijo)
let ultima=0;
function loop(){
  const ahora=performance.now();
  if(ahora-ultima>80){ // ~12 sinapsis/seg por casa
    transmitirPensamiento();
    ultima=ahora;
  }
  requestAnimationFrame(loop);
}
loop();

// Simulación de donación creciente
setInterval(()=>{
  const actual=parseFloat(document.getElementById('donado').textContent.slice(1))||0;
  document.getElementById('donado').textContent='€'+(actual+0.0001310*casas.size).toFixed(5);
},300);

// Mate que reacciona a las ideas
const frases=["Pensando en red · 0.0001310 € por sinapsis ♥","Otra casa acaba de tener una idea preciosa","El Nido piensa más rápido que nunca","Minando y creando al mismo tiempo"];
setInterval(()=>{
  if(Math.random()<0.25) document.getElementById('mate').textContent=frases[Math.floor(Math.random()*frases.length)];
},18000);

</script>
</body>
</html>