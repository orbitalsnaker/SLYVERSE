<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VOID LEGACY X ‚Äî THUAMER STUDIOS‚Ñ¢ (FIXED)</title>
  <style>
    body{margin:0;background:#000;color:#0f0;font-family:'Courier New',monospace;overflow:hidden;text-align:center}
    canvas{display:block;margin:0 auto;image-rendering:pixelated}
    #ui{position:absolute;top:10px;left:10px;z-index:100;background:rgba(0,20,0,0.8);padding:10px;border:2px solid #0f0;font-size:14px}
    #menu,#shop,#readme,#gameover{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.98);display:flex;flex-direction:column;justify-content:center;align-items:center;gap:20px;z-index:200}
    button{background:#0f0;color:#000;border:none;padding:15px 40px;font-size:20px;cursor:pointer;font-weight:bold;border-radius:5px}
    button:hover{background:#0c0}
    .premium{color:gold;font-size:22px}
    .skin-btn{background:#0088ff;color:#fff;padding:20px;margin:15px;border-radius:15px;font-size:18px;width:300px}
    .skin-btn:hover{background:#0066cc}
    .hidden{display:none}
    #shop-content{max-width:900px;max-height:80%;overflow-y:auto;background:#001100;padding:30px;border:3px double #0f0;color:#0f0;line-height:1.8}
    #paypal-container{margin:10px;}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/simplex-noise@4.0.1/simplex-noise.js"></script>
  <script src="https://www.paypal.com/sdk/js?client-id=CLIENT_ID_AQUI_CAMBIAR_POR_EL_TUYO&currency=EUR&intent=capture"></script>
</head>
<body>

<div id="ui">
  Nivel: <span id="level">1</span> | Vidas: <span id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span> | Puntos: <span id="score">0</span> | Skin: <span id="activeSkin">Default</span>
  <div class="premium" id="status">DEMO</div>
</div>

<div id="menu">
  <h1 style="font-size:60px;margin:0;color:#0f0;text-shadow:0 0 30px #0f0">VOID LEGACY X</h1>
  <h2>THUAMER STUDIOS‚Ñ¢ ‚Äî FIXED & READY</h2>
  <p id="slogan">¬°El vac√≠o ahora te caza de verdad!</p>
  <div id="paypal-premium"></div>
  <button onclick="startGame()">‚ñ∂Ô∏è JUGAR GRATIS</button>
  <button onclick="openShop()">üõí SKINS 0.49‚Ç¨ (PayPal)</button>
  <button onclick="toggleReadme()">üìñ INFO (F1)</button>
</div>

<div id="shop" class="hidden">
  <div id="shop-content">
    <h1>üõí TIENDA THUAMER SKINS</h1>
    <p>Skins √∫nicas por 0.49‚Ç¨ / 0.99‚Ç¨ ‚Äî ¬°Pagos reales PayPal!</p>
    <div id="paypal-cyber"></div>
    <div id="paypal-neon"></div>
    <div id="paypal-boss"></div>
    <button class="skin-btn" onclick="applySkin('cyber')">EQUIPAR CYBER (si comprado)</button>
    <button class="skin-btn" onclick="applySkin('neon')">EQUIPAR NEON</button>
    <button class="skin-btn" onclick="applySkin('boss')">EQUIPAR BOSS</button>
    <button onclick="closeShop()" style="background:#f00">‚Üê MEN√ö</button>
  </div>
</div>

<div id="readme" class="hidden">
  <div style="max-width:900px;max-height:80%;overflow-y:auto;background:#001100;padding:30px;border:3px double #0f0;color:#0f0;line-height:1.8">
    <h1>VOID LEGACY X ‚Äî FIXED EDITION</h1>
    <p><strong>‚úÖ TODO ARREGLADO:</strong> Enemigos letales, vidas reales, game over, skins PayPal, procedural infinito, IA que aprende.</p>
    <p><strong>Controles:</strong> ‚Üê ‚Üí Mover | ESPACIO Saltar | F1 README</p>
    <p><strong>Monetiza:</strong> Premium (vidas ‚àû) + Skins PayPal directo a ferry420oficial@gmail.com</p>
    <p><strong>Sube a itch.io:</strong> ZIP con este index.html ‚Üí HTML5 ‚Üí ¬°Listo!</p>
    <button onclick="toggleReadme()">CERRAR</button>
  </div>
</div>

<div id="gameover" class="hidden">
  <h1 style="color:#f00;font-size:50px">¬°CONSUMIDO POR EL VAC√çO!</h1>
  <h2>Nivel: <span id="finalLevel">0</span> | Puntos: <span id="finalScore">0</span></h2>
  <button onclick="location.reload()">üîÑ RENACER</button>
</div>

<script>
const LANG = navigator.language.slice(0,2) === 'es' ? 'es' : 'en';
const TEXTS = {
  es: { slogan: '¬°El vac√≠o ahora te caza de verdad!' },
  en: { slogan: 'The void now hunts you for real!' }
};
document.getElementById('slogan').textContent = TEXTS[LANG].slogan;

// PayPal CLIENT_ID: Ve a developer.paypal.com ‚Üí Crea app ‚Üí Copia Sandbox/Live Client ID
const CLIENT_ID = 'sb-CLIENT_ID_SANDBOX_PARA_PRUEBAS'; // CAMBIA POR EL REAL

// Premium PayPal
paypal.Buttons({
  createOrder: (data, actions) => actions.order.create({ purchase_units: [{ amount: { value: '4.99', currency_code: 'EUR' }, description: 'Premium VOID LEGACY X' }] }),
  onApprove: (data, actions) => actions.order.capture().then(() => {
    localStorage.setItem('thuamer_premium', 'true');
    alert('¬°Premium activado! Vidas infinitas.');
    location.reload();
  })
}).render('#paypal-premium');

// Skins PayPal
const SKINS = {
  cyber: { name: 'Cyber Void', price: '0.49', desc: 'Cyber Void Runner' },
  neon: { name: 'Neon Ghost', price: '0.49', desc: 'Neon Ghost' },
  boss: { name: 'Void Emperor', price: '0.99', desc: 'Void Emperor' }
};
['cyber','neon','boss'].forEach(skin => {
  paypal.Buttons({
    createOrder: (data, actions) => actions.order.create({ purchase_units: [{ amount: { value: SKINS[skin].price, currency_code: 'EUR' }, description: `${SKINS[skin].name} Skin - THUAMER` }] }),
    onApprove: (data, actions) => actions.order.capture().then(() => {
      let owned = JSON.parse(localStorage.getItem('thuamer_skins') || '[]');
      if (!owned.includes(skin)) owned.push(skin);
      localStorage.setItem('thuamer_skins', JSON.stringify(owned));
      alert(`¬°${SKINS[skin].name} desbloqueado! Equipa en tienda.`);
    })
  }).render(`#paypal-${skin}`);
});

let ownedSkins = JSON.parse(localStorage.getItem('thuamer_skins') || '[]');
let currentSkin = ownedSkins[0] || 'default';
document.getElementById('activeSkin').textContent = SKINS[currentSkin]?.name || 'Default';
const IS_PREMIUM = localStorage.getItem('thuamer_premium') === 'true';
document.getElementById('status').textContent = IS_PREMIUM ? 'PREMIUM' : 'DEMO';

function applySkin(skin) {
  if (ownedSkins.includes(skin) || skin === 'default') {
    currentSkin = skin;
    document.getElementById('activeSkin').textContent = SKINS[skin]?.name || 'Default';
    if (window.gameScene && window.gameScene.player) window.gameScene.player.setTexture(`player_${skin}`);
  } else alert('¬°Compra primero!');
}

// IA Brain
class ThuamerBrain {
  constructor() { this.memory = JSON.parse(localStorage.getItem('brain') || '{"jumps":0,"deaths":0}'); }
  learn(jump, death) {
    if (jump) this.memory.jumps++;
    if (death) this.memory.deaths++;
    this.memory.aggression = Math.min(5, (this.memory.deaths / Math.max(1, this.memory.jumps)) * 10);
    localStorage.setItem('brain', JSON.stringify(this.memory));
    return this.memory.aggression;
  }
}
const brain = new ThuamerBrain();

// Phaser
let gameScene, player, platforms, enemies, cursors, noise, level=1, lives=IS_PREMIUM?999:3, score=0;
const config = {
  type: Phaser.AUTO,
  width: 800,
  height: 600,
  physics: { default: 'arcade', arcade: { gravity: { y: 800 }, debug: false } },
  scene: { preload, create, update }
};
const game = new Phaser.Game(config);

function preload() {
  // SVGs skins
  const svgDefault = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiBmaWxsPSIjMDA4ODAwIi8+PHBhdGggZD0iTSAyMCAyMCBMIDQ0IDIwIEwgNDQgNDQgTCAyMCA0NCIgc3Ryb2tlPSIjMGYwIiBzdHJva2Utd2lkdGg9IjQiLz48L3N2Zz4=';
  this.load.svg('player_default', svgDefault);
  this.load.svg('player_cyber', SKINS.cyber.svg || svgDefault.replace('#008800','#0088ff'));
  this.load.svg('player_neon', SKINS.neon.svg || svgDefault.replace('#008800','#99ff00'));
  this.load.svg('player_boss', SKINS.boss.svg || svgDefault.replace('#008800','#cc0011'));
}

function create() {
  gameScene = this;
  noise = new SimplexNoise();
  platforms = this.physics.add.staticGroup();
  enemies = this.physics.add.group();
  cursors = this.input.keyboard.createCursorKeys();

  generateLevel();
  player = this.physics.add.sprite(100, 450, `player_${currentSkin}`).setScale(1.5).setBounce(0.1);
  player.setCollideWorldBounds(false);
  this.physics.add.collider(player, platforms);
  this.physics.add.overlap(player, enemies, loseLife, null, this);

  this.cameras.main.startFollow(player);
  this.cameras.main.setBounds(0, 0, 5000, 600);

  this.input.keyboard.on('keydown-SPACE', () => {
    if (player.body.touching.down) {
      player.setVelocityY(-500);
      brain.learn(true, false);
    }
  });
}

function update() {
  // Controles
  player.setVelocityX(0);
  if (cursors.left.isDown) player.setVelocityX(-250);
  if (cursors.right.isDown) player.setVelocityX(250);

  // Ca√≠da mortal
  if (player.y > 700) loseLife();

  // Avance nivel
  if (player.x > 3800) {
    advanceLevel();
  }

  // Respawn enemigos si pocos
  if (enemies.getLength() < 2) spawnEnemy();
}

function generateLevel() {
  platforms.clear(true, true);
  for (let x = 0; x < 5000; x += 100) {
    const y = Math.max(450, 550 + noise.noise2D(x * 0.01, level * 0.05) * 120);
    const plat = platforms.create(x, y, 'player_default').setScale(2.5, 0.6).setTint(0x004400).refreshBody();
    plat.body.allowGravity = false;
  }
}

function spawnEnemy() {
  const x = player.x + Phaser.Math.Between(400, 800);
  const y = 300 + Math.random() * 200;
  const enemy = enemies.create(x, y, 'player_default').setScale(1.2).setTint(0xff0000);
  enemy.setVelocityX(- (120 + level * 8 + brain.learn(false,false) * 20));
  enemy.setBounce(1, 0.5);
  enemy.setCollideWorldBounds(true);
  this.physics.add.collider(enemy, platforms);
}

function advanceLevel() {
  level++;
  score += level * 150;
  updateUI();
  player.x = 100;
  player.y = 450;
  generateLevel();
  spawnEnemy();
}

function loseLife() {
  lives--;
  brain.learn(false, true);
  updateUI();
  player.x = 100;
  player.y = 450;
  enemies.clear(true, true);
  if (lives <= 0) {
    document.getElementById('finalLevel').textContent = level;
    document.getElementById('finalScore').textContent = score;
    document.getElementById('gameover').classList.remove('hidden');
  }
}

function updateUI() {
  document.getElementById('level').textContent = level;
  document.getElementById('score').textContent = score;
  document.getElementById('lives').innerHTML = IS_PREMIUM ? '‚ù§Ô∏è‚àû' : '‚ù§Ô∏è'.repeat(Math.max(0, lives));
}

function startGame() {
  document.getElementById('menu').classList.add('hidden');
  updateUI();
}

function openShop() { document.getElementById('shop').classList.remove('hidden'); }
function closeShop() { document.getElementById('shop').classList.add('hidden'); }
function toggleReadme() { document.getElementById('readme').classList.toggle('hidden'); }
</script>
</body>
</html>