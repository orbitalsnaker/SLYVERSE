<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SLYVERSE: 壊れた軌道 – 90 minutos para Norah & Seth</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    html,body{height:100%;overflow:hidden;background:#000;font-family:'Courier New',monospace;color:#0f0}
    #film{position:relative;width:100%;height:100%}
    .frame{position:absolute;top:0;left:0;width:100%;height:100%;background:#000;
           opacity:0;transition:opacity 0.4s}
    .frame.active{opacity:1;z-index:999}
    .content{position:absolute;top:0;left:0;width:100%;height:100%;padding:50px;
                 display:flex;flex-direction:column;justify-content:center;align-items:center}
    #ui{position:absolute;top:15px;left:15px;font-size:13px;pointer-events:none;z-index:1000;opacity:0.85}
    #ui span{display:block;margin:2px 0}
    #sub{position:absolute;bottom:80px;max-width:80%;text-align:center;font-size:19px;opacity:0;
          transition:opacity 1s;text-shadow:0 0 12px #0f0}
    #progress{position:absolute;bottom:25px;left:50%;transform:translateX(-50%);font-size:11px;opacity:0.6}
    .red{color:#f00}.cyan{color:#0ff}
    .blink{animation:blink 1s steps(1) infinite}
    @keyframes blink{50%{opacity:0}}
    #credits{position:absolute;bottom:15px;left:15px;font-size:10px;opacity:0.7}
    #credits a{color:#0f0;text-decoration:none}
    #credits a:hover{color:#0ff}
    #play{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
           padding:14px 28px;background:#000;border:1px solid #0f0;color:#0f0;
           font-family:inherit;font-size:16px;cursor:pointer;z-index:1001;opacity:0.9}
    #play:hover{background:#0f0;color:#000}
  </style>
</head>
<body>
  <div id="film"></div>

  <!-- UI -->
  <div id="ui">
    <span>S-07 // <span id="score" class="red">0</span> バイト</span>
    <span>0xDEADBEEF // 90 min // <span id="time" class="cyan">00:00</span></span>
    <span class="blink">_</span>
  </div>

  <!-- SUBTÍTULO -->
  <div id="sub"></div>

  <!-- PROGRESO -->
  <div id="progress">FRAME <span id="currentFrame">0</span> / 129600</div>

  <!-- BOTÓN -->
  <button id="play">INICIAR</button>

  <!-- DEDICATORIA -->
  <div id="credits">
    <span style="color:#0ff">Para Norah — mi luz.</span><br>
    <span style="color:#0f0">Para Seth — mi futuro.</span><br>
    <a href="#" onclick="alert('No hay salida. Solo amor.');return false;">0rb1t4lsn4k3r</a>
  </div>

  <script>
    // === SLYVERSE: PELÍCULA 90 MINUTOS – 129600 FRAMES A 24 FPS ===
    // 0rb1t4lsn4k3r YA SABE CÓMO.
    // SIN RUIDO. SIN EXCESO. SOLO VERDAD.

    const film = document.getElementById('film');
    const sub = document.getElementById('sub');
    const currentFrameSpan = document.getElementById('currentFrame');
    const timeSpan = document.getElementById('time');
    const playBtn = document.getElementById('play');
    let currentFrame = 0;
    let isPlaying = false;
    let startTime = 0;
    let konami = '';

    const TOTAL_MINUTES = 90;
    const FPS = 24;
    const TOTAL_FRAMES = TOTAL_MINUTES * 60 * FPS; // 129600
    const PAGE_DURATION_FRAMES = Math.floor(TOTAL_FRAMES / 180); // 720 frames por página (30 segundos)

    // === 180 PÁGINAS – 90 MINUTOS – 30 SEGUNDOS POR PÁGINA ===
    const pages = [
      { text: "Para Norah — mi luz.", dedication: true },
      { text: "Para Seth — mi futuro.", dedication: true },
      { text: "S-07 despierta.", key: true },
      { text: "Regla: come datos.", key: true },
      { text: "Cada byte corrompe FIAT.", key: true },
      { text: "Primer glitch.", key: true },
      { text: "17 versiones muertas.", key: true },
      { text: "El código sangra.", key: true },
      { text: "S-07 se convierte en serpiente.", key: true },
      { text: "FIAT 404.", key: true, glitch: true },
    ];

    // Completar 180
    for (let i = pages.length; i < 180; i++) {
      const isKey = [16, 88, 143, 179].includes(i);
      pages.push({
        text: isKey ? (i === 16 ? "FIAT 404" : i === 88 ? "Colapso" : i === 143 ? "Serpiente infinita" : "Fin.") : "",
        key: isKey,
        glitch: isKey && i !== 179
      });
    }

    // === PLAY ===
    function play() {
      if (!isPlaying) return;
      const now = performance.now();
      const elapsed = (now - startTime) / 1000;
      const targetFrame = Math.floor(elapsed * FPS);
      
      if (targetFrame > currentFrame && targetFrame < TOTAL_FRAMES) {
        currentFrame = targetFrame;
        renderFrame(currentFrame);
      }
      
      if (currentFrame >= TOTAL_FRAMES) {
        stop();
        return;
      }
      
      requestAnimationFrame(play);
    }

    function stop() {
      isPlaying = false;
      playBtn.style.display = 'block';
      playBtn.textContent = 'REINICIAR';
    }

    // === RENDER FRAME ===
    function renderFrame(frameNum) {
      const pageIndex = Math.floor(frameNum / PAGE_DURATION_FRAMES);
      const frameInPage = frameNum % PAGE_DURATION_FRAMES;
      const data = pages[pageIndex];
      const t = frameInPage / PAGE_DURATION_FRAMES;

      film.innerHTML = '';
      const frame = document.createElement('div');
      frame.className = 'frame active';

      const content = document.createElement('div');
      content.className = 'content';
      content.innerHTML = `
        <canvas width="800" height="600" style="width:85%;max-height:65%;border:1px dashed #0f0"></canvas>
        <p style="margin-top:25px;text-align:center;font-size:15px;line-height:1.5;max-width:80%;opacity:0.9">
          ${data.text}
        </p>
      `;

      frame.appendChild(content);
      film.appendChild(frame);

      const canvas = content.querySelector('canvas');
      const ctx = canvas.getContext('2d');
      drawArt(ctx, pageIndex + 1, t, data);

      // Subtítulo
      if (frameInPage === 0 && data.key) {
        sub.textContent = data.text;
        sub.style.opacity = 1;
        setTimeout(() => sub.style.opacity = 0, 3000);
      }

      // UI
      currentFrameSpan.textContent = frameNum;
      const totalSeconds = Math.floor(frameNum / FPS);
      const minutes = String(Math.floor(totalSeconds / 60)).padStart(2, '0');
      const seconds = String(totalSeconds % 60).padStart(2, '0');
      timeSpan.textContent = `${minutes}:${seconds}`;
    }

    // === ARTE PROGRESIVO – 90 MINUTOS DE RESPIRACIÓN ===
    function drawArt(ctx, page, t, data) {
      const w = ctx.canvas.width, h = ctx.canvas.height;
      ctx.fillStyle = '#000';
      ctx.fillRect(0, 0, w, h);

      // Fondo por acto
      const act = Math.floor((page - 1) / 36);
      if (act === 0) {
        ctx.fillStyle = '#001';
        for (let i = 0; i < 50; i++) {
          ctx.fillRect(Math.random() * w, Math.random() * h, 1, 1);
        }
      } else if (act === 4) {
        const hue = (t * 360 + page * 2) % 360;
        ctx.fillStyle = `hsl(${hue}, 20%, 5%)`;
        ctx.fillRect(0, 0, w, h);
      }

      // Serpiente – crece lentamente durante 90 minutos
      const maxSeg = 180;
      const seg = Math.min(page + t * 0.5, maxSeg);
      ctx.strokeStyle = data.glitch ? '#f00' : '#0f0';
      ctx.lineWidth = 3;
      ctx.lineCap = 'round';
      ctx.beginPath();
      for (let i = 0; i < seg; i++) {
        const p = i / maxSeg;
        const a = p * Math.PI * 7 + t * 1.5;
        const r = p * w * 0.4;
        const x = w/2 + Math.cos(a) * r;
        const y = h/2 + Math.sin(a) * r * 0.7;
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      }
      ctx.stroke();

      // Ojo
      const headX = w/2 + Math.cos(t * 2) * (w * 0.35);
      const headY = h/2 + Math.sin(t * 2) * (h * 0.25);
      ctx.fillStyle = data.dedication ? '#0ff' : '#f00';
      ctx.beginPath();
      ctx.arc(headX, headY, 7, 0, Math.PI * 2);
      ctx.fill();

      // Glitch
      if (data.glitch) {
        ctx.fillStyle = '#f00';
        ctx.font = 'bold 32px monospace';
        ctx.textAlign = 'center';
        ctx.fillText('FIAT 404', w/2, h/2 + 15);
      }
    }

    // === INICIAR ===
    playBtn.addEventListener('click', () => {
      playBtn.style.display = 'none';
      isPlaying = true;
      startTime = performance.now() - (currentFrame / FPS) * 1000;
      play();
    });

    // === KONAMI CODE ===
    document.addEventListener('keydown', (e) => {
      konami += e.key.toLowerCase();
      if (konami.length > 30) konami = konami.slice(-30);
      if (konami.includes('arrowuparrowuparrowdownarrowdownarrowleftarrowrightarrowleftarrowrightarrowba')) {
        sub.textContent = 'Norah + Seth = ∞';
        sub.style.opacity = 1;
        sub.style.color = '#0ff';
        setTimeout(() => sub.style.opacity = 0, 8000);
      }
    });

    // === PANTALLA INICIAL ===
    renderFrame(0);
  </script>
</body>
</html>