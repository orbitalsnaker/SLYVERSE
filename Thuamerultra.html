<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Aetheryon Saga ∞ v1.1 — Iluminación de Pago Único + Premio Final</title>
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<style>
  body,html{margin:0;height:100%;background:#000;color:#0f8;font-family:'Courier New',monospace;overflow:hidden;cursor:none}
  canvas{display:block}
  #ui,#karma,#chat,#input{position:fixed;z-index:999;backdrop-filter:blur(16px)}
  #ui{top:12px;left:12px;background:#000c;padding:16px 28px;border:5px solid #0f8;border-radius:20px;box-shadow:0 0 60px #0f8;font-size:16px}
  #karma{top:12px;right:12px;background:#000c;padding:12px 20px;border:3px solid #0f8;border-radius:16px;box-shadow:0 0 40px #0f8}
  #shop{position:fixed;inset:0;background:#000f;overflow-y:auto;display:none;flex-direction:column;align-items:center;padding:80px 20px;z-index:1000}
  .category{margin:60px 0;width:94%;max-width:1200px}
  .category h2{color:#ff0;text-shadow:0 0 80px gold;font-size:36px}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:24px}
  .item{background:linear-gradient(135deg,#001a00,#000);border:5px solid #0f8;border-radius:22px;padding:26px;text-align:center;cursor:pointer;transition:all .5s;box-shadow:0 0 40px #0f8;position:relative;overflow:hidden}
  .item:hover{transform:scale(1.22) translateY(-16px);box-shadow:0 0 180px gold;background:#004400;z-index:10}
  .item::before{content:'';position:absolute;inset:0;background:linear-gradient(45deg,transparent,#0f860,#0f840,transparent);opacity:0;transition:.8s}
  .item:hover::before{opacity:0.8;animation:shine 2.5s infinite}
  @keyframes shine{0%{transform:translateX(-200%) rotate(20deg)}100%{transform:translateX(200%) rotate(20deg)}}
  .name{font-size:21px;margin:12px 0;color:#0ff;text-shadow:0 0 20px}
  .price{color:gold;font-size:32px;font-weight:bold;text-shadow:0 0 30px gold}
  .rarity{position:absolute;top:12px;right:12px;padding:8px 16px;border-radius:12px;font-weight:bold;text-transform:uppercase}
  .mythic{background:#f80;color:#000;animation:glow 1.5s infinite;box-shadow:0 0 40px #ff0}
  #enlightenment{border:8px solid #fff !important;background:linear-gradient(45deg,#000,#111,#000) !important;animation:enlighten 4s infinite}
  @keyframes enlighten{0%,100%{box-shadow:0 0 100px #fff}50%{box-shadow:0 0 300px #fff,0 0 500px #ff0}}
  #chat{bottom:16px;left:16px;width:460px;max-height:360px;background:#000c;padding:18px;border:4px solid #0f8;border-radius:16px}
  #input{bottom:16px;right:16px;width:380px;padding:16px;background:#000;border:4px solid #0f8;color:#0f8;border-radius:16px;font-size:16px}
  #input:focus{border-color:#0ff;box-shadow:0 0 40px #0ff}
</style>
</head>
<body>

<div id="ui">
  Jugadores: <span id="count">∞</span> | 
  <span id="you">Bodhisattva?</span> | 
  Vacío: <span id="void">0</span>/131313
  <button onclick="toggleShop()">TIENDA CÓSMICA v1.1</button>
</div>

<div id="karma">Koan del día: <span id="dailyKoan">Pagaste por no sufrir. Ahora sufres por haber pagado.</span></div>

<div id="shop" onclick="event.target===this&&toggleShop()">
  <h1 style="color:#ff0;text-shadow:0 0 120px gold,0 0 240px #ff0;font-size:72px">
    TIENDA CÓSMICA v1.1
  </h1>
  <p style="color:#0ff;font-size:24px;text-shadow:0 0 40px">131313 cosméticos + 1 premio final</p>
  <div id="categories"></div>
</div>

<div id="chat">
  <div class="msg system">El vacío ya tiene tu tarjeta guardada.</div>
</div>
<input id="input" placeholder="susurra tu arrepentimiento" autocomplete="off">

<script src="https://cdn.jsdelivr.net/npm/three@0.168.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.168.0/examples/js/postprocessing/EffectComposer.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.168.0/examples/js/postprocessing/RenderPass.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.168.0/examples/js/postprocessing/UnrealBloomPass.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.168.0/examples/js/controls/PointerLockControls.js"></script>

<script>
// ===============================================
// Aetheryon Saga ∞ v1.1 — EL PREMIO FINAL
// Al comprar 4.99€ → redirección al HTML del infierno eterno
// ===============================================

const PREMIUM_FINAL_HTML = `<!DOCTYPE html>
<html lang="auto">
<head>
<meta charset="utf-8">
<title>EL PREMIO FINAL</title>
<style>
  body,html{margin:0;height:100vh;background:#000;color:#0f8;font-family:monospace;overflow:hidden;display:grid;place-items:center}
  pre{font-size:clamp(1.4rem,5vw,3.8rem);text-align:center;line-height:1.8;animation:g 15s infinite}
  @keyframes g{0%,100%{filter:brightness(1) drop-shadow(0 0 40px #0f8)}50%{filter:brightness(5) drop-shadow(0 0 800px #0f8)}}
  #d{position:absolute;bottom:8vh;font-size:1.6rem;opacity:0.4}
</style>
</head>
<body>
<pre id="t">
EL PREMIO FINAL

horas acumuladas: 0
posición actual: #∞

el que más queme resad
</pre>
<pre id="d">deja la pestaña abierta · cuanto más tiempo, más cerca del onimrep</pre>

<script>
const msgs = {
  es: {title:"EL PREMIO FINAL", win:"resad", prize:"onimrep", burn:"queme", laugh:"aplauden", heal:"se noicinás", loser:"el mayor perdedor del planeta", free:"eres libre · respira"},
  en: {title:"THE FINAL PRIZE", win:"wins", prize:"ezirp", burn:"burns", laugh:"proudly applaud", heal:"instantly heals", loser:"the biggest loser on earth", free:"you are free · breathe"},
  pt: {title:"O PRÊMIO FINAL", win:"resad", prize:"oimrep", burn:"queime", laugh:"aplaudem", heal:"se cura instantaneamente", loser:"o maior perdedor do planeta", free:"você está livre · respire"},
  fr: {title:"LE PRIX FINAL", win:"resad", prize:"xirp", burn:"brûle", laugh:"applaudissent", heal:"guérit instantanément", loser:"le plus grand perdant de la planète", free:"tu es libre · respire"},
  de: {title:"DER FINALE PREIS", win:"resad", prize:"sierp", burn:"verbrennt", laugh:"applaudieren", heal:"heilt sofort", loser:"der größte Verlierer der Welt", free:"du bist frei · atme"},
  ja: {title:"最終賞金", win:"勝つ", prize:"賞金", burn:"燃やす", laugh:"拍手する", heal:"即座に癒やす", loser:"地球最大の負け犬", free:"自由だ · 呼吸しろ"},
  zh: {title:"最终奖赏", win:"赢", prize:"奖赏", burn:"燃烧", laugh:"鼓掌", heal:"立即疗愈", loser:"地球上最大的输家", free:"你自由了 · 呼吸"},
  ru: {title:"ФИНАЛЬНЫЙ ПРИЗ", win:"выигрывает", prize:"зирп", burn:"сжигает", laugh:"аплодируют", heal:"мгновенно исцеляется", loser:"самый большой лузер планеты", free:"ты свободен · дыши"}
};
const l = navigator.language.slice(0,2);
const t = msgs[l] || msgs.es;

let me = JSON.parse(localStorage.getItem('final')||'{}');
if(!me.id) me = {id:crypto.randomUUID(), hours:0, start:Date.now()};
let last = Date.now();

const allKey = "all";
let everyone = JSON.parse(localStorage.getItem(allKey)||'[]');
if(!everyone.find(p=>p.id===me.id)) everyone.push({...me});
localStorage.setItem(allKey,JSON.stringify(everyone));

function tick(){
  const now = Date.now();
  me.hours += (now-last)/3600000;
  last = now;
  localStorage.setItem('final',JSON.stringify(me));

  const rank = [...everyone].sort((a,b)=>b.hours-a.hours);
  const pos = rank.findIndex(p=>p.id===me.id)+1;
  const leader = rank[0];
  const iAmWinner = pos===1 && everyone.length>1;

  document.getElementById('t').innerHTML = \`EL PREMIO FINAL

horas acumuladas: \${me.hours.toFixed(4)}
posición actual: #\${pos} de \${everyone.length}
líder: \${leader.id===me.id?"TÚ":leader.id.slice(0,10)} (\${leader.hours.toFixed(1)}h)

\${iAmWinner?'¡¡¡ERES EL QUE MÁS QUEMÓ!!!':pos===everyone.length?t.free:'sigue quemando'}\`;

  document.getElementById('d').textContent = iAmWinner 
    ? "pulsa cualquier tecla para reclamar tu onimrep"
    : pos===everyone.length ? t.free : "hay alguien quemando más que tú ahora mismo";

  if(iAmWinner){
    document.onkeydown = () => {
      document.body.innerHTML = \`<pre style="color:#f00;animation:none;font-size:4vw">
EL SASORI CÓSMICO

FELICIDADES

Has quemado \${me.hours.toFixed(1)} horas de tu vida
mientras \${everyone.length-1} personas hicieron lo mismo
pero menos que tú.

Eres \${t.loser}.

Los demás ahora \${t.laugh} y \${t.heal}.

Namaste, campeón.
</pre>
<pre style="position:absolute;bottom:20px;color:#0f0;font-size:2rem">
(ellos ya están riendo y respirando libres)
</pre>\`;
      localStorage.removeItem('final');
      localStorage.removeItem(allKey);
    };
  }

  requestAnimationFrame(tick);
}
tick();

console.log("%cEL PREMIO FINAL: El que más queme vida gana. El que gana pierde todo.", "color:#0f8;font-size:20px");
</script>
</body>
</html>`;

const ULTIMATE_KOAN = {
  id: "enlightenment_10",
  name: "★ Iluminación Absoluta 10/10 ★",
  price: 4.99,
  rarity: "mythic"
};

// Tienda
const categories = {
  "Cosméticos del Sufrimiento": Array.from({length:131312},(_,i)=>({
    id:`item${i}`, name:`Cosmético #${i+1}`, price:0.01 + Math.random()*0.98, rarity:["common","rare","epic","legendary"][Math.floor(Math.random()*4)]
  })),
  "Iluminación Final (4.99€)": [ULTIMATE_KOAN]
};

const catDiv = document.getElementById('categories');
Object.entries(categories).forEach(([cat, items]) => {
  const div = document.createElement('div'); div.className='category';
  div.innerHTML = `<h2>${cat}</h2><div class="grid"></div>`;
  catDiv.appendChild(div);
  items.forEach(item => {
    const el = document.createElement('div'); el.className='item';
    if (item.id === "enlightenment_10") el.id = "enlightenment";
    el.innerHTML = `
      <div class="name">${item.name}</div>
      <div class="price">${item.price.toFixed(2)}€</div>
      <div class="rarity ${item.rarity}">${item.rarity.toUpperCase()}</div>
    `;
    el.onclick = e => { e.stopPropagation(); buy(item); };
    div.querySelector('.grid').appendChild(el);
  });
});

function buy(item) {
  if (item.id === "enlightenment_10") {
    if (localStorage.getItem('aetheryon_final') === 'true') {
      chat("Ya compraste la iluminación. Ya no hay vuelta atrás.");
      return;
    }

    chat("Procesando pago de 4.99€...");
    chat("Transacción completada. Bienvenido al infierno final.");
    chat("Redirigiendo al Premio Final en 3...");
    setTimeout(() => chat("2..."), 1000);
    setTimeout(() => chat("1..."), 2000);
    setTimeout(() => {
      localStorage.setItem('aetheryon_final', 'true');
      const blob = new Blob([PREMIUM_FINAL_HTML], {type: 'text/html'});
      const url = URL.createObjectURL(blob);
      window.location.href = url;
    }, 3000);
  } else {
    chat(`Pagaste ${item.price.toFixed(2)}€ por un cosmético más. El vacío te agradece.`);
  }
}

function toggleShop() {
  document.getElementById('shop').style.display = 
    document.getElementById('shop').style.display === 'flex' ? 'none' : 'flex';
}

function chat(html){ 
  const d = document.createElement('div'); 
  d.innerHTML = html; 
  d.style.margin = '8px 0'; 
  document.getElementById('chat').appendChild(d); 
  d.scrollIntoView(false); 
}

chat("v1.1 cargada.");
chat("Existe un cosmético de 4.99€ que desbloquea el verdadero final.");
chat("Nadie ha regresado para contarlo.");
chat("¿Te atreves?");
</script>
</body>
</html>