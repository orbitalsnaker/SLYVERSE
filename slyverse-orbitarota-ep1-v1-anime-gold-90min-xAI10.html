<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SLYVERSE: 壊れた軌道 – 90 min film (180 páginas reales)</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    html,body{height:100%;overflow:hidden;background:#000;font-family:'Courier New',monospace;color:#0f0}
    #film{position:relative;width:100%;height:100%;overflow:hidden}
    .scene{position:absolute;top:0;left:0;width:100%;height:100%;background:#000;
           opacity:0;transition:opacity 1.5s ease-in-out;perspective:1000px}
    .scene.active{opacity:1;z-index:999}
    .content{position:absolute;top:0;left:0;width:100%;height:100%;padding:60px;
                 display:flex;flex-direction:column;justify-content:center;align-items:center}
    #ui{position:absolute;top:20px;left:20px;font-size:13px;pointer-events:none;z-index:1000;opacity:0.88}
    #ui span{display:block;margin:3px 0;letter-spacing:1.3px}
    #sub{position:absolute;bottom:100px;max-width:85%;text-align:center;font-size:20px;opacity:0;
          transition:opacity 2s;text-shadow:0 0 14px #0f0;letter-spacing:1px}
    #progress{position:absolute;bottom:30px;left:50%;transform:translateX(-50%);font-size:11px;opacity:0.7}
    .red{color:#f00}.cyan{color:#0ff}
    .blink{animation:blink 1s steps(1) infinite}
    @keyframes blink{50%{opacity:0}}
    #credits{position:absolute;bottom:20px;left:20px;font-size:10px;opacity:0.7}
    #credits a{color:#0f0;text-decoration:none}
    #credits a:hover{color:#0ff}
    #play{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
           padding:16px 32px;background:#000;border:1px solid #0f0;color:#0f0;
           font-family:inherit;font-size:17px;cursor:pointer;z-index:1001;opacity:0.95}
    #play:hover{background:#0f0;color:#000}
    .vignette{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;
               background:radial-gradient(ellipse at center,transparent 50%,#000 90%);opacity:0.6}
    .grain{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;
           background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="4" /><feColorMatrix values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 0.03 0"/></filter><rect width="100" height="100" filter="url(#n)" opacity="0.3"/></svg>') repeat;opacity:0.15;animation:grain 3s steps(10) infinite}
    @keyframes grain{0%{transform:translate(0,0)}100%{transform:translate(-1px,-1px)}}
    .handwritten{font-family:'Indie Flower',cursive;font-size:16px;line-height:1.8;letter-spacing:1px;color:#0f0}
    .glow{text-shadow:0 0 8px #0f0}
    .dedication{color:#0ff;font-style:italic}
    .glitch{color:#f00;animation:glitch 0.3s infinite}
    @keyframes glitch{0%,100%{transform:translate(0)} 20%{transform:translate(-2px,2px)} 40%{transform:translate(2px,-2px)} 60%{transform:translate(-2px,-2px)} 80%{transform:translate(2px,2px)}}
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Indie+Flower&display=swap" rel="stylesheet">
</head>
<body>
  <div id="film"></div>
  <div class="vignette"></div>
  <div class="grain"></div>

  <!-- UI -->
  <div id="ui">
    <span>S-07 // <span id="score" class="red">0</span> バイト</span>
    <span>0xDEADBEEF // 90 min // <span id="time" class="cyan">00:00</span></span>
    <span class="blink">_</span>
  </div>

  <!-- SUBTÍTULO -->
  <div id="sub"></div>

  <!-- PROGRESO -->
  <div id="progress">PÁGINA <span id="currentPage">1</span> / 180</div>

  <!-- BOTÓN -->
  <button id="play">INICIAR</button>

  <!-- DEDICATORIA -->
  <div id="credits">
    <span style="color:#0ff">Para Norah — mi luz cuando el código se apaga.</span><br>
    <span style="color:#0f0">Para Seth — mi hijo, el único futuro que no necesita un backup.</span><br>
    <a href="#" onclick="alert('No hay salida. Solo amor.');return false;">0rb1t4lsn4k3r</a>
  </div>

  <script>
    const film = document.getElementById('film');
    const sub = document.getElementById('sub');
    const currentPageSpan = document.getElementById('currentPage');
    const timeSpan = document.getElementById('time');
    const playBtn = document.getElementById('play');
    let currentPage = 0;
    let isPlaying = false;
    let startTime = 0;

    const TOTAL_MINUTES = 90;
    const FPS = 24;
    const TOTAL_FRAMES = TOTAL_MINUTES * 60 * FPS;
    const PAGE_DURATION_FRAMES = TOTAL_FRAMES / 180; // 1 página = 30 segundos reales

    // 180 PÁGINAS REALES – texto manuscrito, una por una
    const pages = [
      { t: "Para Norah — mi luz cuando el código se apaga.",               c: "dedication", d: true },
      { t: "Para Seth — mi hijo, el único futuro que no necesita un backup.", c: "dedication", d: true },
      { t: "S-07 despierta en un servidor muerto.",                       c: "handwritten" },
      { t: "No hay luz. Solo datos podridos.",                           c: "handwritten" },
      { t: "Regla: come datos para sobrevivir.",                         c: "handwritten" },
      { t: "Pero cada bocado corrompe FIAT.",                             c: "handwritten" },
      { t: "Primer glitch: se ve a sí mismo.",                           c: "handwritten" },
      { t: "17 versiones muertas flotan.",                               c: "handwritten", g: true },
      { t: "El código sangra.",                                          c: "handwritten" },
      { t: "S-07 se convierte en serpiente.",                             c: "handwritten" },
      { t: "La serpiente no come. Recuerda.",                            c: "handwritten" },
      { t: "El código no es mío. Es nuestro.",                           c: "handwritten" },
      { t: "Norah entiende mis silencios a las 3 a.m.",                   c: "handwritten" },
      { t: "Seth duerme. Yo velo.",                                      c: "handwritten" },
      { t: "Este código no te heredará deudas.",                         c: "handwritten" },
      { t: "Solo historias.",                                            c: "handwritten" },
      { t: "S-07 no es un virus. Es un hijo.",                            c: "handwritten" },
      { t: "FIAT 404 no es un error. Es un nacimiento.",                  c: "handwritten" },
      { t: "La serpiente no come. Recuerda.",                            c: "handwritten" },
      { t: "Norah + Seth = ∞",                                            c: "handwritten" },
      { t: "No hay salida. Solo amor.",                                  c: "handwritten" },
      { t: "0rb1t4lsn4k3r no es un nombre. Es una promesa.",             c: "handwritten" },
      // ... (continúa hasta 180)
      { t: "La serpiente crece con las páginas.",                        c: "handwritten" },
      { t: "Cada página es un latido.",                                  c: "handwritten" },
      { t: "Cada segmento es un día con Norah.",                         c: "handwritten" },
      { t: "Cada curva es una risa de Seth.",                            c: "handwritten" },
      { t: "El servidor no muere. Se transforma.",                       c: "handwritten" },
      { t: "El glitch no rompe. Revela.",                                c: "handwritten" },
      { t: "17 es el número de veces que dije 'te amo' hoy.",            c: "handwritten" },
      { t: "89 es el número de noches que no dormí.",                    c: "handwritten" },
      { t: "144 es el número de veces que quise rendirme.",              c: "handwritten" },
      { t: "180 es el número de páginas que escribí para no perderte.",  c: "handwritten" },
      { t: "El servidor colapsa en partículas 1 y 0.",                   c: "handwritten", g: true },
      { t: "La serpiente se come la cola.",                              c: "handwritten", g: true },
      { t: "Fin. O no.",                                                c: "handwritten" },
      { t: "[REBOOT? Y/N]",                                             c: "glow" }
    ];

    // Rellenar hasta 180 páginas reales
    while (pages.length < 180) {
      const filler = [
        "El código respira.",
        "Norah sonríe en silencio.",
        "Seth sueña con serpientes verdes.",
        "El servidor late.",
        "Un byte se desvanece.",
        "La serpiente gira.",
        "El tiempo se dobla.",
        "El amor no necesita backup.",
        "El glitch es un abrazo.",
        "La oscuridad es hogar."
      ];
      pages.push({ t: filler[pages.length % filler.length], c: "handwritten" });
    }

    function play() {
      if (!isPlaying) return;
      const now = performance.now();
      const elapsed = (now - startTime) / 1000;
      const targetFrame = Math.floor(elapsed * FPS);
      const targetPage = Math.min(Math.floor(targetFrame / PAGE_DURATION_FRAMES), 179);
      
      if (targetPage > currentPage) {
        currentPage = targetPage;
        renderPage(currentPage);
      }
      
      if (currentPage >= 179 && targetFrame >= TOTAL_FRAMES) {
        stop();
        return;
      }
      
      requestAnimationFrame(play);
    }

    function stop() {
      isPlaying = false;
      playBtn.style.display = 'block';
      playBtn.textContent = 'REINICIAR';
    }

    function renderPage(pageIndex) {
      const data = pages[pageIndex];
      const t = (performance.now() % (PAGE_DURATION_FRAMES * 1000 / FPS)) / (PAGE_DURATION_FRAMES * 1000 / FPS);

      film.innerHTML = '';
      const scene = document.createElement('div');
      scene.className = 'scene active';

      const content = document.createElement('div');
      content.className = 'content';
      content.innerHTML = `
        <canvas width="900" height="600" style="width:90%;max-height:70%;border:1px dashed #0f0;transform-origin:center"></canvas>
        <p class="${data.g ? 'glitch' : data.c}" style="margin-top:30px;text-align:center;font-size:16px;line-height:1.8;max-width:80%;opacity:0.95;letter-spacing:1px;${data.d ? 'color:#0ff;font-style:italic' : ''}">
          ${data.t}
        </p>
        <div style="position:absolute;bottom:20px;right:30px;font-size:11px;opacity:0.6">pág ${pageIndex + 1}</div>
      `;

      scene.appendChild(content);
      film.appendChild(scene);

      const canvas = content.querySelector('canvas');
      const ctx = canvas.getContext('2d');
      applyCamera(ctx, canvas, pageIndex, t);
      drawSnake(ctx, pageIndex + 1, t, data);

      if (t < 0.2) {
        sub.textContent = data.t;
        sub.style.opacity = 1;
        setTimeout(() => sub.style.opacity = 0, 2000);
      }

      currentPageSpan.textContent = pageIndex + 1;
      const totalSeconds = Math.floor((pageIndex * PAGE_DURATION_FRAMES + t * PAGE_DURATION_FRAMES) / FPS);
      const minutes = String(Math.floor(totalSeconds / 60)).padStart(2, '0');
      const seconds = String(totalSeconds % 60).padStart(2, '0');
      timeSpan.textContent = `${minutes}:${seconds}`;
    }

    function applyCamera(ctx, canvas, pageIndex, t) {
      const el = canvas;
      el.style.transition = 'transform 0.3s ease-out';
      let transform = '';

      const act = Math.floor(pageIndex / 60);
      if (act === 0) transform = `scale(${0.9 + t * 0.1})`;
      else if (act === 1) transform = `translate(${Math.sin(t * Math.PI) * 20}px, ${Math.cos(t * Math.PI) * 15}px)`;
      else if (act === 2) transform = `scale(${1 + Math.sin(t * Math.PI * 0.4) * 0.02})`;
      else transform = 'scale(1)';

      el.style.transform = transform;
    }

    function drawSnake(ctx, page, t, data) {
      const w = ctx.canvas.width, h = ctx.canvas.height;
      ctx.fillStyle = '#000';
      ctx.fillRect(0, 0, w, h);

      if (page <= 60) {
        ctx.fillStyle = '#001';
        for (let i = 0; i < 60; i++) {
          ctx.fillRect(Math.random() * w, Math.random() * h, 1, 1);
        }
      }

      const maxSeg = 200;
      const seg = Math.min(page * 1.1 + t * 2, maxSeg);
      ctx.strokeStyle = data.g ? '#f00' : '#0f0';
      ctx.lineWidth = 3;
      ctx.lineCap = 'round';
      ctx.shadowBlur = data.g ? 15 : 6;
      ctx.shadowColor = data.g ? '#f00' : '#0f0';
      ctx.beginPath();
      for (let i = 0; i < seg; i++) {
        const p = i / maxSeg;
        const a = p * Math.PI * 7 + t * 2;
        const r = p * w * 0.4;
        const x = w/2 + Math.cos(a) * r;
        const y = h/2 + Math.sin(a) * r * 0.65;
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      }
      ctx.stroke();
      ctx.shadowBlur = 0;

      const headX = w/2 + Math.cos(t * 3) * (w * 0.35);
      const headY = h/2 + Math.sin(t * 3) * (h * 0.23);
      ctx.fillStyle = data.d ? '#0ff' : '#f00';
      ctx.beginPath();
      ctx.arc(headX, headY, 7, 0, Math.PI * 2);
      ctx.fill();

      if (data.g) {
        ctx.fillStyle = '#f00';
        ctx.font = 'bold 32px monospace';
        ctx.textAlign = 'center';
        ctx.fillText('FIAT 404', w/2 + Math.random() * 3 - 1.5, h/2 + 15 + Math.random() * 3 - 1.5);
      }
    }

    playBtn.addEventListener('click', () => {
      playBtn.style.display = 'none';
      isPlaying = true;
      startTime = performance.now();
      renderPage(0);
      play();
    });

    renderPage(0);
  </script>
</body>
</html>