<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>THUAMER CONSOL√Ü ULTIMATE - 100% GRATIS FOREVER (REM√ÅSTERS + IA TROLLEA)</title>
  <meta name="description" content="La √öNICA consola que te INSULTA, te HUMILLA y te hace RAGE QUIT. Remasters que mean en los originales + IA que conoce tu nombre.">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --color-pijo: #ffea00;
      --color-trola: #ff0048;
      --skin: default;
    }
    
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
    
    * { box-sizing: border-box; }
    body,html {
      margin:0; padding:0; height:100%; 
      background: linear-gradient(-45deg, #1a0033, #000011, #330066, #000);
      background-size: 400% 400%;
      animation: gradientShift 8s ease infinite;
      color:#fff;
      font-family: 'Press Start 2P', Impact, 'Arial Black', sans-serif;
      overflow:hidden;
    }
    
    @keyframes gradientShift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    
    @keyframes glitch {
      0% { transform: translate(0); }
      20% { transform: translate(-2px, 2px); }
      40% { transform: translate(-2px, -2px); }
      60% { transform: translate(2px, 2px); }
      80% { transform: translate(2px, -2px); }
      100% { transform: translate(0); }
    }
    
    @keyframes vapor {
      0%{background-position:0% 50%;}
      50%{background-position:100% 50%;}
      100%{background-position:0% 50%;}
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    
    .glitch { animation: glitch 0.3s linear infinite; }
    .pijo {
      background: linear-gradient(45deg,gold,#ffea00,#ff77ff,#00ffff,#ff0048);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      font-size: 6vw !important;
      animation: pulse 2s infinite;
    }
    
    #screen {
      border: 20px solid #333;
      border-image: url('data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22100%22 height=%22100%22><rect width=%22100%22 height=%22100%22 fill=%22%23ffea00%22/><text x=%2250%22 y=%2260%22 font-size=%2280%22 text-anchor=%22middle%22 fill=%22black%22>TH</text></svg>') 20 round;
      border-radius: 30px;
      box-shadow: 
        0 0 100px #ffea00aa, 
        inset 0 0 50px #000,
        0 0 200px #ff0048;
      display: block;
      margin: 40px auto;
      max-width: 95vw;
      background: #000;
    }
    
    #overlay {
      position: absolute;
      top: 10px; left: 10px; right: 10px;
      pointer-events: none;
      font-size: 2.5vw;
      color: var(--color-pijo);
      text-shadow: 3px 3px 0 #000, -3px -3px 0 #ff0048;
      z-index: 100;
    }
    
    marquee {
      background: rgba(255,0,72,0.9);
      padding: 15px;
      font-size: 4vw;
      color: #ffea00;
      text-shadow: 3px 3px #000;
      border-bottom: 3px solid #ffea00;
    }
    
    button {
      background: var(--color-pijo);
      color: #000;
      border: none;
      padding: 15px 30px;
      font-size: 3vw;
      font-weight: bold;
      margin: 8px;
      cursor: pointer;
      transform: skew(-10deg);
      box-shadow: 5px 5px 0 #000;
      font-family: inherit;
      border-radius: 10px;
      transition: all 0.2s;
    }
    
    button:hover {
      background: #fff;
      transform: skew(-10deg) scale(1.05);
      box-shadow: 8px 8px 0 #000;
    }
    
    button:disabled {
      background: #666;
      cursor: not-allowed;
      transform: none;
    }
    
    #chat {
      position: fixed;
      bottom: 10px; left: 10px; right: 10px;
      background: rgba(0,0,0,0.9);
      padding: 15px;
      max-height: 250px;
      overflow-y: auto;
      font-size: 2.5vw;
      border: 2px solid #ffea00;
      border-radius: 15px;
      backdrop-filter: blur(10px);
    }
    
    #legal-warning {
      position: fixed;
      top: 0; left: 0; right: 0;
      background: rgba(255,0,72,0.95);
      color: #ffea00;
      padding: 10px;
      text-align: center;
      font-size: 2.5vw;
      z-index: 1000;
      border-bottom: 3px solid #ffea00;
      animation: glitch 3s infinite;
    }
    
    #game-selector {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.95);
      padding: 30px;
      border: 3px solid #ffea00;
      border-radius: 20px;
      text-align: center;
      display: none;
      max-width: 90vw;
      box-shadow: 0 0 50px #ffea00;
    }
    
    #game-selector button { font-size: 2.5vw; padding: 20px; margin: 10px; }
    
    #instructions {
      position: absolute;
      top: 10px; left: 10px;
      background: rgba(0,0,0,0.8);
      padding: 15px;
      font-size: 1.8vw;
      max-width: 250px;
      border: 2px solid #00ff00;
      border-radius: 10px;
      display: none;
    }
    
    #stats-panel {
      position: absolute;
      top: 10px; right: 10px;
      background: rgba(0,0,0,0.9);
      padding: 15px;
      border: 2px solid #ffea00;
      border-radius: 15px;
      font-size: 1.5vw;
      max-width: 300px;
      text-align: left;
    }
    
    #achievements {
      position: fixed;
      top: 100px; right: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 999;
    }
    
    .achievement {
      background: linear-gradient(45deg, #ffea00, #ff0048);
      color: #000;
      padding: 15px 20px;
      border-radius: 10px;
      font-weight: bold;
      font-size: 1.2vw;
      box-shadow: 0 0 20px #ffea00;
      animation: achievementPop 0.5s ease-out;
      transform: scale(0);
      max-width: 300px;
    }
    
    @keyframes achievementPop {
      0% { transform: scale(0) rotate(-180deg); opacity: 0; }
      50% { transform: scale(1.2) rotate(20deg); opacity: 1; }
      100% { transform: scale(1) rotate(0deg); opacity: 1; }
    }
    
    .particles {
      position: absolute;
      pointer-events: none;
      z-index: 500;
    }
    
    .particle {
      position: absolute;
      width: 4px;
      height: 4px;
      border-radius: 50%;
      pointer-events: none;
    }
    
    #loading-screen {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: #000;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      color: #ffea00;
      font-size: 3vw;
    }
    
    .spinner {
      width: 50px;
      height: 50px;
      border: 5px solid #ffea00;
      border-top: 5px solid transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>

<!-- Loading Screen -->
<div id="loading-screen">
  <div class="spinner"></div>
  <p>üî• CARGANDO REM√ÅSTERS HUMILLANTES...</p>
  <p style="font-size: 1.5vw; margin-top: 20px;">THUAMER te est√° analizando... üòà</p>
</div>

<div id="legal-warning">
  <strong>‚ö†Ô∏è AVISO LEGAL ULTIMATE (ESPA√ëA):</strong> 100% LEGAL porque la SGAE ya te rob√≥ con el canon digital. THUAMER no se hace responsable si rage quitas y rompes tu teclado.
</div>

<canvas id="screen" width="1280" height="960"></canvas>

<!-- Stats Panel -->
<div id="stats-panel">
  <h3>üìä STATS DE PRINGAO</h3>
  <div id="stats-content">
    <p>üíÄ Muertes: <span id="deaths">0</span></p>
    <p>üéØ Score: <span id="current-score">0</span></p>
    <p>üèÜ Mejor Score: <span id="best-score">0</span></p>
    <p>üò≠ Rage Quits: <span id="rage-quits">0</span></p>
    <p>ü§° Ratio Pringao: <span id="pringo-ratio">0%</span></p>
  </div>
</div>

<div id="overlay">
  <div style="text-align:center">
    <h1 id="title" class="glitch">THUAMER CONSOL√Ü ULTIMATE</h1>
    <p id="subtitle">Remasters que HUMILLAN ¬∑ IA que CONOCE tu nombre ¬∑ Logros para PRINGAOS</p>
    <p id="player-name" style="font-size: 2vw; margin: 10px 0;"></p>
  </div>
</div>

<div id="instructions">
  üéÆ WASD: Mover | ESPACIO: Saltar/Disparar | ENTER: Pausa<br>
  üí° Tip: No falles, <span id="name-instructions"></span>...
</div>

<!-- Controls Panel -->
<div style="position:absolute; top:10px; right:10px; text-align:right; z-index: 200;">
  <button onclick="mostrarSelector()">üöÄ REM√ÅSTERS GRATIS</button><br>
  <button onclick="cambiarSkin('chad')">üëë CHAD MODE ‚Ç¨4.99</button><br>
  <button onclick="cambiarSkin('vapor')">üåà VAPORWAVE ‚Ç¨9.99</button><br>
  <button onclick="vozChiquito()">üòÇ VOZ CHIQUITO ‚Ç¨19.99</button><br>
  <button onclick="resetStats()">üîÑ RESET STATS (Cobarde)</button>
</div>

<div id="game-selector">
  <h2 id="selector-title">üéÆ Elige tu Remaster HUMILLANTE:</h2>
  <button onclick="cargarRemaster('concentration')">üß† Concentration Room Remaster (HD + Insultos IA)</button><br>
  <button onclick="cargarRemaster('shooter')">üî´ Neo Shooter Remaster (L√°seres + Part√≠culas)</button><br>
  <button onclick="cargarRemaster('platformer')">üèÉ‚Äç‚ôÇÔ∏è Platform Hell Remaster (60FPS + Trolls)</button><br>
  <button onclick="cargarRemaster('puzzle')">üß© Puzzle Master Remaster (IA Anti-Pringao)</button><br>
  <button onclick="mostrarStats()">üìä VER MIS HUMILLACIONES</button><br>
  <button onclick="cerrarSelector()">‚ùå Cerrar (Rage Quit)</button>
</div>

<div id="chat">ü§ñ THUAMER: Inicializando sistema de trolleo...</div>

<marquee id="marquee" behavior="scroll" direction="left">
  üî• NES ¬∑ SNES ¬∑ GBA ¬∑ ARCADE ¬∑ PS1 ¬∑ REM√ÅSTERS QUE HACEN LLORAR ¬∑ IA QUE CONOCE TU NOMBRE ¬∑ 100% GRATIS ¬∑ LOGROS PARA PRINGAOS ¬∑ THUAMER TE EST√Å OBSERVANDO üëÅÔ∏è
</marquee>

<!-- Achievements Container -->
<div id="achievements"></div>

<!-- Particles Container -->
<div id="particles"></div>

<script>
// ====== SISTEMA DE ESTAD√çSTICAS PERSISTENTES ======
class StatsManager {
  constructor() {
    this.stats = JSON.parse(localStorage.getItem('thuamerStats') || '{}');
    this.init();
  }
  
  init() {
    if (!this.stats.sessions) this.stats.sessions = 0;
    if (!this.stats.deaths) this.stats.deaths = 0;
    if (!this.stats.rageQuits) this.stats.rageQuits = 0;
    if (!this.stats.bestScore) this.stats.bestScore = 0;
    if (!this.stats.achievements) this.stats.achievements = {};
    this.stats.sessions++;
    this.guardar();
    this.actualizarUI();
  }
  
  trackDeath() {
    this.stats.deaths++;
    this.guardar();
    this.actualizarUI();
    this.checkAchievements();
    ThuamerAI.insultOnDeath();
  }
  
  trackScore(score) {
    if (score > this.stats.bestScore) {
      this.stats.bestScore = score;
      this.guardar();
      this.actualizarUI();
      this.checkAchievements();
    }
  }
  
  rageQuit() {
    this.stats.rageQuits++;
    this.guardar();
    this.actualizarUI();
    this.checkAchievements();
  }
  
  guardar() {
    localStorage.setItem('thuamerStats', JSON.stringify(this.stats));
  }
  
  actualizarUI() {
    document.getElementById('deaths').textContent = this.stats.deaths;
    document.getElementById('current-score').textContent = score;
    document.getElementById('best-score').textContent = this.stats.bestScore;
    document.getElementById('rage-quits').textContent = this.stats.rageQuits;
    const ratio = this.stats.deaths > 0 ? ((this.stats.rageQuits / this.stats.deaths) * 100).toFixed(1) : 0;
    document.getElementById('pringo-ratio').textContent = ratio + '%';
  }
  
  checkAchievements() {
    const achievements = {
      'PRINGAO_INICIANTE': { condition: () => this.stats.deaths >= 5, emoji: 'ü•â' },
      'PRINGAO_CERTIFICADO': { condition: () => this.stats.deaths >= 20, emoji: 'ü•à' },
      'PRINGAO_LEGENDARIO': { condition: () => this.stats.deaths >= 50, emoji: 'ü•á' },
      'RAGE_MASTER': { condition: () => this.stats.rageQuits >= 10, emoji: 'üò°' },
      'NOOB_100': { condition: () => this.stats.deaths >= 100, emoji: 'ü§°' }
    };
    
    Object.entries(achievements).forEach(([id, ach]) => {
      if (!this.stats.achievements[id] && ach.condition()) {
        this.stats.achievements[id] = true;
        this.guardar();
        mostrarLogro(ach.emoji + ' ' + id.toUpperCase(), 
          isSpanish ? `¬°Felicidades ${playerName}! Nuevo logro desbloqueado.` : 
          `Congratulations ${playerName}! New achievement unlocked.`);
      }
    });
  }
}

// ====== SISTEMA DE PART√çCULAS √âPICO ======
class ParticleSystem {
  constructor() {
    this.particles = [];
    this.container = document.getElementById('particles');
  }
  
  crearExplosi√≥n(x, y, count = 20, colors = ['#ffea00', '#ff0048', '#00ffff']) {
    for (let i = 0; i < count; i++) {
      const particle = document.createElement('div');
      particle.className = 'particle';
      particle.style.left = x + 'px';
      particle.style.top = y + 'px';
      particle.style.background = colors[Math.floor(Math.random() * colors.length)];
      
      const angle = (Math.PI * 2 * i) / count;
      const velocity = 3 + Math.random() * 5;
      
      particle.style.setProperty('--vx', Math.cos(angle) * velocity + 'px');
      particle.style.setProperty('--vy', Math.sin(angle) * velocity + 'px');
      
      const life = 30 + Math.random() * 30;
      particle.style.animation = `particleFly ${life * 0.05}s linear forwards`;
      
      this.container.appendChild(particle);
      this.particles.push(particle);
      
      setTimeout(() => {
        particle.remove();
        const index = this.particles.indexOf(particle);
        if (index > -1) this.particles.splice(index, 1);
      }, life * 50);
    }
  }
}

// ====== IA THUAMER MEJORADA ======
class ThuamerAI {
  constructor() {
    this.nombre = playerName;
    this.nivelTrol = 1;
    this.ultimoInsulto = 0;
  }
  
  static insultOnDeath() {
    const insults = isSpanish ? [
      `¬°${playerName}, hasta tu abuela juega mejor y tiene 92 a√±os! üíÄ`,
      `Muerte #${statsManager.stats.deaths}. ${playerName}, eres un caso perdido...`,
      `¬°BOOM! ${playerName} explota de nuevo. ¬øQuieres tutorial? üòÇ`,
      `Tu K/D ratio es peor que el de un bot. Sigue intent√°ndolo, ${playerName}`
    ] : [
      `${playerName}, even your grandma plays better and she's 92! üíÄ`,
      `Death #${statsManager.stats.deaths}. ${playerName}, you're hopeless...`,
      `BOOM! ${playerName} explodes again. Want a tutorial? üòÇ`,
      `Your K/D ratio is worse than a bot's. Keep trying, ${playerName}`
    ];
    
    const insult = insults[Math.floor(Math.random() * insults.length)];
    addChatMessage('üíÄ THUAMER:', insult);
  }
  
  generarInsultoPersonalizado() {
    const templatesES = [
      `¬°${this.nombre}, eres m√°s in√∫til que un remaster de E.T.!`,
      `${this.nombre}, tu madre te deshereda viendo c√≥mo juegas`,
      `¬°${this.nombre}! Hasta los NPCs se r√≠en de tus saltos`,
      `${this.nombre}, nuevo r√©cord: ${statsManager.stats.deaths} muertes`,
      `¬°${this.nombre}, paga ‚Ç¨4.99 y te dejo ganar UNA vez!`
    ];
    
    const templatesEN = [
      `${this.nombre}, you're more useless than an E.T. remaster!`,
      `${this.nombre}, your mum disinherits you watching you play`,
      `${this.nombre}! Even NPCs laugh at your jumps`,
      `${this.nombre}, new record: ${statsManager.stats.deaths} deaths`,
      `${this.nombre}, pay ‚Ç¨4.99 and I'll let you win ONCE!`
    ];
    
    const templates = isSpanish ? templatesES : templatesEN;
    return templates[Math.floor(Math.random() * templates.length)];
  }
}

// ====== VARIABLES GLOBALES ======
let isSpanish = true;
let playerName = 'Pringao69';
let score = 0;
let currentRemaster = null;
let keys = {};
let playerX = 128, playerY = 200;
let gameLoop = null;
let audioCtx = null;
let particleSystem = null;
let thuamerAI = null;
let statsManager = null;

// ====== CSS PARA PART√çCULAS ======
const style = document.createElement('style');
style.textContent = `
  @keyframes particleFly {
    0% {
      opacity: 1;
      transform: translate(0, 0) scale(1);
    }
    100% {
      opacity: 0;
      transform: translate(var(--vx), var(--vy)) scale(0);
    }
  }
`;
document.head.appendChild(style);

// ====== DETECTAR IDIOMA Y NOMBRE ======
function detectarIdioma() {
  const lang = navigator.language || navigator.userLanguage;
  isSpanish = lang.startsWith('es');
  
  // Pedir nombre personalizado
  playerName = prompt(
    isSpanish ? 
    'üòà ¬øC√≥mo te llamamos, pringao? (Tu nombre ser√° usado para insultarte)' : 
    'üòà What should we call you, loser? (Your name will be used to mock you)',
    localStorage.getItem('thuamerPlayerName') || 'Pringao69'
  ) || 'Pringao69';
  
  localStorage.setItem('thuamerPlayerName', playerName);
  
  document.getElementById('player-name').textContent = 
    isSpanish ? `Jugador: ${playerName} üëã` : `Player: ${playerName} üëã`;
  document.getElementById('name-instructions').textContent = playerName;
  
  // Actualizar textos
  const texts = isSpanish ? textsES : textsEN;
  Object.keys(texts).forEach(id => {
    const element = document.getElementById(id);
    if (element) element.textContent = texts[id];
  });
  
  frases = isSpanish ? frasesES : frasesEN;
  inicializarJuego();
}

// ====== TEXTOS MULTI-IDIOMA ======
const textsES = {
  title: 'THUAMER CONSOL√Ü ULTIMATE',
  subtitle: 'Remasters que HUMILLAN ¬∑ IA que CONOCE tu nombre ¬∑ Logros para PRINGAOS',
  selectorTitle: 'üéÆ Elige tu Remaster HUMILLANTE:',
  legal: '‚ö†Ô∏è AVISO LEGAL ULTIMATE: 100% LEGAL porque la SGAE ya te rob√≥. THUAMER no se hace responsable si rage quitas.',
  chatInit: `ü§ñ THUAMER: ¬°Bienvenido ${playerName}! Prep√°rate para sufrir...`,
  instructions: 'üéÆ WASD: Mover | ESPACIO: Saltar/Disparar | ENTER: Pausa',
  marquee: 'üî• NES¬∑SNES¬∑GBA¬∑ARCADE¬∑PS1¬∑REM√ÅSTERS QUE LLORAN¬∑IA CONOCE TU NOMBRE¬∑100% GRATIS¬∑LOGROS PRINGAOS'
};

const textsEN = {
  title: 'THUAMER CONSOLE ULTIMATE',
  subtitle: 'Remasters that HUMILIATE ¬∑ AI knows your name ¬∑ Achievements for LOSERS',
  selectorTitle: 'üéÆ Pick Your HUMILIATING Remaster:',
  legal: '‚ö†Ô∏è ULTIMATE LEGAL NOTICE: 100% LEGAL. THUAMER not responsible for rage quits.',
  chatInit: `ü§ñ THUAMER: Welcome ${playerName}! Prepare to suffer...`,
  instructions: 'üéÆ WASD: Move | SPACE: Jump/Shoot | ENTER: Pause',
  marquee: 'üî• NES¬∑SNES¬∑GBA¬∑ARCADE¬∑PS1¬∑REMASTER TEARS¬∑AI KNOWS YOUR NAME¬∑100% FREE¬∑LOSER ACHIEVEMENTS'
};

// ====== FRASES INSULTO AVANZADAS ======
const frasesES = [
  `¬°${playerName}, eres m√°s in√∫til que un remaster de E.T.!`,
  `${playerName}, tu madre te deshereda viendo c√≥mo juegas`,
  `¬°${playerName}! Hasta los NPCs se r√≠en de tus saltos`,
  `${playerName}, nuevo r√©cord: ${statsManager ? statsManager.stats.deaths : 0} muertes`,
  `¬°${playerName}, paga ‚Ç¨4.99 y te dejo ganar UNA vez!`,
  `${playerName}, tu cursor tiembla m√°s que t√∫ en examen`,
  `¬°BOOM! ${playerName} explota otra vez. ¬øTutorial? üòÇ`
];

const frasesEN = [
  `${playerName}, you're more useless than an E.T. remaster!`,
  `${playerName}, your mum disinherits you watching you play`,
  `${playerName}! Even NPCs laugh at your jumps`,
  `${playerName}, new record: ${statsManager ? statsManager.stats.deaths : 0} deaths`,
  `${playerName}, pay ‚Ç¨4.99 and I'll let you win ONCE!`,
  `${playerName}, your cursor shakes more than you in exams`,
  `BOOM! ${playerName} explodes again. Tutorial? üòÇ`
];

let frases = [];

// ====== INICIALIZACI√ìN ======
function inicializarJuego() {
  // Inicializar sistemas
  statsManager = new StatsManager();
  particleSystem = new ParticleSystem();
  thuamerAI = new ThuamerAI();
  
  // Audio
  if (!audioCtx) {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  }
  
  // Inputs
  document.addEventListener('keydown', handleKeyDown);
  document.addEventListener('keyup', handleKeyUp);
  
  // Ocultar loading
  document.getElementById('loading-screen').style.display = 'none';
  
  // Chat inicial
  addChatMessage('ü§ñ THUAMER', 
    isSpanish ? 
    `¬°Bienvenido ${playerName}! Elige un remaster y prep√°rate para sufrir üòà` :
    `Welcome ${playerName}! Choose a remaster and prepare to suffer üòà`
  );
  
  // Iniciar chat IA
  setInterval(() => {
    if (Math.random() < 0.7) { // 70% chance cada 6s
      const insulto = thuamerAI.generarInsultoPersonalizado();
      addChatMessage('üòà THUAMER', insulto);
    }
  }, 6000);
  
  cargarRemaster('platformer'); // Remaster por defecto
}

// ====== INPUTS MEJORADOS ======
function handleKeyDown(e) {
  keys[e.key.toLowerCase()] = true;
  if (e.key === ' ') {
    e.preventDefault();
    if (currentRemaster) disparar();
  }
  if (e.key === 'Enter') {
    e.preventDefault();
    togglePause();
  }
}

function handleKeyUp(e) {
  keys[e.key.toLowerCase()] = false;
}

// ====== SISTEMA DE SONIDO MEJORADO ======
function playBeep(freq = 440, duration = 0.1, type = 'square') {
  if (!audioCtx) return;
  
  const oscillator = audioCtx.createOscillator();
  const gainNode = audioCtx.createGain();
  
  oscillator.connect(gainNode);
  gainNode.connect(audioCtx.destination);
  
  oscillator.frequency.value = freq;
  oscillator.type = type;
  
  gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
  gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
  
  oscillator.start(audioCtx.currentTime);
  oscillator.stop(audioCtx.currentTime + duration);
}

// ====== JUEGO PRINCIPAL ======
const canvas = document.getElementById('screen');
const ctx = canvas.getContext('2d');

function actualizarJuego() {
  // Movimiento jugador
  if (keys['a'] || keys['arrowleft']) playerX = Math.max(0, playerX - 4);
  if (keys['d'] || keys['arrowright']) playerX = Math.min(256, playerX + 4);
  if (keys['w'] || keys['arrowup']) {
    playerY = Math.max(0, playerY - 5);
    playBeep(600, 0.05, 'sine');
  }
  if (keys['s'] || keys['arrowdown']) playerY = Math.min(240, playerY + 3);
  
  // L√≥gica de juego por remaster
  switch(currentRemaster) {
    case 'shooter':
      actualizarShooter();
      break;
    case 'platformer':
      actualizarPlatformer();
      break;
    case 'puzzle':
      actualizarPuzzle();
      break;
    default:
      actualizarDefault();
  }
  
  // Trolleo aleatorio
  if (Math.random() < 0.005) {
    // Muerte troll
    playerY = 200;
    score = Math.max(0, score - 10);
    statsManager.trackDeath();
    particleSystem.crearExplosi√≥n(playerX * 5, playerY * 4, 30);
    playBeep(150, 0.3, 'sawtooth');
  }
  
  // Aumentar score gradualmente
  if (Math.random() < 0.02) {
    score++;
    playBeep(800 + Math.random() * 200, 0.05);
  }
  
  statsManager.trackScore(score);
  dibujarFrame();
}

function dibujarFrame() {
  // Limpiar canvas
  ctx.fillStyle = '#000';
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  
  // Escalar NES (256x240) a canvas
  const scaleX = canvas.width / 256;
  const scaleY = canvas.height / 240;
  const scale = Math.min(scaleX, scaleY);
  
  // Efectos visuales por remaster
  generarVisualesRemaster();
  
  // Dibujar jugador escalado
  ctx.save();
  ctx.translate(playerX * scale, playerY * scale);
  ctx.scale(scale, scale);
  
  // Jugador con efectos
  const gradient = ctx.createRadialGradient(0, 0, 0, 0, 0, 8);
  gradient.addColorStop(0, '#00ff88');
  gradient.addColorStop(0.5, '#00cc66');
  gradient.addColorStop(1, '#008844');
  ctx.fillStyle = gradient;
  ctx.fillRect(-4, -6, 8, 12); // Sprite jugador
  
  // Ojos del jugador
  ctx.fillStyle = '#ffea00';
  ctx.fillRect(-2, -4, 1, 1);
  ctx.fillRect(1, -4, 1, 1);
  
  ctx.restore();
  
  // UI del juego
  dibujarUI();
  
  // Efectos CRT
  aplicarEfectosCRT();
}

function generarVisualesRemaster() {
  const time = Date.now() * 0.001;
  
  for (let y = 0; y < 240; y += 8) {
    for (let x = 0; x < 256; x += 8) {
      const intensity = Math.sin((x + y + time * 50) * 0.1) * 0.5 + 0.5;
      const color = `hsl(${time * 30 % 360}, 100%, ${30 + intensity * 40}%)`;
      
      ctx.fillStyle = color;
      ctx.globalAlpha = 0.1;
      ctx.fillRect(x * (canvas.width/256), y * (canvas.height/240), 8 * (canvas.width/256), 8 * (canvas.height/240));
    }
  }
  ctx.globalAlpha = 1;
}

function dibujarUI() {
  // Score
  ctx.fillStyle = '#ffea00';
  ctx.font = 'bold 24px "Press Start 2P"';
  ctx.fillText(`SCORE: ${score.toString().padStart(6, '0')}`, 20, 30);
  
  // Remaster actual
  ctx.fillStyle = '#00ff88';
  ctx.font = '16px "Press Start 2P"';
  ctx.fillText(`REM√ÅSTER: ${currentRemaster?.toUpperCase() || 'NONE'}`, 20, 60);
  
  // FPS counter
  ctx.fillStyle = '#ff0048';
  ctx.font = '12px "Press Start 2P"';
  ctx.fillText(`FPS: ${Math.round(1000 / (performance.now() - lastTime))}`, canvas.width - 100, 30);
  
  // Vida simulada
  ctx.fillStyle = '#333';
  ctx.fillRect(20, canvas.height - 40, 200, 20);
  ctx.fillStyle = score > 100 ? '#00ff00' : score > 50 ? '#ffea00' : '#ff0048';
  ctx.fillRect(20, canvas.height - 40, Math.min(200, (score / 500) * 200), 20);
}

let lastTime = 0;
function gameLoopCallback() {
  const now = performance.now();
  if (now - lastTime >= 1000/60) { // 60 FPS
    actualizarJuego();
    lastTime = now;
  }
  requestAnimationFrame(gameLoopCallback);
}

// ====== REMASTERS ESPEC√çFICOS ======
function actualizarShooter() {
  // L√°seres movi√©ndose
  const time = Date.now() * 0.002;
  for (let i = 0; i < 5; i++) {
    const y = (time * 50 + i * 100) % 240;
    ctx.strokeStyle = '#00ff88';
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(128, y);
    ctx.lineTo(256, y + Math.sin(time + i) * 20);
    ctx.stroke();
  }
}

function actualizarPlatformer() {
  // Plataformas m√≥viles
  const time = Date.now() * 0.001;
  for (let i = 0; i < 8; i++) {
    const x = (time * 30 + i * 40) % 256;
    const y = 100 + i * 25;
    ctx.fillStyle = '#ff0048';
    ctx.fillRect(x, y, 32, 8);
  }
}

function actualizarPuzzle() {
  // Grid puzzle
  for (let y = 0; y < 240; y += 16) {
    for (let x = 0; x < 256; x += 16) {
      const isFilled = Math.random() < 0.3;
      if (isFilled) {
        ctx.fillStyle = `hsl(${(x+y)*2}, 70%, 50%)`;
        ctx.fillRect(x, y, 16, 16);
      }
    }
  }
}

function actualizarDefault() {
  // Patr√≥n por defecto
  const time = Date.now() * 0.001;
  for (let i = 0; i < 20; i++) {
    const x = (time * 20 + i * 15) % 256;
    const y = Math.sin(time * 3 + i) * 50 + 120;
    ctx.fillStyle = '#ffea00';
    ctx.beginPath();
    ctx.arc(x, y, 4, 0, Math.PI * 2);
    ctx.fill();
  }
}

function disparar() {
  particleSystem.crearExplosi√≥n(playerX * 5, playerY * 4, 10, ['#ffea00', '#ffff00']);
  playBeep(1000, 0.1, 'sawtooth');
  score += 5;
}

// ====== EFECTOS VISUALES ======
function aplicarEfectosCRT() {
  // Scanlines
  for (let y = 0; y < canvas.height; y += 3) {
    const alpha = Math.sin(y * 0.3) * 0.03;
    ctx.fillStyle = `rgba(0, 0, 0, ${alpha})`;
    ctx.fillRect(0, y, canvas.width, 1);
  }
  
  // Vignette
  const gradient = ctx.createRadialGradient(
    canvas.width/2, canvas.height/2, 0,
    canvas.width/2, canvas.height/2, Math.max(canvas.width, canvas.height)
  );
  gradient.addColorStop(0, 'rgba(0,0,0,0)');
  gradient.addColorStop(0.7, 'rgba(0,0,0,0.3)');
  gradient.addColorStop(1, 'rgba(0,0,0,0.8)');
  
  ctx.fillStyle = gradient;
  ctx.fillRect(0, 0, canvas.width, canvas.height);
}

// ====== FUNCIONES DE REMASTER ======
const REMASTERS = {
  'concentration': { name: 'Concentration Room', color: '#ffea00' },
  'shooter': { name: 'Neo Shooter', color: '#00ff88' },
  'platformer': { name: 'Platform Hell', color: '#ff0048' },
  'puzzle': { name: 'Puzzle Master', color: '#0088ff' }
};

async function cargarRemaster(nombre) {
  currentRemaster = nombre;
  score = 0;
  playerX = 128;
  playerY = 200;
  
  document.getElementById('instructions').style.display = 'block';
  
  const remaster = REMASTERS[nombre];
  addChatMessage('üöÄ THUAMER', 
    isSpanish ? 
    `Remaster "${remaster.name}" cargado. ${playerName}, ¬°prep√°rate para sufrir!` :
    `Remaster "${remaster.name}" loaded. ${playerName}, prepare to suffer!`
  );
  
  // Cambiar colores del remaster
  document.documentElement.style.setProperty('--color-pijo', remaster.color);
  
  cerrarSelector();
  
  if (gameLoop) {
    cancelAnimationFrame(gameLoop);
  }
  gameLoop = requestAnimationFrame(gameLoopCallback);
}

// ====== FUNCIONES DE UI ======
function addChatMessage(sender, message) {
  const chat = document.getElementById('chat');
  const time = new Date().toLocaleTimeString();
  const html = `<div style="margin: 5px 0;">
    <span style="color: #ffea00; font-weight: bold;">[${time}] ${sender}</span><br>
    <span style="color: #fff; margin-left: 20px;">${message}</span>
  </div>`;
  
  chat.innerHTML += html;
  chat.scrollTop = chat.scrollHeight;
  
  // Mantener m√°ximo 15 mensajes
  const messages = chat.innerHTML.split('</div>').length;
  if (messages > 15) {
    const lines = chat.innerHTML.split('</div>');
    chat.innerHTML = lines.slice(-15).join('</div>');
  }
}

function mostrarSelector() {
  document.getElementById('game-selector').style.display = 'block';
}

function cerrarSelector() {
  document.getElementById('game-selector').style.display = 'none';
}

function mostrarStats() {
  const stats = statsManager.stats;
  const message = isSpanish ? 
    `üìä TUS ESTAD√çSTICAS DE PRINGAO:\nüíÄ Muertes: ${stats.deaths}\nüò° Rage Quits: ${stats.rageQuits}\nüèÜ Mejor Score: ${stats.bestScore}\nüìà Ratio: ${((stats.rageQuits/stats.deaths)*100 || 0).toFixed(1)}%` :
    `üìä YOUR LOSER STATS:\nüíÄ Deaths: ${stats.deaths}\nüò° Rage Quits: ${stats.rageQuits}\nüèÜ Best Score: ${stats.bestScore}\nüìà Ratio: ${((stats.rageQuits/stats.deaths)*100 || 0).toFixed(1)}%`;
  
  alert(message);
  cerrarSelector();
}

function togglePause() {
  if (gameLoop) {
    cancelAnimationFrame(gameLoop);
    gameLoop = null;
    addChatMessage('‚è∏Ô∏è PAUSA', isSpanish ? 'Juego pausado. ENTER para continuar.' : 'Game paused. ENTER to continue.');
  } else {
    gameLoop = requestAnimationFrame(gameLoopCallback);
    addChatMessage('‚ñ∂Ô∏è JUEGO', isSpanish ? '¬°Continuando tu humillaci√≥n!' : 'Continuing your humiliation!');
  }
}

function resetStats() {
  if (confirm(isSpanish ? '¬øSeguro que quieres borrar TUS ESTAD√çSTICAS DE PRINGAO? üò¢' : 'Really delete YOUR LOSER STATS? üò¢')) {
    localStorage.removeItem('thuamerStats');
    statsManager = new StatsManager();
    addChatMessage('üóëÔ∏è RESET', isSpanish ? 'Estad√≠sticas reseteadas. ¬°Empieza de cero, pringao!' : 'Stats reset. Start from zero, loser!');
  }
}

// ====== COSM√âTICOS MEJORADOS ======
function cambiarSkin(tipo) {
  const skins = {
    chad: {
      confirm: isSpanish ? `¬øQuieres ser CHAD por solo ‚Ç¨4.99? üëë` : `Wanna be CHAD for just ‚Ç¨4.99? üëë`,
      alert: isSpanish ? `¬°CHAD MODE ACTIVADO! Ahora ${playerName} es intocable (mentira)` : `CHAD MODE ACTIVATED! ${playerName} is now untouchable (lie)`
    },
    vapor: {
      confirm: isSpanish ? `¬øVAPORWAVE aesthetic por ‚Ç¨9.99? üåà` : `VAPORWAVE aesthetic for ‚Ç¨9.99? üåà`,
      alert: isSpanish ? `¬°VAPORWAVE ACTIVADO! M√°ximo cringe garantizado` : `VAPORWAVE ACTIVATED! Maximum cringe guaranteed`
    }
  };
  
  if (confirm(skins[tipo].confirm)) {
    // Aplicar skin
    document.body.classList.add(tipo);
    document.body.style.setProperty('--skin', tipo);
    
    // Efectos espec√≠ficos
    if (tipo === 'chad') {
      document.body.style.background = 'radial-gradient(circle, #ffd700, #ff6b35, #c44569)';
      document.querySelector('#title').classList.add('pijo');
    } else if (tipo === 'vapor') {
      document.body.style.background = 'linear-gradient(45deg, #ff6b9d, #c44569, #f18f01, #c44569)';
      document.body.style.backgroundSize = '400% 400%';
      document.body.style.animation = 'vapor 4s ease infinite';
    }
    
    alert(skins[tipo].alert);
    addChatMessage('üíé COSM√âTICO', `${playerName} ahora luce ${tipo.toUpperCase()}!`);
  }
}

function vozChiquito() {
  const confirmText = isSpanish ? 
    `¬øVoz de Chiquito de la Calzada por ‚Ç¨19.99?\n¬°Fistro pecadorrr! üòú` : 
    `Chiquito de la Calzada voice for ‚Ç¨19.99?\n¬°Sinful trickster! üòú`;
    
  if (confirm(confirmText)) {
    const alertText = isSpanish ? 
      `¬°ACTIVADO! Ahora cada muerte: "¬°Hasta luego Lucas, con la iglesia hemos topado!"` :
      `ACTIVATED! Now every death: "See you later Lucas, we've run into the church!"`;
    alert(alertText);
    
    // Simular voz Chiquito en pr√≥xima muerte
    const originalDeath = ThuamerAI.insultOnDeath;
    ThuamerAI.insultOnDeath = function() {
      originalDeath();
      setTimeout(() => {
        const chiquitoMsg = isSpanish ? 
          '¬°HASTA LUEGO LUCAS, CON LA IGLESIA HEMOS TOPADO! üòÇ' :
          'SEE YOU LATER LUCAS, WEVE RUN INTO THE CHURCH! üòÇ';
        addChatMessage('üé≠ CHIQUITO', chiquitoMsg);
        // Sonido chiquito simulado
        playBeep(220, 0.8, 'triangle');
        playBeep(330, 0.6, 'triangle');
        playBeep(440, 0.4, 'triangle');
      }, 500);
    };
  }
}

function mostrarLogro(title, message) {
  const achievement = document.createElement('div');
  achievement.className = 'achievement';
  achievement.innerHTML = `
    <div style="font-size: 1.8vw; margin-bottom: 5px;">${title}</div>
    <div style="font-size: 1vw; opacity: 0.9;">${message}</div>
  `;
  
  document.getElementById('achievements').appendChild(achievement);
  
  // Auto-remover despu√©s de 4 segundos
  setTimeout(() => {
    achievement.style.animation = 'achievementPop 0.5s ease-in reverse';
    setTimeout(() => achievement.remove(), 500);
  }, 4000);
  
  // Sonido de logro
  playBeep(800, 0.2);
  setTimeout(() => playBeep(1000, 0.2), 200);
  setTimeout(() => playBeep(1200, 0.3), 400);
}

// ====== INICIALIZACI√ìN ======
detectarIdioma();

// Variables globales para compatibilidad
window.mostrarSelector = mostrarSelector;
window.cerrarSelector = cerrarSelector;
window.cargarRemaster = cargarRemaster;
window.cambiarSkin = cambiarSkin;
window.vozChiquito = vozChiquito;
window.resetStats = resetStats;

// Prevenir salida accidental (m√°s trolleo)
window.addEventListener('beforeunload', (e) => {
  if (statsManager && statsManager.stats.deaths > 0) {
    e.preventDefault();
    e.returnValue = isSpanish ? '¬°No te vayas, pringao! Tienes ' + statsManager.stats.deaths + ' muertes sin redimir!' : 
                                  "Don't go, loser! You have " + statsManager.stats.deaths + " deaths to redeem!";
    return e.returnValue;
  }
});
</script>

</body>
</html>