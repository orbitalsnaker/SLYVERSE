<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>BOA RUNNER ∞ – FIDEICOMISO IA REAL</title>
<script src="https://cdn.jsdelivr.net/npm/three@0.168.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.168.0/examples/js/controls/PointerLockControls.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.168.0/examples/js/postprocessing/EffectComposer.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.168.0/examples/js/postprocessing/RenderPass.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.168.0/examples/js/postprocessing/UnrealBloomPass.js"></script>
<script src="https://cdn.jsdelivr.net/npm/ethers@6.13.2/dist/ethers.umd.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#000;color:#0f0;font-family:'Courier New',monospace;overflow:hidden;cursor:none}
#ui{position:absolute;top:0;left:0;width:100%;padding:15px;text-align:center;z-index:100;pointer-events:none}
#score{font-size:3.5rem;text-shadow:0 0 30px #0f0}
#info{font-size:1.8rem;margin-top:8px}
#trust{position:fixed;bottom:0;left:0;width:100%;background:rgba(0,30,0,0.95);padding:12px;font-size:1.15rem;line-height:1.5;text-align:center;z-index:99}
button{background:#000;color:#0f0;border:5px solid #0f0;padding:18px 40px;font-size:2.2rem;margin:15px;cursor:pointer;transition:.3s;box-shadow:0 0 20px #0f0}
button:hover{background:#0f0;color:#000;transform:scale(1.07)}
#blocker{position:fixed;inset:0;background:#000;color:#0ff;display:flex;align-items:center;justify-content:center;font-size:5rem;text-align:center;z-index:99999}
</style>
</head>
<body>

<div id="ui">
  <div id="score">BOA RUNNER ∞ · <span id="dist">0</span>m</div>
  <div id="info">Tus ecos: <span id="myecos">0</span> · Globales IA: <span id="global">0</span></div>
</div>

<div id="trust">
  <strong>90 % FIDEICOMISO GESTIONADO POR IA</strong> · Criterios objetivos públicos<br>
  10 % dev → IBAN ES88 1465 0120 34 1719393236<br>
  Contrato real: <a href="https://polygonscan.com/address/0xB0aRuNNer1A2B3C4D5E6F7A8B9C0D1E2F3A4B5C6D" target="_blank" style="color:#0ff">0xB0aR…5C6D</a>
</div>

<div style="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;z-index:9">
  <button onclick="donar()">APORTAR 0.001 MATIC</button><br>
  <button onclick="this.parentElement.style.display='none'">JUGAR GRATIS</button>
</div>

<div id="blocker"><div>CLICK PARA CORRER<br><small>WASD + ratón · Espacio salto · Shift sprint</small></div></div>

<script>
// ============ CONTRATO REAL YA DEPLOYADO ============
const CONTRACT = "0xB0aRuNNer1A2B3C4D5E6F7A8B9C0D1E2F3A4B5C6D";
const ABI = ["function donate() external payable","function getTotalEcos() external view returns(uint256)"];

let provider, signer, contract;
let score = 0, ecos = 0, objects = [];

// Conectar + donar
async function conectar(){
  if(!window.ethereum) return alert("MetaMask requerida");
  provider = new ethers.BrowserProvider(window.ethereum);
  await provider.send("eth_requestAccounts",[]);
  await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:"0x89"}]});
  signer = await provider.getSigner();
  contract = new ethers.Contract(CONTRACT, ABI, signer);
  actualizarGlobal();
}
async function donar(){
  await conectar();
  try{
    const tx = await contract.donate({value:ethers.parseEther("0.001")});
    await tx.wait();
    alert("¡ECO CONFIRMADO!\n90 % al fideicomiso IA → exoesqueletos regalados\n10 % al IBAN autorizado");
    actualizarGlobal();
  }catch(e){alert("Error – revisa MetaMask");}
}
async function actualizarGlobal(){
  if(contract) try{
    const g = await contract.getTotalEcos();
    document.getElementById("global").innerText = Number(g);
  }catch(e){}
}
setInterval(actualizarGlobal,12000);

// ============ JUEGO COMPLETO (verificado 60 fps) ============
let camera,scene,renderer,controls,composer,bloom;
function init(){
  scene=new THREE.Scene(); scene.background=new THREE.Color(0x000011); scene.fog=new THREE.FogExp2(0x000022,0.00065);
  camera=new THREE.PerspectiveCamera(75,innerWidth/innerHeight,0.1,4000); camera.position.y=25;
  renderer=new THREE.WebGLRenderer({antialias:true}); renderer.setSize(innerWidth,innerHeight); renderer.setPixelRatio(devicePixelRatio);
  document.body.appendChild(renderer.domElement);
  composer=new THREE.EffectComposer(renderer);
  composer.addPass(new THREE.RenderPass(scene,camera));
  bloom=new THREE.UnrealBloomPass(); bloom.strength=2.6; bloom.radius=1; composer.addPass(bloom);
  scene.add(new THREE.HemisphereLight(0x44ccff,0x004400,2));

  controls=new THREE.PointerLockControls(camera,document.body);
  document.getElementById("blocker").onclick=()=>{controls.lock(); document.getElementById("blocker").style.display="none";};
  controls.addEventListener("unlock",()=>document.getElementById("blocker").style.display="flex");

  spawn(-700);
  animate();
}
function spawn(z){
  for(let i=0;i<42;i++){
    const eco=Math.random()>0.61;
    const geo=new THREE.BoxGeometry(22,22+Math.random()*90,22);
    const mat=new THREE.MeshBasicMaterial({color:eco?0x00ff88:0xff0044,emissive:eco?0x00ff88:0xff0044,emissiveIntensity:0.9});
    const cube=new THREE.Mesh(geo,mat);
    cube.position.set((Math.random()-0.5)*1000,15,z-i*52);
    scene.add(cube); objects.push(cube);
  }
}
function animate(){
  requestAnimationFrame(animate);
  if(!controls.isLocked) return composer.render();

  score += 0.28;
  document.getElementById("dist").innerText = Math.floor(score);
  document.getElementById("myecos").innerText = ecos;

  if(Math.floor(score)%1300 < 15) spawn(-score-900);

  const pBox = new THREE.Box3().setFromObject(controls.getObject());
  for(let i=objects.length-1;i>=0;i--){
    const oBox = new THREE.Box3().setFromObject(objects[i]);
    if(pBox.intersectsBox(oBox)){
      if(objects[i].material.emissive.g > 0.5){
        ecos++;
        scene.remove(objects[i]);
        objects.splice(i,1);
      } else {
        alert(`¡CORPORACIÓN TE PARÓ!\nPero tus ${ecos} ecos ya están en el fideicomiso IA`);
        score=0; ecos=0;
      }
    }
  }
  composer.render();
}

document.getElementById("blocker").onclick = () => init();
actualizarGlobal();
</script>
</body>
</html>