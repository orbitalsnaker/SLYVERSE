<!DOCTYPE html>
<html lang="es">
<meta charset="UTF-8">
<title>THUAMER Ω · la película eterna</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  body,html{margin:0;height:100vh;background:#000;overflow:hidden;position:fixed}
  canvas{position:fixed;inset:0}
</style>
<body>

<canvas id="c"></canvas>

<script>
// 13 101 310 horas colectivas
const TARGET = 47164716000000n;
const KEY = "thuamer13101310";
let data = JSON.parse(localStorage.getItem(KEY) || '{"t":0,"id":crypto.randomUUID(),"first":Date.now(),"unlocked":false}');
let collective = BigInt(data.t);
let last = performance.now();

const c = document.getElementById("c");
const ctx = c.getContext("2d", {alpha:false,desynchronized:true});
c.width = innerWidth; c.height = innerHeight;

let movie = data.unlocked;
let movieStart = movie ? performance.now() - 1000 : 0;

const firstSeen = data.first;
const daysSinceFirst = Math.floor((Date.now() - firstSeen)/(86400000));

function loop(){
  const now = performance.now();

  // seguir sumando tiempo colectivo aunque ya esté desbloqueada
  if(document.hasFocus() && document.visibilityState==="visible"){
    const delta = BigInt(Math.floor(now - last));
    collective += delta;
    data.t = Number(collective);
    localStorage.setItem(KEY, JSON.stringify(data));
  }
  last = now;

  // desbloqueo permanente la primera vez que se alcanza
  if(!movie && collective >= TARGET){
    movie = true;
    data.unlocked = true;
    movieStart = now;
    localStorage.setItem(KEY, JSON.stringify(data));
  }

  if(movie){
    let elapsed = (movieStart ? now - movieStart : 0) % 5400000; // 90 minutos en loop infinito

    ctx.fillStyle = "#00ff00";
    ctx.fillRect(0,0,c.width,c.height);

    const total = 13101310;
    const step = Math.floor(elapsed/7);
    const visible = Math.min(total, step);

    for(let i=0;i<visible;i++){
      const t = elapsed*0.001 + i*0.007;
      const angle = (i/total)*Math.PI*2 + t*0.00005;
      const radius = 120 + Math.sin(t + i*0.001)*380;
      const x = c.width/2 + Math.cos(angle)*radius;
      const y = c.height/2 + Math.sin(angle)*radius;
      const phase = Math.sin(t*10 + i*0.13);
      ctx.fillStyle = `rgba(0,0,0,${Math.max(0,phase)*0.38})`;
      ctx.fillRect(x-20,y-40,40,80);
      ctx.fillRect(x-40,y-20,80,40);
    }

    // triggers emocionales que siguen funcionando cada vez que volvés
    if(daysSinceFirst > 300 && elapsed > 10000 && elapsed < 20000){
      ctx.fillStyle = "#000";
      ctx.font = "4vw Georgia";
      ctx.textAlign = "center";
      ctx.fillText("volviste después de tanto tiempo",c.width/2,c.height/2);
    }
    if(new Date().getHours() >= 3 && new Date().getHours() <= 5 && elapsed > 30000 && elapsed < 40000){
      ctx.fillStyle = "#000";
      ctx.font = "3vw Georgia";
      ctx.fillText("otra madrugada más, gracias por quedarte",c.width/2,c.height/2 + 80);
    }
    if(elapsed > 5000000){
      ctx.fillStyle = "#000";
      ctx.font = "bold 9vw Georgia";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillText("siempre fuiste vos",c.width/2,c.height/2);
    }
  }else{
    const ratio = Number(collective)/Number(TARGET);
    const g = Math.floor(ratio*255);
    ctx.fillStyle = `rgb(0,${g},0)`;
    ctx.fillRect(0,0,c.width,c.height);
  }

  requestAnimationFrame(loop);
}
loop();

onresize = ()=>{c.width=innerWidth;c.height=innerHeight};
</script>
</body>
</html>