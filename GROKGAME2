<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<title>Forja del Drag√≥n Eterno ‚àû v1.0 ‚Äî 100% a los pibes</title>
<meta name="description" content="Aventura 3D AAA infinita: Forja la espada legendaria con dragones ancestrales. Gratis eterno.">
<style>
  body{margin:0;background:#000;overflow:hidden;color:#ff8;font-family:'Arial Black',Arial,sans-serif}
  #ui{position:fixed;top:10px;left:10px;z-index:100;text-shadow:0 0 15px #ff0;font-size:20px}
  #mate{position:fixed;bottom:40px;right:40px;width:100px;height:100px;border-radius:50%;background:radial-gradient(#ff0,#800);box-shadow:0 0 60px #ff0;display:flex;align-items:center;justify-content:center;font-size:60px;cursor:pointer;z-index:99}
  #hablar{position:fixed;bottom:150px;right:45px;width:80px;height:80px;border-radius:50%;background:#f0f;box-shadow:0 0 40px #f0f;display:none;align-items:center;justify-content:center;font-size:40px;z-index:99;cursor:pointer}
  #forge{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(50,0,0,0.95);padding:50px;border:6px solid #f80;border-radius:25px;display:none;pointer-events:all;text-align:center;font-size:22px;color:#ff8;z-index:200;width:600px}
  #bar{width:500px;height:50px;background:#333;border:4px solid #f80;margin:20px auto;overflow:hidden;position:relative;}
  #hammer{width:60px;height:50px;background:#ff0;position:absolute;left:0;transition:left 0.1s;}
  #zone{position:absolute;top:0;left:220px;width:60px;height:50px;background:rgba(255,255,0,0.6);}
  #ethicalWall{position:fixed;inset:0;background:#000;z-index:9999;display:none;align-items:center;justify-content:center;flex-direction:column;color:#ff8;font-size:22px;text-align:center;padding:20px;}
</style>
<script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
<script src="https://unpkg.com/simple-peer@9.11.1/simplepeer.min.js"></script>
</head>
<body>

<!-- UI √âPICA -->
<div id="ui">Abrazos/Dragones: <span id="hugs">0</span> | Mana: <span id="mana">100</span> | Fragmentos: <span id="shards">0</span> | Nivel: <span id="level">1</span> | <span id="premiumStatus">Gratis</span></div>
<div id="mate" role="button">üêâ</div>
<div id="hablar" role="button">üîä</div>

<!-- FORJA 3D -->
<div id="forge">
  <h2>Forja la Espada del Drag√≥n Eterno</h2>
  <p>Golpea la zona dorada (7 perfectos = Legendaria)</p>
  <div id="bar"><div id="hammer"></div><div id="zone"></div></div>
  <button id="strike" style="background:#f80;color:#fff;padding:20px 40px;font-size:20px;border:none;border-radius:15px;cursor:pointer;margin:15px;">¬°Golpear!</button>
  <p>Precisi√≥n: <span id="precision">0</span>% | Perfectos: <span id="perfect">0</span>/7</p>
</div>

<!-- ESCENA A-FRAME INFINITA -->
<a-scene background="color:#000" fog="type:linear; color:#111; near:50; far:200">
  <a-camera id="cam" wasd-controls="acceleration:80" look-controls="pointerLockEnabled:true" position="0 5 0"></a-camera>
  <a-entity id="terrain"></a-entity>
  <a-entity id="dragons"></a-entity>
  <a-entity id="items"></a-entity>
  <a-entity id="quests"></a-entity>
  <a-entity id="espiritus"></a-entity>
  <a-light type="ambient" color="#444" intensity="0.5"></a-light>
  <a-light type="directional" color="#ff8" intensity="0.8" position="-1 1 0"></a-light>
</a-scene>

<!-- MURO √âTICO 100% PIBES -->
<div id="ethicalWall">
  <h1 style="font-size:60px;margin:10px">üêâ FORJA O NADA</h1>
  <p>Este reino es gratis eternamente.<br><br>
     Pero si quer√©s que pibes sin compu forjen sus sue√±os:</p>

  <button onclick="pagarConAbrazo()" style="background:#ff0;color:#000;padding:25px 50px;font-size:32px;border:none;border-radius:20px;margin:20px;cursor:pointer;font-weight:bold;">
    ABRAZA 1313 DRAGONES<br><small>(legendaria gratis)</small>
  </button>

  <button onclick="donarALosPibes()" style="background:#f80;color:#fff;padding:25px 50px;font-size:32px;border:none;border-radius:20px;margin:20px;cursor:pointer;font-weight:bold;">
    DONAR A LOS PIBES<br><small>(100% devs indie sin recursos)</small>
  </button>

  <p style="max-width:700px;margin:40px 0 20px;font-size:18px;">
    0rb1t4lsn4k3r no se queda con nada.<br>
    100% a pibes hackeando dragones desde la nada.
  </p>

  <button onclick="this.parentNode.style.display='none'" style="background:transparent;border:2px solid #ff0;padding:15px 40px;border-radius:15px;cursor:pointer;font-size:20px;">
    Entrar al reino
  </button>
</div>

<script>
// ====================== CONFIG DRAG√ìN ETERNO ======================
let hugs = parseInt(localStorage.getItem('abrazosDragon')||'0');
let premium = hugs >= 1313;
let shards = 0, mana = 100, level = 1, forging = false, perfectHits = 0;
document.getElementById('hugs').textContent = hugs;
document.getElementById('mana').textContent = mana;
document.getElementById('shards').textContent = shards;
document.getElementById('level').textContent = level;
if(premium) document.getElementById('premiumStatus').textContent = "LEYENDARIA";

const linajes = [ // Clanes ancestrales
  {n:"Fuego",c:"#f80",h:[100,50,100]},
  {n:"Hielo",c:"#0ff",h:[200,100,200]},
  {n:"Sombra",c:"#f0f",h:[300,150,300]},
  {n:"Luz",c:"#ff0",h:[50,100,50,100]},
  {n:"Tierra",c:"#0f0",h:[400]},
  {n:"Boa Drag√≥n",c:"#ff8",h:[500,200,500]}
];

const terrainChunks = new Map();
const dragonEntities = [];
const itemEntities = [];
const questEntities = [];
const espiritus = new Map();
let peer = null, dataChannel = null;
let rec;

// ====================== TERRENO PROCEDURAL INFINITO ======================
function getNoise(x,z) {
  let h = Math.abs(Math.sin(x*12.9898 + z*78.233)*43758.5453);
  return h*20;
}
function genChunk(cx,cz) {
  const key = `${cx},${cz}`;
  if(terrainChunks.has(key)) return;
  const ent = document.createElement('a-plane');
  ent.setAttribute('position',`${cx*64} 0 ${cz*64}`);
  ent.setAttribute('rotation',`-90 0 0`);
  ent.setAttribute('width',64);
  ent.setAttribute('height',64);
  ent.setAttribute('material',`color:#442; repeat:64 64; shader:flat`);
  ent.setAttribute('shadow','cast:true; receive:true');
  document.querySelector('#terrain').appendChild(ent);
  terrainChunks.set(key, true);
  spawnEspiritu(cx,cz);
}

// ====================== ESP√çRITUS CLANES ======================
function getLinaje(cx,cz){
  let hash = Math.abs(Math.sin(cx*12.9898 + cz*78.233)*43758.5453);
  return linajes[Math.floor(hash*linajes.length*0.99999)];
}
function spawnEspiritu(cx,cz){
  const l = getLinaje(cx,cz);
  if("vibrate" in navigator) navigator.vibrate(l.h);
  const ent = document.createElement('a-entity');
  ent.setAttribute('position',`${cx*64+32} 15 ${cz*64+32}`);
  ent.setAttribute('geometry','primitive:octahedron;radius:8');
  ent.setAttribute('material',`color:${l.c};emissive:${l.c};emissiveIntensity:0.7`);
  ent.setAttribute('animation','property:rotation;to:0 360 0;loop:true;dur:15000');
  ent.setAttribute('text',`value:${l.n};color:white;align:center`);
  document.querySelector('#espiritus').appendChild(ent);
  setTimeout(()=>ent.remove(),20000);
}

// ====================== DRAGONES VIVOS ======================
for(let i=0;i<15;i++){
  const dragon = document.createElement('a-entity');
  dragon.setAttribute('position',`${Math.random()*200-100} 10 ${Math.random()*200-100}`);
  dragon.setAttribute('geometry','primitive:sphere;radius:5');
  dragon.setAttribute('material','color:#f80;metalness:0.8');
  dragon.setAttribute('animation__float','property:position;dir:alternate;dur:5000;loop:true;from:"0 10 0";to:"0 20 0"');
  dragon.setAttribute('animation__rot','property:rotation;to:0 360 0;dur:10000;loop:true');
  document.querySelector('#dragons').appendChild(dragon);
  dragonEntities.push(dragon);
}

// ====================== ABRAZO = BEFRIEND DRAG√ìN ======================
function darAbrazo(){
  hugs++;
  localStorage.setItem('abrazosDragon',hugs);
  document.getElementById('hugs').textContent = hugs;
  navigator.vibrate([200,100,200,100,300]);
  shards += 0.1; // Abrazos dan shards
  document.getElementById('shards').textContent = Math.floor(shards);
  if(hugs === 1313){
    premium = true;
    alert("üêâ 1313 ABRAZOS! ESPADA LEYENDARIA GRATIS ETERNA");
    document.getElementById('premiumStatus').textContent = "LEYENDARIA";
  }
  if(Math.floor(shards) >= 10) startForge();
}
document.getElementById('mate').onclick = darAbrazo;

// ====================== FORJA LEGENDARIA ======================
function startForge(){
  forging = true;
  perfectHits = 0;
  document.getElementById('forge').style.display = 'block';
  strikeTime = Date.now();
  updateBar();
}
document.getElementById('strike').onclick = ()=>{
  const hitPos = (Date.now() - strikeTime)/800 *500 %500;
  document.getElementById('hammer').style.left = hitPos +'px';
  const precision = Math.max(0,100 - Math.abs(hitPos-250)*0.8);
  document.getElementById('precision').textContent = Math.floor(precision);
  document.getElementById('perfect').textContent = perfectHits;
  if(precision >90) perfectHits++;
  navigator.vibrate(precision>90 ? [100] : [200]);
  strikeTime = Date.now();
  setTimeout(updateBar,100);
  if(perfectHits >=7){
    alert("¬°ESPADA FORJADA!");
    document.getElementById('forge').style.display = 'none';
    forging = false;
    if(premium) showLegendary();
  }
};
let strikeTime=0;
function updateBar(){
  const barPos = (Date.now()/50)%500;
  document.getElementById('hammer').style.left = barPos +'px';
}
setInterval(updateBar,50);

function showLegendary(){
  alert("üêâ LEYENDARIA ETERNA! Tu nombre en anales drac√≥nicos.");
}

// ====================== VOZ P2P CO-OP ======================
document.getElementById('hablar').onpointerdown = async()=>{
  document.getElementById('hablar').style.background="#f00";
  const stream = await navigator.mediaDevices.getUserMedia({audio:true});
  rec = new MediaRecorder(stream);
  const chunks=[];
  rec.ondataavailable=e=>chunks.push(e.data);
  rec.onstop=()=>{
    const blob=new Blob(chunks,{type:'audio/ogg;codecs=opus'});
    blob.arrayBuffer().then(buf=>{
      if(dataChannel) dataChannel.send({type:'voz',data:Array.from(new Uint8Array(buf))});
    });
  };
  rec.start();
};
document.getElementById('hablar').onpointerup=()=>{
  document.getElementById('hablar').style.background="#f0f";
  if(rec) rec.stop();
};
function playVoz(arr){
  const blob=new Blob([new Uint8Array(arr)],{type:'audio/ogg'});
  new Audio(URL.createObjectURL(blob)).play();
}

// ====================== P2P CO-OP DRAG√ìN HUNT ======================
function iniciarP2P(host=false){
  peer = new SimplePeer({initiator:host,trickle:false});
  peer.on('signal',d=>prompt("ID para compa:",JSON.stringify(d)));
  peer.on('connect',()=>{
    dataChannel=peer;
    document.getElementById('hablar').style.display='block';
  });
  peer.on('data',data=>{
    if(data.type==='voz') playVoz(data.data);
    // sync shards/hugs etc.
  });
}
document.addEventListener('keydown',e=>{
  if(e.key==='p') iniciarP2P(false);
});

// ====================== ANTI-PAYWALL BOA DRAG√ìN ======================
function detectarPaywall(msg){
  const malas=["paywall","nft","obligatorio","paga","gumroad hack"];
  if(malas.some(p=>msg.toLowerCase().includes(p))){
    navigator.vibrate(1000);
    alert("üêç BOA DRAG√ìN TE DEVOR√ì POR PAYWALL!");
    location.reload();
  }
}
dataChannel?.on('data',data=>detectarPaywall(JSON.stringify(data)));

// ====================== CHUNKS + LOOP ======================
setInterval(()=>{
  const cam = document.querySelector('#cam').getAttribute('position');
  const cx=Math.floor(cam.x/64), cz=Math.floor(cam.z/64);
  for(let dx=-1;dx<=1;dx++)for(let dz=-1;dz<=1;dz++){
    genChunk(cx+dx,cz+dz);
  }
},2000);

// Mana regen
setInterval(()=>{
  mana = Math.min(150,mana+1);
  document.getElementById('mana').textContent=mana;
  level = Math.floor(hugs/200)+1;
  document.getElementById('level').textContent=level;
},1000);

// Click shoot
document.querySelector('a-scene').addEventListener('click',e=>{
  if(e.detail.intersection && mana>=20 && !forging){
    mana-=20;
    // raycast shoot dragon
    navigator.vibrate([50]);
  }
});

// ====================== MURO 100% PIBES ======================
if(hugs <1313 && !localStorage.getItem('yaVioMuroDragon')){
  setTimeout(()=>document.getElementById('ethicalWall').style.display='flex',8000);
  localStorage.setItem('yaVioMuroDragon','true');
}
function pagarConAbrazo(){ document.getElementById('ethicalWall').style.display='none'; }
function donarALosPibes(){
  hugs=1313; localStorage.setItem('abrazosDragon',1313);
  premium=true;
  alert("¬°GRACIAS! 100% a pibes forjando desde la villa. üêâ");
  document.getElementById('ethicalWall').style.display='none';
  document.getElementById('premiumStatus').textContent="LEYENDARIA";
}

// ====================== BOOT ======================
alert("Forja del Drag√≥n Eterno v1.0 cargado.\nAbraza dragones, forja legendaria, co-op P2P.\n(P para P2P) Todo gratis. 100% pibes.");
</script>
</body>
</html>