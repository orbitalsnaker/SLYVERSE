<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<title>BOAVERSE ∞ v1 — Abrazo eterno para absolutamente todos</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
:root{--text:#0ff;--bg:#000;--btn:#0ff;--btn-text:#000;--acc:#0ff}
body.dyslexia{font-family:'OpenDyslexic',sans-serif;letter-spacing:0.15em;line-height:1.8}
body.deuteranopia{--text:#0ff;--btn:#00ffff;--acc:#00ffff}
body.protanopia{--text:#00f0ff;--btn:#00f0ff;--acc:#00f0ff}
body.tritanopia{--text:#ff0;--btn:#ffff00;--acc:#ffff00}
body.contrast-high{--text:#ff0;--btn:#ff0;--acc:#ff0}
body.contrast-ultra{--text:#fff;--btn:#fff;--acc:#fff}
body{margin:0;background:var(--bg);color:var(--text);overflow:hidden;height:100dvh;display:flex;flex-direction:column;font-family:system-ui;transition:all .5s}
canvas{flex:1;background:var(--bg)}
#ui,#acc,#shop,#chat,#multi{position:fixed;z-index:999;background:rgba(0,0,0,0.92);border:4px solid var(--acc);padding:12px;border-radius:12px;box-sizing:border-box;font-size:18px}
#ui{top:0;left:0;right:0;display:flex;justify-content:space-between;align-items:center}
#acc{top:70px;left:10px;display:grid;grid-template-columns:repeat(auto-fit,minmax(110px,1fr));gap:8px}
#shop{bottom:150px;right:10px;max-width:300px}
#multi{bottom:150px;left:10px;max-width:400px;display:none}
#multi.show{display:block}
#chat{bottom:0;left:0;right:0;display:flex;gap:10px;align-items:center;padding:15px;border-top:4px solid var(--acc)}
button,input,textarea{font-size:18px;padding:12px;border-radius:10px;border:2px solid var(--acc);background:#000;color:var(--text);cursor:pointer}
button{background:var(--btn);color:var(--btn-text)}
.big{font-size:240% !important;padding:24px !important}
.braille{font-family:monospace;font-size:34px;letter-spacing:8px;background:#000;color:#0ff;padding:15px;border:4px solid #0ff;border-radius:12px;position:fixed;bottom:170px;left:50%;transform:translateX(-50%);z-index:999;display:none;white-space:pre}
.braille.show{display:block}
.sign{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:320px;z-index:1001;display:none;border:6px solid #0ff;border-radius:20px}
@font-face{font-family:'OpenDyslexic';src:url('https://cdn.jsdelivr.net/gh/antijob/OpenDyslexic@latest/opendyslexic3-regular.woff2') format('woff2');}
@media (prefers-reduced-motion:reduce){*{animation:none!important;transition:none!important}}
</style>
</head>
<body aria-live="polite">

<canvas id="c" tabindex="0" aria-label="Mundo infinito BOAVERSE con biomas y jugadores"></canvas>

<div id="ui" role="banner">
  <div>Jugadores: <b id="count" aria-live="polite">1</b> · <span id="biome" aria-live="polite">Abrazo Eterno</span></div>
  <div><button onclick="toggleMulti()">Multi</button> BOAVERSE ∞ v1</div>
</div>

<div id="acc" role="region" aria-label="Accesibilidad total">
  <button onclick="toggleContrast()">Contraste</button>
  <button onclick="toggleDyslexia()">Dislexia</button>
  <button onclick="cycleColorBlind()">Daltónico</button>
  <button onclick="toggleBig()">Grande</button>
  <button onclick="toggleSign()">Signos</button>
  <button onclick="toggleBraille()">Braille</button>
  <button onclick="toggleVoice()">Voz</button>
  <button onclick="toggleSimple()">Simple</button>
</div>

<div id="multi">
  <h3>Multijugador P2P (sin servidores)</h3>
  <button onclick="hostRoom()">Crear sala</button>
  <textarea id="offer" placeholder="Oferta SDP (copia)"></textarea>
  <button onclick="copy('offer')">Copiar oferta</button>
  <button onclick="joinRoom()">Unirme</button>
  <textarea id="answer" placeholder="Respuesta SDP (copia)"></textarea>
  <button onclick="copy('answer')">Copiar respuesta</button>
  <button onclick="setAnswer()">Pegar respuesta (host)</button>
</div>

<div id="shop" role="region" aria-label="Tienda cosmética">
  <h3>TIENDA DEL ABRAZO</h3>
  <button onclick="buy('dragón')">Dragón 0,10€</button>
  <button onclick="buy('abismo')">Abismo 0,20€</button>
  <button onclick="buy('boa')">Boa 0,05€</button>
  <button onclick="buy('aura')">Aura 0,15€</button>
  <small>50 % IA diversidad funcional · 50 % 0rb1t4lsn4k3r</small>
</div>

<div id="chat">
  <input id="msg" placeholder="Chat…" maxlength="100">
  <button onclick="sendChat()">Enviar</button>
</div>

<img id="sign" class="sign" alt="Lengua de signos">
<div id="braille" class="braille" aria-live="assertive"></div>

<script>
// === CONFIGURACIÓN ===
const canvas=document.getElementById('c'),ctx=canvas.getContext('2d');
canvas.width=innerWidth;canvas.height=innerHeight;window.onresize=()=>{canvas.width=innerWidth;canvas.height=innerHeight;};
const player={id:'p'+Math.random().toString(36).slice(2,8),wx:0,wy:0,color:`hsl(${Math.random()*360},100%,60%)`,item:''};
let camX=0,camY=0,others={},pc=null,dc=null,lastBiome=-1,particles=[];
const keys={};
onkeydown=onkeyup=e=>keys[e.key.toLowerCase()]=e.type[5];

// === BIOMAS INFINITOS ===
const biomes=[
  {name:"Abrazo Eterno",bg:"#ff1493",part:"#ffc0cb"},
  {name:"Bosque Dragón",bg:"#228b22",part:"#90ee90"},
  {name:"Abismo Armónico",bg:"#00008b",part:"#add8e6"},
  {name:"Perreo Fantasma",bg:"#ff69b4",part:"#ffff00"},
  {name:"Ciudad Boa",bg:"#ffd700",part:"#ff8c00"}
];
function getBiome(x,y){return Math.floor(Math.abs(Math.sin(x*0.0008)*43758.5453+Math.sin(y*0.0008)*12345.6789)%5);}
function currentBiome(){return biomes[getBiome(player.wx,player.wy)];}

// === MULTIJUGADOR P2P WEBRTC ===
async function hostRoom(){
  pc=new RTCPeerConnection({iceServers:[{urls:'stun:stun.l.google.com:19302'}]});
  dc=pc.createDataChannel('boa');
  setupDC();
  const offer=await pc.createOffer();await pc.setLocalDescription(offer);
  document.getElementById('offer').value=btoa(JSON.stringify(pc.localDescription));
}
async function joinRoom(){
  const offer=btoa(document.getElementById('offer').value);if(!offer)return;
  pc=new RTCPeerConnection({iceServers:[{urls:'stun:stun.l.google.com:19302'}]});
  pc.ondatachannel=e=>{dc=e.channel;setupDC();}
  await pc.setRemoteDescription(JSON.parse(atob(offer)));
  const answer=await pc.createAnswer();await pc.setLocalDescription(answer);
  document.getElementById('answer').value=btoa(JSON.stringify(pc.localDescription));
}
async function setAnswer(){
  const answer=document.getElementById('answer').value;if(!answer)return;
  await pc.setRemoteDescription(JSON.parse(atob(answer)));
}
function setupDC(){
  dc.onopen=()=>{speak('¡Conectados!');document.getElementById('count').textContent=Object.keys(others).length+1;}
  dc.onmessage=e=>{const p=JSON.parse(e.data);others[p.id]=p;document.getElementById('count').textContent=Object.keys(others).length+1;}
}
function sendState(){if(dc&&dc.readyState==='open')dc.send(JSON.stringify({id:player.id,wx:player.wx,wy:player.wy,color:player.color,item:player.item}));}
setInterval(sendState,60);
function copy(id){navigator.clipboard.writeText(document.getElementById(id).value);speak('Copiado');}

// === ACCESIBILIDAD TOTAL ===
let voice=false,brailleOn=false,signOn=false;
function speak(t){if(voice){const u=new SpeechSynthesisUtterance(t);u.lang='es-ES';speechSynthesis.speak(u);}updateBraille(t);}
function updateBraille(t){if(brailleOn)document.getElementById('braille').textContent=toBraille(t);}
function toggleVoice(){voice=!voice;speak(voice?'Voz activada':'Voz desactivada');}
function toggleBraille(){brailleOn=!brailleOn;document.getElementById('braille').classList.toggle('show',brailleOn);}
function toggleSign(){document.getElementById('sign').src='https://media.giphy.com/media/26ufnwz3wDUlj5gxC/giphy.gif';document.getElementById('sign').style.display='block';setTimeout(()=>document.getElementById('sign').style.display='none',4000);}
function toggleContrast(){document.body.classList.toggle('contrast-high');}
function toggleDyslexia(){document.body.classList.toggle('dyslexia');}
function cycleColorBlind(){const modes=['','deuteranopia','protanopia','tritanopia'];document.body.className=modes[(modes.indexOf(document.body.className)+1)%4];}
function toggleBig(){document.querySelectorAll('button,input,#ui,#shop,#chat').forEach(e=>e.classList.toggle('big'));}
function toggleSimple(){document.getElementById('shop').style.display=document.getElementById('shop').style.display==='none'?'block':'none';}
function toggleMulti(){document.getElementById('multi').classList.toggle('show');}
const brailleMap={'a':'⠁','b':'⠃','c':'⠉','d':'⠙','e':'⠑','f':'⠋','g':'⠛','h':'⠓','i':'⠊','j':'⠚','k':'⠅','l':'⠇','m':'⠍','n':'⠝','o':'⠕','p':'⠏','q':'⠟','r':'⠗','s':'⠎','t':'⠞','u':'⠥','v':'⠧','w':'⠺','x':'⠭','y':'⠽','z':'⠵',' ':'⠀','.':'⠲',',':'⠂','!':'⠖','?':'⠦'};
function toBraille(t){return t.toLowerCase().split('').map(c=>brailleMap[c]||c).join('');}

// === TIENDA ===
function buy(item){
  player.item=item;speak('Gracias por tu abrazo');window.open(`https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&business=ferry420oficial@gmail.com&item_name=BOAVERSE_${item}&amount=0.10¤cy_code=EUR&custom=50%25_IA_accesibilidad`,'_blank');
}

// === LOOP PRINCIPAL ===
function loop(){
  // Movimiento
  if(keys['a']||keys['arrowleft'])player.wx-=6;
  if(keys['d']||keys['arrowright'])player.wx+=6;
  if(keys['w']||keys['arrowup'])player.wy-=6;
  if(keys['s']||keys['arrowdown'])player.wy+=6;
  camX=player.wx-canvas.width/2;camY=player.wy-canvas.height/2;

  // Bioma
  const bId=getBiome(player.wx,player.wy);
  if(bId!==lastBiome){
    lastBiome=bId;const b=biomes[bId];
    document.getElementById('biome').textContent=b.name;
    speak(b.name);updateBraille(b.name);
    if('vibrate'in navigator)navigator.vibrate(200);
  }
  const b=biomes[bId];

  // Fondo
  ctx.fillStyle=b.bg+'33';ctx.fillRect(0,0,canvas.width,canvas.height);

  ctx.save();ctx.translate(-camX,-camY);

  // Partículas
  if(particles.length<1000)particles.push({x:player.wx+Math.random()*2000-1000,y:player.wy+Math.random()*2000-1000,vx:(Math.random()-0.5)*2,vy:(Math.random()-0.5)*2,life:150});
  particles=particles.filter(p=>{
    p.x+=p.vx;p.y+=p.vy;p.life--;
    ctx.fillStyle=b.part+Math.floor(p.life/150*255).toString(16).padStart(2,'0');
    ctx.fillRect(p.x,p.y,4,4);
    return p.life>0;
  });

  // Jugadores
  ctx.fillStyle=player.color;ctx.beginPath();ctx.arc(player.wx,player.wy,30,0,6.28);ctx.fill();
  if(player.item)ctx.fillText(player.item==='boa'?'Boa':player.item==='dragón'?'Dragon':'Item',player.wx,player.wy-40);

  for(const id in others){
    const p=others[id];
    ctx.fillStyle=p.color;ctx.beginPath();ctx.arc(p.wx,p.wy,30,0,6.28);ctx.fill();
    ctx.fillStyle='#fff';ctx.fillText(id.slice(0,5),p.wx,p.wy-40);
  }

  ctx.restore();
  requestAnimationFrame(loop);
}
loop();

speak('Bienvenido al abrazo eterno infinito');toggleSign();
</script>

<small style="position:fixed;bottom:5px;left:5px;opacity:0.8;color:#0ff">
  BOAVERSE ∞ v1 · Biomas infinitos · Multijugador P2P real · 100% accesible · 50% beneficios → IA para diversidad funcional
</small>
</body>
</html>