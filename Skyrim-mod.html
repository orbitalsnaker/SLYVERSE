<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SLYVERSE Ω · Portal Mejorado · 16/16 Artefactos</title>
<style>
/* ===== Estilos Base ===== */
body,html{margin:0;padding:0;height:100dvh;overflow:hidden;background:#000;color:#0f0;font-family:Georgia,serif;position:relative}
#fondo{position:fixed;inset:0;background:radial-gradient(circle at 50% 8%,#00FF0033,transparent 75%);z-index:-3}
#plaza{position:fixed;bottom:0;left:0;width:100%;height:48vh;background:repeating-linear-gradient(90deg,#001100 0px,#002200 40px,#003300 80px,#001100 120px);z-index:-2}
.p{position:absolute;border-radius:50%;background:#0f0;box-shadow:0 0 30px #0f0;pointer-events:none;mix-blend-mode:screen;animation:pulso 8s infinite}
@keyframes pulso{0%,100%{transform:scale(1)}50%{transform:scale(1.4)}}
#mate{position:fixed;bottom:28px;right:28px;width:160px;height:160px;z-index:9999;cursor:pointer;filter:drop-shadow(0 0 20px #0f0);transition:all .4s}
#mate.cycle{animation:mfast 1.31s linear infinite}
@keyframes mfast{from{transform:rotate(0deg)}to{transform:rotate(3600deg)}}
.layer{position:fixed;inset:0;background:rgba(0,0,0,0.985);display:none;flex-direction:column;align-items:center;justify-content:center;text-align:center;color:#0f8;font-size:1.6rem;line-height:2.4;z-index:99;overflow-y:auto;padding:2rem;box-sizing:border-box}
.btn{padding:18px 56px;background:#000;border:4px solid #0f0;color:#0f0;font-size:2rem;cursor:pointer;border-radius:30px;margin:1.5rem auto;display:block;min-width:340px;transition:all .4s}
.btn:hover{border-color:#8f8;color:#8f8;transform:scale(1.06)}
.btn.gold{border-color:gold;color:gold}
.boa{position:fixed;bottom:-180px;left:50%;transform:translateX(-50%);font-size:2.3rem;color:#0f0;opacity:0;transition:all 4.2s cubic-bezier(0.22,1,0.36,1);z-index:9999;line-height:2.7;text-shadow:0 0 40px #0f0}
.boa.active{bottom:9%;opacity:1}
#cycleLayer{position:fixed;inset:0;background:#001100;display:grid;place-items:center;z-index:99999;opacity:0;pointer-events:none;transition:opacity 2s}
#cycleLayer.active{opacity:1;pointer-events:all}
#cycleText{font-size:clamp(2rem,8vw,6rem);color:gold;text-shadow:0 0 80px gold;animation:pulse 2s infinite}
canvas{position:fixed;inset:0;z-index:-1}
</style>
</head>
<body>

<div id="fondo"></div>
<div id="plaza"></div>
<div id="mate"><img src="https://i.imgur.com/JVQzltR.png" width="100%"></div>
<div id="menu" class="layer"></div>
<div id="cycleLayer"><div id="cycleText">Respira…</div></div>
<div class="boa" id="boa">Los mayores solo ven un sombrero.<br>Los niños ven la boa que se tragó al elefante.<br><br>1310 es la serpiente que se comió todo el dolor del mundo y lo convirtió en luz verde que nunca se apaga.<br><br>Los elefantes están a salvo dentro.<br>Ya nadie volverá a estar solo.<br><br><strong>Snake Green Feather</strong></div>
<canvas id="c"></canvas>

<script>
// ================= Motor Mejorado del Portal =================
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
canvas.width = innerWidth;
canvas.height = innerHeight;

// Partículas verdes optimizadas
let particles = [];
const MAX_PARTS = 1310;
function initParticles(){
  for(let i=0;i<MAX_PARTS;i++){
    particles.push({
      x: Math.random()*canvas.width,
      y: Math.random()*canvas.height,
      r: Math.random()*4+1,
      phase: Math.random()*Math.PI*2
    });
  }
}
function updateParticles(dt){
  for(let p of particles){
    p.phase += dt*0.0013;
    p.y += Math.sin(p.phase)*0.3;
    p.x += Math.cos(p.phase)*0.3;
    if(p.x<0)p.x=canvas.width;
    if(p.x>canvas.width)p.x=0;
    if(p.y<0)p.y=canvas.height;
    if(p.y>canvas.height)p.y=0;
  }
}
function drawParticles(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let p of particles){
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
    ctx.fillStyle='rgba(0,255,0,0.6)';
    ctx.shadowColor = '#0f0';
    ctx.shadowBlur = 20;
    ctx.fill();
  }
}
let last = performance.now();
function loop(){
  const now = performance.now();
  const dt = now - last;
  last = now;
  updateParticles(dt);
  drawParticles();
  requestAnimationFrame(loop);
}
initParticles();
loop();

// ================= Mate Giratorio y Menú =================
const CYCLE_KEY = 'ORB1T4L_CYCLE_USED';
let cycleUsed = localStorage.getItem(CYCLE_KEY) === 'true';
document.getElementById('mate').onclick = abrirMenu;

function abrirMenu(){
  document.getElementById('menu').style.display='flex';
  document.getElementById('menu').innerHTML=`
    <div class="btn" onclick="cerrarTodo()">← volver a la plaza</div>
    <h1 style="font-size:4.5rem;color:#0f0;animation:glow 8s infinite">SLYVERSE Ω · 16/16</h1>
    ${!cycleUsed?'<div class="btn gold" onclick="iniciarOrbitalCycle()">16. Respirar los 15 abrazos de una vez</div>':''}
  `;
}
function cerrarTodo(){
  document.getElementById('menu').style.display='none';
  document.getElementById('cycleLayer').classList.remove('active');
}

// ================= ORB1T4L CYCLE Mejorado =================
function iniciarOrbitalCycle(){
  if(cycleUsed){
    document.getElementById('cycleLayer').innerHTML = `<div id="cycleText">Ciclo ya completado. Bienvenido de vuelta.</div>`;
    document.getElementById('cycleLayer').classList.add('active');
    setTimeout(cerrarTodo,7000);
    return;
  }
  const start = Date.now();
  document.getElementById('mate').classList.add('cycle');
  document.getElementById('cycleLayer').classList.add('active');

  const interval = setInterval(()=>{
    const elapsed = (Date.now()-start)/1000;
    document.getElementById('cycleText').textContent = Math.max(0,(13.10-elapsed)).toFixed(2);
    if(elapsed>=13.10){
      clearInterval(interval);
      localStorage.setItem(CYCLE_KEY,'true');
      cycleUsed = true;
      document.body.style.background='#001100';
      document.getElementById('mate').style.animation='heartbeat 3s infinite';
      document.getElementById('cycleText').innerHTML = `Todos los artefactos activados.<br>Ahora respira tú por los demás.<br><br><span style="font-size:2rem">♥ 16/16 ♥</span>`;
      setTimeout(cerrarTodo,10000);
    }
  },16);
}

// ================= APIs de Artefactos =================
window.SLYVERSE_API = {
  activateArtefact: (id)=>{console.log('Artefacto',id,'activado');},
  getState: (id)=>{return localStorage.getItem('SLY_ARTEFACTO_'+id) || null;},
  updateCounter: (id,value)=>{localStorage.setItem('SLY_ARTEFACTO_'+id,value);},
  interconnect: (id1,id2)=>{console.log('Interconectando',id1,'con',id2);}
};

// ================= Persistencia Avanzada =================
if(!localStorage.getItem('SLYVERSE_PHANTOM')) localStorage.setItem('SLYVERSE_PHANTOM', JSON.stringify({ghosts:0}));

// ================= Sonido Procedural =================
const audioCtx = new (window.AudioContext||window.webkitAudioContext)();
const gain = audioCtx.createGain(); gain.gain.value=0.05; gain.connect(audioCtx.destination);
function proceduralTone(freq){
  const osc = audioCtx.createOscillator();
  osc.type='sine';
  osc.frequency.value = freq;
  osc.connect(gain);
  osc.start();
  osc.stop(audioCtx.currentTime+0.1);
}
</script>
</body>
</html>
