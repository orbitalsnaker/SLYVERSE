<!DOCTYPE html>
<html lang="es">
<meta charset="utf-8">
<title>THUAMER Ω</title>
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
<style>
  body{margin:0;height:100vh;background:#000;overflow:hidden;position:fixed}
  canvas{position:fixed;inset:0;display:block;image-rendering:optimizeSpeed}
</style>
<canvas id="c"></canvas>
<script>
/*
  13 101 310 horas → 47 164 716 000 000 ms
  koan ejecutable · ronin 0rb1t4lsn4k3r
*/

const KOAN = 47164716000000n
const KEY  = "thuamer13101310"

let state = (() => {
  try { return JSON.parse(localStorage.getItem(KEY)) || {} }
  catch { return {} }
})()

let t   = BigInt(state.t   || 0)        // tiempo colectivo acumulado
let id  = state.id  || crypto.randomUUID()
let born= state.first || Date.now()
let zen = !!state.unlocked              // satori alcanzado

let prev = performance.now()
let birth = zen ? prev : 0

const c   = document.getElementById("c")
const ctx = c.getContext("2d", {alpha:false,desynchronized:true,willReadFrequently:false})

const resize = () => {
  const dpr = devicePixelRatio
  c.width  = innerWidth  * dpr
  c.height = innerHeight * dpr
  ctx.setTransform(dpr,0,0,dpr,0,0)
}
resize()
addEventListener("resize", resize)

const persist = () => {
  try {
    localStorage.setItem(KEY, JSON.stringify({
      t: t < Number.MAX_SAFE_INTEGER ? Number(t) : Number.MAX_SAFE_INTEGER,
      id, first: born, unlocked: zen
    }))
  } catch{}
}

const tick = now => {
  if (!document.hidden && document.hasFocus()) {
    const δ = BigInt(Math.floor(now - prev))
    if (δ > 0n) { t += δ; persist() }
  }
  prev = now

  if (!zen && t >= KOAN) { zen = true; birth = now; persist() }

  const w = innerWidth, h = innerHeight

  if (zen) {
    const cycle = 5400000
    const τ = birth ? (now - birth) % cycle : 0

    ctx.fillStyle = "#00ff00"
    ctx.fillRect(0,0,w,h)

    const N = 13101310
    const visible = Math.min(N, Math.floor(τ / 7))
    const base = τ * 0.001

    for (let i = 0; i < visible; i++) {
      const p = base + i * 0.007
      const θ = (i / N) * Math.PI * 2 + p * 5e-5
      const r = 120 + Math.sin(p + i * 0.001) * 380
      const x = w/2 + Math.cos(θ) * r
      const y = h/2 + Math.sin(θ) * r
      const a = Math.max(0, Math.sin(p*10 + i*0.13)) * 0.38

      ctx.fillStyle = `rgba(0,0,0,${a})`
      ctx.fillRect(x-20, y-40, 40, 80)
      ctx.fillRect(x-40, y-20, 80, 40)
    }

    ctx.textAlign = "center"
    ctx.textBaseline = "middle"

    if (Math.floor((Date.now() - born)/864e5) > 300 && τ > 10000 && τ < 20000) {
      ctx.fillStyle = "#000"
      ctx.font = "bold 5.5vw Georgia"
      ctx.fillText("volviste después de tanto tiempo", w/2, h/2)
    }
    const hr = new Date().getHours()
    if (hr >= 3 && hr <= 5 && τ > 30000 && τ < 40000) {
      ctx.fillStyle = "#000"
      ctx.font = "3.8vw Georgia"
      ctx.fillText("otra madrugada más, gracias por quedarte", w/2, h/2 + 100)
    }
    if (τ > 5000000) {
      ctx.fillStyle = "#000"
      ctx.font = "bold 12vw Georgia"
      ctx.fillText("siempre fuiste vos", w/2, h/2)
    }

  } else {
    const g = Math.min(255, Math.floor(Number(t)/Number(KOAN)*311))
    ctx.fillStyle = `rgb(0,${g},0)`
    ctx.fillRect(0,0,w,h)
  }

  requestAnimationFrame(tick)
}

requestAnimationFrame(tick)
</script>