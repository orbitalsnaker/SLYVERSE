<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>RŌNIN PEN v4 ONI OFFLINE — 25 € · 2026</title>
<style>
:root{--bg:#000;--dark:#0a0a0a;--fg:#0f0;--acc:#0ff;--r:#f00}
*{margin:0;padding:0;box-sizing:border-box}
body{background:var(--bg);color:var(--fg);font-family:"Courier New",monospace;overflow:hidden;height:100vh;display:grid;place-items:center}
.card{background:var(--dark);border:3px solid var(--acc);width:1180px;max-width:96%;height:92vh;box-shadow:0 0 0 120px var(--acc);padding:30px;border-radius:16px;position:relative}
.header{font-size:16px;letter-spacing:10px;color:var(--acc);text-align:center;margin-bottom:20px;text-shadow:0 0 30px}
.main{display:grid;grid-template-columns:1fr 500px;gap:32px;height:100%}
.left{gap:22px;display:grid;grid-template-rows:auto 1fr auto}
pre,.log{background:#000;border:2px solid var(--acc);padding:16px;border-radius:8px;font-size:12.5px;overflow:auto;height:180px}
input,select{background:#000;border:2px solid var(--acc);color:var(--fg);padding:12px;border-radius:6px;font-size:14px;width:100%}
.gauge{height:32px;background:#111;border:2px solid #333;border-radius:6px;overflow:hidden;position:relative;margin:8px 0}
.fill{background:linear-gradient(90deg,#0ff,#f36f6f);height:100%;width:0%;transition:all .4s}
.label{font-size:14px;color:#0cf;display:flex;justify-content:space-between}
.value{color:var(--acc);font-weight:bold;font-size:16px}
.title{font-size:18px;color:var(--acc);letter-spacing:4px;margin:16px 0 8px}
.price{position:absolute;bottom:30px;left:50%;transform:translateX(-50%);font-size:48px;color:var(--r);text-shadow:0 0 60px var(--r)}
#humo{position:fixed;inset:0;background:rgba(255,0,0,0.2);pointer-events:none;opacity:0;transition:1s;z-index:999}
.link{color:#0ff;text-decoration:underline;cursor:pointer}
</style>
</head>
<body>

<div class="card">
  <div class="header">RŌNIN PEN v4 ONI OFFLINE // 25 € // 2026</div>
  <div class="price">25 €</div>

  <div class="main">
    <div class="left">
      <div>
        <div class="title">> BARRIO CONSOLE</div>
        <input id="cmd" placeholder="help | smoke | onimode | buy | clear" autocomplete="off">
        <pre id="log" class="log">
<span style="color:#0ff">RŌNIN PEN v4 ONI OFFLINE — firmware 4.0.0 — 08-dic-2025</span>
Motor 1724SR · stroke 6-11mm · WS2812B Sharingan
Precio demoníaco: <span style="color:#f36f6f">25 €</span> todo nuevo
Escribe "onimode" → Genera oni procedural offline · "smoke" → Tinta sangrante
        </pre>
      </div>

      <div>
        <div class="title">> CONTROLES EN VIVO</div>
        <div class="label">Stroke <span class="value" id="stroke">96</span> mm</div>
        <div class="gauge"><div id="fill_s" class="fill"></div></div>
        <input type="range" min="60" max="110" value="96" id="strokeSlider">

        <div class="label">Voltage <span class="value" id="volt">8.3</span> V</div>
        <div class="gauge"><div id="fill_v" class="fill"></div></div>
        <input type="range" min="50" max="90" step="1" value="83" id="voltSlider">

        <div class="label">Haptic <span class="value" id="haptic">88</span>%</div>
        <div class="gauge"><div id="fill_h" class="fill"></div></div>
        <input type="range" min="0" max="100" value="88" id="hapticSlider">

        <div class="label">Intensidad ONI <span class="value" id="oniInt">50</span>%</div>
        <div class="gauge"><div id="fill_o" class="fill"></div></div>
        <input type="range" min="0" max="100" value="50" id="oniSlider">

        <div class="label">Modo <span class="value" id="modo">BARRIO</span></div>
        <select id="modoSelect">
          <option>BARRIO</option>
          <option>ONI</option>
          <option>THETA</option>
          <option>KUNGFU</option>
        </select>
      </div>

      <div style="text-align:center;color:#555;font-size:12px">
        <span class="link" onclick="showBOM()">BOM AliExpress 25 € →</span> · 100 % open source · CC0 · ONI procedural offline
      </div>
    </div>

    <div class="right">
      <div class="title">> 3D REAL-TIME — GIRA CON RATÓN (TATÚA ONI OFFLINE)</div>
      <canvas id="preview" width="500" height="420"></canvas>
    </div>
  </div>
</div>

<div id="humo"></div>

<div id="bom" style="position:fixed;inset:0;background:rgba(0,0,0,0.97);z-index:1000;display:none;padding:40px;overflow-y:auto;color:#0ff;font-size:15px">
  <span class="close" onclick="this.parentNode.style.display='none'" style="position:absolute;top:20px;right:30px;font-size:50px;color:#f00;cursor:pointer">×</span>
  <h2 style="text-align:center;margin:30px 0;color:#0ff">RŌNIN PEN v4 ONI — BOM 25 € (2025-2026)</h2>
  <table style="width:100%;border-collapse:collapse;margin:20px 0">
    <tr style="background:#111"><th>Pieza</th><th>Precio</th><th>Link AliExpress (2025)</th></tr>
    <tr><td>Motor 1724SR Faulhaber clone</td><td>11-13 €</td><td><a href="https://s.click.aliexpress.com/e/_dW1TjYk" target="_blank">1724SR clone 12 €</a></td></tr>
    <tr><td>ESP32-C3 supermini</td><td>1.8 €</td><td><a href="https://s.click.aliexpress.com/e/_A9v6vM" target="_blank">ESP32-C3</a></td></tr>
    <tr><td>Driver TB6612FNG</td><td>1.5 €</td><td><a href="https://s.click.aliexpress.com/e/_dYkG4p0" target="_blank">TB6612</a></td></tr>
    <tr><td>WS2812B ring 8 LEDs</td><td>1.8 €</td><td><a href="https://s.click.aliexpress.com/e/_ddkF9rJ" target="_blank">Ring 8 LEDs</a></td></tr>
    <tr><td>Haptic 0827 coin motor</td><td>0.7 €</td><td><a href="https://s.click.aliexpress.com/e/_dW8j5pY" target="_blank">0827 vibe</a></td></tr>
    <tr><td>18650 2S holder + TP4056</td><td>1.2 €</td><td><a href="https://s.click.aliexpress.com/e/_dTj2f5K" target="_blank">2S holder</a></td></tr>
    <tr><td>Partes 3D (PLA+/PETG)</td><td>6-8 €</td><td>Imprime tú o servicio local</td></tr>
  </table>
  <p style="text-align:center;color:#0f0;font-size:20px;margin-top:40px">
    Total oni: <b>25-27 €</b> · Procedural offline · Namasté demonio
  </p>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.168.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.168.0/examples/js/controls/OrbitControls.js"></script>

<script>
let stroke=96, volt=8.3, haptic=88, modo="BARRIO", oniInt=50;
const log = document.getElementById("log");
function l(m){ log.innerHTML += m + "<br>"; log.scrollTop = log.scrollHeight; }

document.getElementById("cmd").addEventListener("keypress", e => {
  if(e.key !== "Enter") return;
  const cmd = e.target.value.trim().toLowerCase();
  l("$ " + cmd);
  e.target.value = "";

  if(cmd === "help") l("smoke | onimode | buy | clear | oni 75");
  if(cmd === "smoke" || cmd === "onimode"){
    modo = "ONI";
    document.getElementById("modoSelect").value = "ONI";
    document.getElementById("modo").textContent = "ONI";
    document.getElementById("humo").style.opacity = 0.6;
    setTimeout(()=>document.getElementById("humo").style.opacity=0, 6000);
    l("ONI MODE OFFLINE — máscara procedural generada");
    generarOniProcedural();
  }
  if(cmd.startsWith("oni ")) { oniInt = Math.min(100, Math.max(0, parseInt(cmd.split(" ")[1]) || 50)); updateOniInt(); l(`Intensidad ONI: ${oniInt}%`); }
  if(cmd === "buy") showBOM();
  if(cmd === "clear") log.innerHTML = "";
});

// Sliders
["stroke","volt","haptic","oni"].forEach(p => {
  document.getElementById(p+"Slider").addEventListener("input", e => {
    const val = p==="volt" ? (e.target.value/10) : +e.target.value;
    window[p === "oni" ? "oniInt" : p] = val;
    document.getElementById(p).textContent = val;
    const perc = p==="volt" ? (val-5)/(9-5)*100 : p==="oni" ? val : p==="stroke" ? (val-60)/(110-60)*100 : val;
    document.getElementById("fill_"+(p==="oni"?"o":p[0])).style.width = perc + "%";
    if(p==="oni") generarOniProcedural(); // Regenera con nueva intensidad
  });
});

document.getElementById("modoSelect").onchange = e => {
  modo = e.target.value;
  document.getElementById("modo").textContent = modo;
  if(modo === "ONI") generarOniProcedural();
  else l("Modo " + modo + " — ONI es el rey offline");
};

function updateOniInt() {
  document.getElementById("oniSlider").value = oniInt;
  document.getElementById("oniInt").textContent = oniInt;
  document.getElementById("fill_o").style.width = oniInt + "%";
}

function showBOM(){ document.getElementById("bom").style.display = "block"; }

// ---------- 3D ----------
const scene = new THREE.Scene(); scene.background = new THREE.Color(0x000000);
const camera = new THREE.PerspectiveCamera(50, 500/420, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({canvas: document.getElementById("preview"), antialias: true});
renderer.setSize(500,420);
const controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;

scene.add(new THREE.AmbientLight(0x404040));
const light = new THREE.DirectionalLight(0x00ffff, 3);
light.position.set(5,10,7); scene.add(light);

const pen = new THREE.Group();
const cuerpo = new THREE.Mesh(new THREE.CylinderGeometry(1,1,9,32), new THREE.MeshPhongMaterial({color:0x0f0f0f, metalness:0.9}));
pen.add(cuerpo);
const grip = new THREE.Mesh(new THREE.CylinderGeometry(1.4,1.6,4,32), new THREE.MeshPhongMaterial({color:0xff3366}));
grip.position.y = -5.5; pen.add(grip);
const ecc = new THREE.Mesh(new THREE.SphereGeometry(0.6,32,16), new THREE.MeshPhongMaterial({color:0x00ffff, emissive:0x00ffff}));
ecc.position.y = 4.2; pen.add(ecc);

const skin = new THREE.Mesh(
  new THREE.PlaneGeometry(12,12),
  new THREE.MeshBasicMaterial({color:0xffdbac, side: THREE.DoubleSide})
);
skin.rotation.x = -Math.PI/2;
skin.position.y = -6;
scene.add(skin);
scene.add(pen);
camera.position.set(15,10,15);

// ---------- GENERADOR ONI PROCEDURAL OFFLINE ----------
let tatuajeCanvas = document.createElement("canvas");
tatuajeCanvas.width = 512; tatuajeCanvas.height = 512;
const tatuajeCtx = tatuajeCanvas.getContext("2d");

function generarOniProcedural() {
  l("Generando ONI procedural offline... intensidad " + oniInt + "%");
  
  // Fondo blanco para stencil
  tatuajeCtx.fillStyle = "#fff";
  tatuajeCtx.fillRect(0, 0, 512, 512);
  
  // Ruido textura tinta (simple Perlin-like)
  for(let x=0; x<512; x+=4) for(let y=0; y<512; y+=4) {
    tatuajeCtx.fillStyle = `rgba(0,0,0,${Math.random()*0.05})`;
    tatuajeCtx.fillRect(x, y, 4, 4);
  }
  
  // Cara oni base (óvalo asimétrico)
  tatuajeCtx.save();
  tatuajeCtx.translate(256, 256);
  const scale = 1 + (oniInt / 100) * 0.3; // Más intenso = más grande
  tatuajeCtx.scale(scale, scale);
  
  // Relleno rojo/negro
  tatuajeCtx.fillStyle = "#000"; // Tinta negra base
  tatuajeCtx.beginPath();
  tatuajeCtx.ellipse(0, 0, 180, 220, 0, 0, Math.PI*2); // Cara oval
  tatuajeCtx.fill();
  
  // Cuernos (procedural, random)
  for(let i=0; i<2; i++) {
    const side = i ? 1 : -1;
    const len = 80 + Math.random()*40 + (oniInt/100)*30;
    const curve = 0.3 + Math.random()*0.4;
    tatuajeCtx.beginPath();
    tatuajeCtx.moveTo(side * 60, -80);
    tatuajeCtx.quadraticCurveTo(side * 120 * curve, -len * 0.7, side * 80, -len);
    tatuajeCtx.quadraticCurveTo(side * 40 * curve, -len * 0.3, side * 20, -len * 0.5);
    tatuajeCtx.lineTo(side * 30, -len * 0.8);
    tatuajeCtx.lineTo(side * 50, -len);
    tatuajeCtx.closePath();
    tatuajeCtx.fillStyle = "#8B0000"; // Rojo sangre
    tatuajeCtx.fill();
  }
  
  // Ojos fieros (rojos con glow cyber)
  for(let i=0; i<2; i++) {
    const side = i ? 1 : -1;
    tatuajeCtx.beginPath();
    tatuajeCtx.arc(side * 70, -40, 25 + (oniInt/100)*10, 0, Math.PI*2);
    tatuajeCtx.fillStyle = "#ff0000";
    tatuajeCtx.fill();
    // Glow neon
    tatuajeCtx.shadowColor = "#ff0000";
    tatuajeCtx.shadowBlur = 10 + oniInt/2;
    tatuajeCtx.fill();
    tatuajeCtx.shadowBlur = 0;
    // Pupila negra
    tatuajeCtx.beginPath();
    tatuajeCtx.arc(side * 70, -40, 8, 0, Math.PI*2);
    tatuajeCtx.fillStyle = "#000";
    tatuajeCtx.fill();
  }
  
  // Colmillos (random irregulares)
  for(let i=0; i<4; i++) {
    const side = i % 2 ? 1 : -1;
    const row = Math.floor(i/2);
    const len = 20 + Math.random()*15 + (oniInt/100)*10;
    tatuajeCtx.beginPath();
    tatuajeCtx.moveTo(side * (40 + row*20), 60 + row*15);
    tatuajeCtx.lineTo(side * (30 + row*15), 60 + len + row*15);
    tatuajeCtx.lineTo(side * (50 + row*25), 60 + len + row*15);
    tatuajeCtx.closePath();
    tatuajeCtx.fillStyle = "#fff"; // Blanco hueso
    tatuajeCtx.fill();
  }
  
  // Boca gruñona
  tatuajeCtx.beginPath();
  tatuajeCtx.arc(0, 80, 60, 0, Math.PI);
  tatuajeCtx.strokeStyle = "#000"; tatuajeCtx.lineWidth = 8;
  tatuajeCtx.stroke();
  
  tatuajeCtx.restore();
  
  // Textura final "tinta corrida" si intensidad alta
  if(oniInt > 70) {
    for(let i=0; i<50; i++) {
      tatuajeCtx.beginPath();
      tatuajeCtx.moveTo(Math.random()*512, Math.random()*512);
      tatuajeCtx.lineTo(Math.random()*512, Math.random()*512);
      tatuajeCtx.strokeStyle = `rgba(139,0,0,${Math.random()*0.3})`;
      tatuajeCtx.lineWidth = 1 + Math.random()*2;
      tatuajeCtx.stroke();
    }
  }
  
  // Aplica a THREE texture
  const texture = new THREE.CanvasTexture(tatuajeCanvas);
  skin.material.map = texture;
  skin.material.needsUpdate = true;
  l("ONI generado offline — ¡tinta en la piel!");
}

// Primera gen BARRIO simple (placeholder)
tatuajeCtx.fillStyle = "#000";
tatuajeCtx.font = "bold 48px Courier";
tatuajeCtx.fillText("BARRIO", 180, 256);

// Animación
function animate() {
  requestAnimationFrame(animate);
  pen.rotation.y += 0.008;
  ecc.position.y = 4.2 + Math.sin(Date.now() * 0.015) * (stroke/110 * 2);
  if(modo === "ONI") {
    // Glow rojo en ring
    ring.material.emissive.setHex(0xff0000 * (oniInt/100));
  }
  controls.update();
  renderer.render(scene, camera);
}
let ring; // Definir ring si no existe
animate();
</script>
</body>
</html>