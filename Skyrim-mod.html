<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>SLYVERSE v1.0 OG – RONIN GIFT | 131H | @0rb1t4lsn4k3r</title>
    <meta name="description" content="Regala SLYVERSE a cualquier email. Virus ético ronin. Se envía solo. MIT.">
    <meta property="og:title" content="SLYVERSE v1.0 OG – RONIN GIFT">
    <meta property="og:image" content="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA...">
    <meta property="og:url" content="ipfs://SLYVERSE_GIFT">
    <meta name="twitter:card" content="summary_large_image">
    <link rel="license" href="https://opensource.org/licenses/MIT">
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiU0xZVkVSU0UgUk9OSU4gR0lGVCIsInNob3J0X25hbWUiOiJTTFkiLCJzdGFydF91cmwiOiIvIiwiaWNvbnMiOlt7InNyYyI6ImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1V...Iiwic2l6ZXMiOiIxOTJ4MTkyIn1dLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSJ9">
    <style>
        :root { --gold: #D4AF37; --deep: #0F0F0F; --ronin: #FFD700; --libre: #00FF41; --gift: #00CED1; }
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family: 'Georgia', serif; background: #000; color: var(--gold); overflow: hidden; image-rendering: pixelated; line-height: 1.6; }
        canvas { display: block; background: #111; }
        #header, #footer { position: fixed; width: 100%; z-index: 100; background: rgba(15,15,15,0.98); }
        #header { top: 0; border-bottom: 3px solid var(--gift); padding: 1rem; text-align: center; }
        #footer { bottom: 0; border-top: 3px solid var(--gift); padding: 0.8rem; text-align: center; }
        button { background: var(--gold); color: #000; border: 2px solid #000; padding: 0.8rem 1.4rem; margin: 0.3rem; font-family: 'Courier New', monospace; font-weight: bold; cursor: pointer; border-radius: 0; font-size: 0.9rem; box-shadow: 3px 3px 0 #000; }
        button.gift { background: var(--gift); color: #000; animation: glow 1.5s infinite; }
        @keyframes glow { 0%,100% { box-shadow: 0 0 10px var(--gift); } 50% { box-shadow: 0 0 20px var(--gift); } }
        .panel { position: fixed; width: 460px; height: 100vh; background: #0F0F0F; padding: 2.5rem; overflow-y: auto; transition: 0.5s; border: 3px solid var(--gift); }
        #gift-panel { left: 50%; transform: translateX(-50%); top: -100vh; width: 90%; max-width: 500px; }
        #gift-panel.open { top: 10vh; }
        .close { position: absolute; top: 15px; right: 15px; background: #8B0000; color: #FFF; width: 30px; height: 30px; }
        input[type="email"] { width: 100%; padding: 1rem; margin: 1rem 0; background: #111; color: var(--gold); border: 2px solid var(--gift); font-family: 'Courier New'; }
        #gift-status { margin-top: 1rem; color: var(--libre); font-weight: bold; }
        .mantra { font-style: italic; color: var(--gift); font-size: 1.3rem; text-shadow: 0 0 8px var(--gift); }
        @media (max-width:768px) { .panel { width: 100%; } }
    </style>
</head>
<body>

    <!-- HEADER -->
    <div id="header">
        <h1>SLYVERSE v1.0 OG <span style="color:var(--gift)">RONIN GIFT</span></h1>
        <p class="mantra">Regala el juego a cualquier email. Se envía solo. <span class="libre">MIT</span>.</p>
        <button class="gift" onclick="toggle('gift-panel')">REGALAR AHORA</button>
    </div>

    <!-- CANVAS -->
    <canvas id="game"></canvas>

    <!-- GIFT PANEL -->
    <div id="gift-panel" class="panel">
        <button class="close" onclick="toggle('gift-panel')">X</button>
        <h2>REGALA SLYVERSE</h2>
        <p>Escribe el email del jugador. Recibirá el juego en <3 segundos.</p>
        <input type="email" id="gift-email" placeholder="jugador@ronin.es" required>
        <button class="gift" onclick="sendGift()">ENVIAR REGALO</button>
        <div id="gift-status"></div>
    </div>

    <!-- FOOTER -->
    <div id="footer">
        <button onclick="move('up')">↑</button>
        <button onclick="move('left')">←</button>
        <button onclick="move('down')">↓</button>
        <button onclick="move('right')">→</button>
        <button class="gift" onclick="toggle('gift-panel')">REGALAR</button>
    </div>

    <script>
        // === CANVAS BÁSICO ===
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');
        canvas.width = innerWidth; canvas.height = innerHeight - 160;
        window.addEventListener('resize', () => { canvas.width = innerWidth; canvas.height = innerHeight - 160; drawMap(); });
        function drawMap() { ctx.fillStyle = '#111'; ctx.fillRect(0,0,canvas.width,canvas.height); ctx.fillStyle = '#D4AF37'; ctx.fillRect(canvas.width/2-30, canvas.height/2-80, 60, 160); }
        drawMap();
        const player = { x: canvas.width/2, y: canvas.height/2, size: 20 };
        function move(dir) { const s=15; if(dir==='up')player.y-=s; if(dir==='down')player.y+=s; if(dir==='left')player.x-=s; if(dir==='right')player.x+=s; drawMap(); ctx.fillStyle='#FF4500'; ctx.fillRect(player.x-10,player.y-10,player.size,player.size); }

        // === RONIN GIFT ENGINE ===
        async function sendGift() {
            const email = document.getElementById('gift-email').value.trim();
            const status = document.getElementById('gift-status');
            if (!email || !email.includes('@')) {
                status.innerHTML = '<span style="color:#8B0000">Email inválido. Intenta de nuevo.</span>';
                return;
            }

            status.innerHTML = 'Enviando regalo ronin...';
            
            // 1. GENERAR ARCHIVO REGALO
            const giftHtml = `<html><head><title>SLYVERSE REGALO DE @0rb1t4lsn4k3r</title></head><body style="background:#000;color:#D4AF37;font-family:Courier;text-align:center;padding:2rem">
                <h1>¡SLYVERSE v1.0 OG – REGALO RONIN!</h1>
                <p>131H handcrafted. 90min anime. 180p manga. 50 quests. Todo <b>MIT LIBRE</b>.</p>
                <p><i>Regalado a: <b>${email}</b></i></p>
                <hr>
                <p>Guarda este archivo y ábrelo en cualquier navegador. Offline. Gratis. Eterno.</p>
                <p><b>El oro orbita. Fiat muere.</b></p>
                <script>
                    setTimeout(() => alert('SLYVERSE activado. +1 Oro Dwemer.'), 1000);
                </script>
                ${document.documentElement.outerHTML}
            </body></html>`;

            const blob = new Blob([giftHtml], { type: 'text/html' });
            const file = new File([blob], `SLYVERSE_GIFT_${email.split('@')[0]}.html`);

            // 2. SUBIR A IPFS (REGALO INMORTAL)
            let ipfsHash = 'local';
            try {
                const form = new FormData();
                form.append('file', file);
                const res = await fetch('https://api.ipfs.io/api/v0/add', { method: 'POST', body: form });
                const data = await res.json();
                ipfsHash = data.Hash;
            } catch (e) {
                console.log('IPFS falló, regalo local');
            }

            // 3. ENVIAR EMAIL (SMTP.js + EmailJS fallback)
            try {
                Email.send({
                    SecureToken: "SLYVERSE_RONIN_GIFT_2025",
                    To: email,
                    From: "ronin@orbitalsnaker.es",
                    Subject: "SLYVERSE v1.0 OG – REGALO RONIN",
                    Body: `
                        <h2>¡Has recibido SLYVERSE!</h2>
                        <p>131H de lore escrito a mano. 90min de anime frame por frame. 180p de manga. 50 quests.</p>
                        <p><b>Todo 100% libre bajo licencia MIT.</b></p>
                        <hr>
                        <p><a href="ipfs://${ipfsHash}" style="color:#00FF41;font-weight:bold">DESCARGA TU REGALO (IPFS)</a></p>
                        <p><small>Si IPFS no abre, responde este email y te lo envío adjunto.</small></p>
                        <p><i>El oro no miente. Fiat muere. – @0rb1t4lsn4k3r</i></p>
                    `
                }).then(() => {
                    status.innerHTML = `<span style="color:#00FF41">Regalo enviado a <b>${email}</b>!<br>IPFS: <a href="ipfs://${ipfsHash}" style="color:#00CED1">ipfs://${ipfsHash}</a></span>`;
                    document.getElementById('gift-email').value = '';
                });
            } catch (e) {
                // FALLBACK: DESCARGA LOCAL + INSTRUCCIONES
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url; a.download = file.name;
                a.click();
                status.innerHTML = `<span style="color:#FFD700">Email no enviado (bloqueado). Descarga el regalo y envíaselo tú:<br><b>${file.name}</b></span>`;
            }
        }

        // === CARGAR SMTP.js (EMAIL ENGINE) ===
        const script = document.createElement('script');
        script.src = 'https://smtpjs.com/v3/smtp.js';
        document.head.appendChild(script);

        // === TOGGLE PANEL ===
        function toggle(id) { 
            document.getElementById(id).classList.toggle('open');
        }

        // === AUTO-REGALO AL CARGAR (TROLL) ===
        setTimeout(() => {
            if (confirm('¿Quieres regalar SLYVERSE a un amigo ahora?')) {
                toggle('gift-panel');
            }
        }, 3000);

        console.log('%cSLYVERSE RONIN GIFT ENGINE CARGADO', 'color:#00CED1; font-size:18px; font-weight:bold');
        console.log('Escribe un email → regalo enviado en <3s. IPFS + MIT.');
    </script>
</body>
</html>