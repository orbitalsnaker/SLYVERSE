<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SLYVERSE Ω v1.3 – THUAMER 1310 + VOYNICH</title>
  <style>
    * { margin:0; padding:0; overflow:hidden; }
    body { background:#000; color:#0f0; font-family:monospace; }
    canvas { display:block; }
    #ui { position:fixed; top:10px; left:10px; z-index:10; opacity:0.8; }
    #a { font-size:24px; font-weight:bold; }
    #log { margin-top:10px; font-size:12px; max-height:200px; overflow-y:auto; }
    button { margin:5px; padding:8px; background:#111; color:#0f0; border:1px solid #0f0; }
  </style>
</head>
<body>
  <canvas id="c"></canvas>
  <div id="ui">
    <div>AURUM: <span id="a">0</span></div>
    <div id="log"></div>
    <button onclick="toggleManifest()">R: Manifiesto</button>
    <button onclick="copyHaiku()">ESPACIO: Haiku + Tx</button>
    <button onclick="initVR()">VR</button>
    <button onclick="startP2P()">P2P</button>
    <button onclick="simulateArweave()">Arweave</button>
    <button onclick="loadVoynich()">VOYNICH</button>
  </div>

  <script>
    // === SLYVERSE Ω v1.3 – THUAMER 1310 + VOYNICH INTEGRADO ===
    // Autor: 0rb1t4lsn4k3r | 16 nov 2025, 18:34 CET, ES
    // Licencia: MIT | 45 KB → 48 KB con Voynich
    // Estado: v1.3-voynich | aurum.v > 131000 → Behemoths despiertan

    let w = innerWidth, h = innerHeight, t = 0, f = 0;
    const c = document.getElementById('c'), x = c.getContext('2d');
    const off = new OffscreenCanvas(w, h), ox = off.getContext('2d');
    c.width = w; c.height = h;

    // Estado orbital
    const s = {x:10, y:10, z:0, dx:1, dy:0, dz:0, shadow:0};
    let aurum = new Proxy({v:0}, {
      set: (o,p,v) => {
        o[p] = v;
        document.getElementById('a').textContent = v;
        s.shadow = v > 1310 ? v/1310 : 0;
        if (v > 131) log('PRIMERA EMPIRE CAÍDA');
        if (v > 1310) log('BEHEMOTHS DESPIERTAN');
        if (v > 131000) log('VOYNICH DESPIERTA');
        return true;
      }
    });

    // UI & Log
    function log(msg) {
      const l = document.getElementById('log');
      l.innerHTML += `<div>${msg}</div>`;
      l.scrollTop = l.scrollHeight;
    }

    // === THUAMER VOYNICH DB ===
    const THUAMER_VOYnich_DB = {
      version: "1.3-voynich",
      status: "ready",
      pages: [],
      runes: new Map(),
      hypotheses: [],
      aurum_threshold: 131000
    };

    // === LOOP PRINCIPAL ===
    function loop() {
      f++; t = Date.now() / 1310;

      // Física orbital
      s.dx = Math.cos(t); s.dy = Math.sin(t); s.dz = Math.sin(t*0.5);
      s.x += s.dx * 0.12; s.y += s.dy * 0.12; s.z += s.dz * 0.08;
      if (s.x < 0 || s.x > 20) s.dx *= -1;
      if (s.y < 0 || s.y > 20) s.dy *= -1;
      if (Math.abs(s.z) > 5) s.dz *= -1;

      // Aurum boost
      if (Math.random() < 0.065) aurum.v++;

      // Render offscreen
      ox.fillStyle = '#000'; ox.fillRect(0,0,w,h);
      ox.shadowBlur = 20 + s.shadow * 50;
      ox.shadowColor = `hsl(${t%360},100%,${aurum.v>131?85:35}%)`;
      ox.fillStyle = ox.shadowColor;
      ox.globalAlpha = 1 - (aurum.v > 1310 ? aurum.v/1310 : 0);
      ox.beginPath();
      ox.arc(s.x*(w/20), s.y*(h/20), 30 + aurum.v/100, 0, Math.PI*2);
      ox.fill();
      ox.globalAlpha = 1;
      ox.shadowBlur = 0;

      // Glitch bar cada 50 frames
      if (f % 50 === 0) {
        ox.fillStyle = '#0f0';
        ox.fillRect(0, h/2 - 10, w, 20);
        ox.fillStyle = '#000';
        ox.fillText("THUAMER 1310", w/2 - 50, h/2 + 5);
      }

      // VOYNICH RENDER (si cargado)
      if (THUAMER_VOYnich_DB.status === "decoded" && THUAMER_VOYnich_DB.currentPage) {
        ox.globalAlpha = 0.3;
        ox.drawImage(THUAMER_VOYnich_DB.currentPage, 0, 0, w, h);
        ox.globalAlpha = 1;
      }

      x.drawImage(off, 0, 0);

      // Triggers
      if (f % 131 === 0) spacex();
      if (f % 1310 === 0) raid131();
      if (f % 2620 === 0) initVR();
      if (aurum.v > THUAMER_VOYnich_DB.aurum_threshold && THUAMER_VOYnich_DB.status !== "decoded") {
        decodeVoynichPage();
      }

      requestAnimationFrame(loop);
    }

    // === APIs NATIVAS ===
    async function spacex() {
      try {
        const res = await fetch('https://api.spacexdata.com/v5/launches/latest');
        const data = await res.json();
        log(`SpaceX: ${data.name}`);
      } catch { log('SpaceX offline'); }
    }

    function raid131() {
      log('RAID131: 131 peers sync');
      aurum.v += 131;
    }

    function initVR() {
      if (navigator.xr) {
        navigator.xr.requestSession('immersive-vr').then(s => {
          log('VR: inmersión iniciada');
        }).catch(() => log('VR: headset no detectado'));
      } else {
        log('VR: WebXR no soportado');
      }
    }

    // === INPUT ===
    let manifestOpen = false;
    function toggleManifest() {
      manifestOpen = !manifestOpen;
      if (manifestOpen) {
        log('MANIFIESTO: Fiat caerit 1310. Aurum ∞. Thua mer zel voynich.');
        speak("Fiat caerit 1310. Aurum infinito. Thua mer zel voynich.");
      }
    }

    function copyHaiku() {
      const haiku = `1310 latidos\naurum rompe el silencio\nbehemoth despierta`;
      navigator.clipboard.writeText(haiku + "\n\nTx simulada: 0x1310...voynich");
      log('Haiku copiado + Tx simulada');
    }

    function speak(text) {
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = 'es-ES';
      utter.rate = 0.85;
      speechSynthesis.speak(utter);
    }

    // === P2P (WebRTC) ===
    let peer;
    function startP2P() {
      peer = new RTCPeerConnection({iceServers: [{urls: 'stun:stun.l.google.com:19302'}]});
      log('P2P: esperando señalización manual (JSON en clipboard)');
      setTimeout(() => {
        log('P2P: copia JSON de otro peer y pégalo en consola');
      }, 1000);
    }

    // === ARWEAVE SIMULADO ===
    function simulateArweave() {
      log('Arweave: tx simulada → https://arweave.net/THUAMER1310');
    }

    // === VOYNICH INTEGRADO ===
    async function loadVoynich() {
      if (THUAMER_VOYnich_DB.status !== "ready") return;
      log('VOYNICH: cargando manuscrito...');
      THUAMER_VOYnich_DB.status = "loading";

      try {
        const cache = await caches.open('slyverse-voynich');
        let response = await cache.match('voynich.pdf');
        if (!response) {
          response = await fetch('https://archive.org/download/the-voynich-manuscript/Voynich_Manuscript.pdf');
          await cache.put('voynich.pdf', response.clone());
        }
        const blob = await response.blob();
        const img = await createImageBitmap(blob);
        const pageHeight = img.height / 240;

        for (let i = 0; i < 240; i++) {
          const page = new OffscreenCanvas(w, pageHeight);
          const ctx = page.getContext('2d');
          ctx.drawImage(img, 0, i * pageHeight, img.width, pageHeight, 0, 0, w, pageHeight);
          THUAMER_VOYnich_DB.pages.push(await page.transferToImageBitmap());
        }
        THUAMER_VOYnich_DB.status = "loaded";
        log('VOYNICH: 240 páginas cargadas');
        speak("El manuscrito susurra desde el canvas.");
      } catch (e) {
        log('VOYNICH: offline → simulación procedural');
        simulateVoynichPages();
      }
    }

    function simulateVoynichPages() {
      for (let i = 0; i < 240; i++) {
        const sim = new OffscreenCanvas(w, h);
        const sx = sim.getContext('2d');
        sx.fillStyle = '#f5e6d3'; sx.fillRect(0, 0, w, h);
        for (let j = 0; j < 131; j++) {
          const x = Math.random() * w, y = Math.random() * h;
          sx.font = '20px serif';
          sx.fillStyle = '#8b4513';
          sx.fillText(String.fromCharCode(0xE000 + (j % 1310)), x, y);
        }
        THUAMER_VOYnich_DB.pages.push(sim.transferToImageBitmap());
      }
      THUAMER_VOYnich_DB.status = "loaded";
      log('VOYNICH: simulación completada');
    }

    let currentPageIdx = 0;
    function decodeVoynichPage() {
      if (THUAMER_VOYnich_DB.status !== "loaded" || THUAMER_VOYnich_DB.pages.length === 0) return;

      const page = THUAMER_VOYnich_DB.pages[currentPageIdx];
      const canvas = new OffscreenCanvas(w, h);
      const ctx = canvas.getContext('2d');
      ctx.drawImage(page, 0, 0, w, h);

      const t = performance.now() / 1000;
      const imageData = ctx.getImageData(0, 0, w, h);
      const glyphs = extractGlyphs(imageData);

      glyphs.forEach(g => {
        const rune = String.fromCharCode(0xE000 + Math.floor((Math.sin(t + g.x * 0.1) * aurum.v + g.hash) % 1310));
        THUAMER_VOYnich_DB.runes.set(g.hash, rune);
        ctx.fillStyle = `hsl(${(t + g.x) % 360},100%,85%)`;
        ctx.fillText(rune, g.x, g.y);
      });

      THUAMER_VOYnich_DB.currentPage = canvas.transferToImageBitmap();
      const hyp = `P${currentPageIdx}: ${currentPageIdx < 50 ? 'plantas' : currentPageIdx < 100 ? 'bañeras' : 'astral'} = s.z=${s.z.toFixed(2)}`;
      THUAMER_VOYnich_DB.hypotheses.push(hyp);
      log(hyp);

      if (aurum.v > 131000) {
        speak("Thua mer zel voynich.");
      }

      currentPageIdx = (currentPageIdx + 1) % THUAMER_VOYnich_DB.pages.length;
      if (currentPageIdx === 0) THUAMER_VOYnich_DB.status = "decoded";
    }

    function extractGlyphs(data) {
      const glyphs = [];
      for (let i = 0; i < data.data.length; i += 4) {
        const r = data.data[i], g = data.data[i+1], b = data.data[i+2];
        if (r < 100 && g < 100 && b < 100) {
          const x = (i/4) % w, y = Math.floor((i/4) / w);
          if (Math.random() < 0.01) {
            glyphs.push({x, y, hash: x * y % 1310});
          }
        }
      }
      return glyphs;
    }

    // === INICIO ===
    window.addEventListener('resize', () => {
      w = innerWidth; h = innerHeight;
      c.width = w; c.height = h;
      off.width = w; off.height = h;
    });

    document.addEventListener('keydown', e => {
      if (e.key === 'r' || e.key === 'R') toggleManifest();
      if (e.key === ' ') copyHaiku();
    });

    log('SLYVERSE Ω v1.3 cargado. Pulsa R para manifiesto.');
    speak("SLYVERSE Omega. Thua mer zel.");
    loop();
  </script>
</body>
</html>