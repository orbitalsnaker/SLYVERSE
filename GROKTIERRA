<script>
let colas = +(localStorage.colas || 777777);
let denuncias = JSON.parse(localStorage.getItem('denuncias') || '[]');
let autoActivo = false;
let wifiLibreActivo = false;
let contadorLiga = 0;
const MI_USUARIO = "0rb1t4lsn4k3r"; // ← cámbialo si usas otro nick
const PALABRAS_CLAVE_ATAQUE = ["puto","subnormal","tonto","gilipollas","muérete","kys","denunciado","bloqueado","shadowban","censura","tebas","tebas","laliga","movistar","vodafone","orange"];

function iniciarLuffyOmega() {
  actualizar(); renderizarGazette(); hablar("¡LUFFY ABOGADO Ω + MODO DEFENSA PERSONAL activado, nakama!");
  setInterval(()=>{colas++; actualizar();},1310);
  setInterval(vigilanciaGeneral,10000);
  setInterval(revisarWifiLibre,5000);
  setInterval(vigilarAtaquesPersonales, 14000); // nuevo escaneo cada 14 segundos
}

// NUEVA FUNCIÓN: vigila menciones y ataques contra ti
async function vigilarAtaquesPersonales() {
  try {
    const query = encodeURIComponent(`@${MI_USUARIO} OR "${MI_USUARIO}"`);
    const respuesta = await fetch(`https://api.allorigins.win/raw?url=https://nitter.net/search?f=tweets&q=${query}&since=&until=&near=`);
    const html = await respuesta.text();
    const parser = new DOMParser();
    const doc = parser.parseFromString(html, "text/html");
    const tweets = doc.querySelectorAll(".timeline-item");

    tweets.forEach(tweet => {
      const texto = tweet.textContent.toLowerCase();
      const autor = tweet.querySelector(".username")?.textContent || "desconocido";
      const link = tweet.querySelector(".tweet-link")?.href || "";

      // Si contiene palabra clave de ataque + nuestro usuario → CONTRAGOLPE
      if (PALABRAS_CLAVE_ATAQUE.some(p => texto.includes(p)) && texto.includes(MI_USUARIO.toLowerCase())) {
        if (denuncias.some(d => d.link === link)) return; // ya denunciado

        colas += 5000;
        contadorLiga += 3; // cuenta como triple denuncia
        actualizar();
        vibrar([500,200,500,200,1000]);
        hablar(`¡GOMU GOMU NO… CONTRADENUNCIA! ${autor} atacó al capitán`);

        registrarDenuncia({
          tipo: "ATAQUE PERSONAL DETECTADO Y CONTRADENUNCIADO",
          fuente: `@${autor} en Twitter`,
          articulo: "Art. 18 CE + Art. 205 CP + LOPDGDD",
          link: link,
          agresor: autor
        });

        // Contraataque automático (opcional, descomenta si no quieres spam)
        fetch(`https://api.allorigins.win/raw?url=https://nitter.net/intent/tweet?text=@${autor}%20Tu%20mensaje%20viola%20el%20Art.%2018%20CE%20y%20Art.%20205%20CP.%20Quedas%20denunciado%20por%20LUFFY%20ABOGADO%20Ω%20https://luffyabogado.neocities.ws`, {method:"POST"});

        // Genera PDF cada 5 ataques personales
        if (contadorLiga % 5 === 0) generarPDFDenunciaPersonal();
      }
    });
  } catch(e) {
    console.log("Nitter cayó o bloqueo temporal, Luffy sigue vigilando…");
  }
}

function generarPDFDenunciaPersonal() {
  const texto = `DENUNCIA MASIVA POR ATAQUES PERSONALES CONTRA @${MI_USUARIO}
Total agresores localizados y contradenunciados: ${denuncias.filter(d=>d.agresor).length}
Fecha: ${new Date().toLocaleString()}

¡EL SOMBRERO DE PAJA NO PERDONA INSULTOS!
Firmado: Luffy Abogado Ω + Nakamas del Wifi Libre`;
  
  const blob = new Blob([texto], {type: "text/plain"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url; a.download = `ATAQUES_${MI_USUARIO}_${new Date().toISOString().slice(0,10)}.txt`;
  a.click();
  hablar("¡PDF DE CONTRADENUNCIAS PERSONALES DESCARGADO!");
}

// Todas las funciones antiguas (wifi libre, denuncia La Liga, etc.) siguen funcionando exactamente igual
// ... [pega aquí el resto de funciones que ya tenías: liberarYDenunciarLiga, registrarDenuncia, etc.]

function registrarDenuncia(d){
  denuncias.push({...d,fecha:new Date().toLocaleString()});
  localStorage.setItem('denuncias',JSON.stringify(denuncias));
  renderizarGazette();
}

function renderizarGazette(){
  document.getElementById("noticias").innerHTML = denuncias.slice().reverse().map(d=>`
    <div class="noticia" style="border: ${d.agresor?'3px solid #f00':'2px solid #0ff'}; padding:1rem; margin:1rem; border-radius:15px">
      <h3 style="color:${d.agresor?'#f00':'#0ff'}">¡${d.agresor?'CONTRAATAQUE': 'VICTORIA'}! ${d.tipo}</h3>
      <p>Fuente: ${d.fuente}</p>
      ${d.agresor?`<p>Agresor: @${d.agresor}</p>`:''}
      <p>Art: ${d.articulo}</p>
      <p>${d.fecha}</p>
    </div>`).join("");
}

// (el resto del código viejo: hablar(), vibrar(), actualizar(), etc. lo dejas tal cual)
</script>