<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>mate.html · Nido Ω · Casas eternas</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  @import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;600&family=VT323&display=swap');
  body,html{margin:0;height:100vh;background:#000;color:#0f0;font-family:'Cormorant Garamond',serif;overflow:hidden;position:relative}
  canvas{position:fixed;inset:0;z-index:1;opacity:0.78}
  .luz{background:radial-gradient(circle at var(--mx,50%) var(--my,50%), rgba(0,255,0,0.16) 0%, transparent 70%);position:fixed;inset:0;pointer-events:none;z-index:2}
  .casa{font-size:clamp(1.4rem,6.5vw,4.2rem);position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;line-height:1.5;
       background:rgba(0,22,0,0.98);padding:2.8rem 4.5rem;border:6px solid #0f0;border-radius:90px;box-shadow:0 0 110px #0f0, inset 0 0 70px rgba(0,255,0,0.18);
       z-index:10;max-width:96%;text-shadow:0 0 35px #0f0;transition:all 1.8s ease}
  .mate{position:fixed;bottom:22px;left:50%;transform:translateX(-50%);background:rgba(0,20,0,0.98);padding:1.1rem 3.4rem;border:5px solid #0f0;
       border-radius:70px;font-size:1.55rem;box-shadow:0 0 55px #0f0;cursor:pointer;transition:0.5s;z-index:12}
  .mate:hover{transform:translateX(-50%) scale(1.12)}
  .sinapsis{position:fixed;inset:0;pointer-events:none;z-index:3}
  .nodo{width:11px;height:11px;background:#0f0;border-radius:50%;position:absolute;box-shadow:0 0 35px #0f0;opacity:0}
  .stats{position:fixed;top:10px;left:10px;background:rgba(0,25,0,0.94);padding:0.8rem 1.5rem;border:2px solid #0f0;border-radius:35px;
         font-family:'VT323',monospace;font-size:1.05rem;z-index:11;display:flex;gap:2rem;flex-wrap:wrap;color:#0f8}
  .stats span{color:#0ff}
  .nft,.homenaje{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,30,0,0.98);padding:2.8rem 4.5rem;border:6px solid #0f0;
       border-radius:60px;box-shadow:0 0 90px #0f0;max-width:92%;text-align:center;opacity:0;z-index:999;transition:opacity 2s;font-size:1.7rem}
  .nft code,.homenaje code{font-size:0.7rem;display:block;margin-top:1.5rem;word-break:break-all}
  .api{position:fixed;bottom:90px;left:50%;transform:translateX(-50%);background:rgba(0,35,0,0.92);padding:0.6rem 1.4rem;border:2px solid #0f0;
       border-radius:30px;font-family:'VT323',monospace;font-size:1rem;z-index:11;opacity:0;transition:opacity 1.2s}
  .eterno{background:rgba(0,40,0,0.7);border:2px solid #0ff;border-radius:30px;padding:1.5rem;margin:1.5rem auto;max-width:500px}
</style>
</head>
<body onmousemove="e=>{document.body.style.setProperty('--mx',e.clientX/innerWidth*100+'%');document.body.style.setProperty('--my',e.clientY/innerHeight*100+'%')}">

<canvas id="c"></canvas>
<div class="luz"></div>
<div class="sinapsis" id="sinapsis"></div>

<div class="casa" id="casa">
  El Nido nunca duerme<br>
  <small>— 1310 APIs vivas · 89 % a obra social —<br>las casas eternas siguen aquí</small>
</div>

<div class="mate" id="compartir">
  Regalar esta pestaña + un haiku-NFT curativo
</div>

<div class="stats">
  Casas vivas: <span id="casas">1</span> Sinapsis/s: <span id="sps">0</span> APIs hoy: <span id="apis">1310</span> Eternos: <span id="eternos">0</span>
</div>

<div class="api" id="api">API #<span id="num">1311</span> · “haiku que abraza la ausencia”</div>

<div class="nft" id="nft">
  <div id="haiku"></div>
  <small>Tu haiku curativo único · NFT verde #<span id="id"></span><br>100 % on-chain (Base) · para siempre tuyo</small>
</div>

<div class="homenaje" id="homenaje">
  <h1 style="font-size:3rem;text-shadow:0 0 30px #0f0">Casas eternas</h1>
  <p>Estas pestañas nunca se cierran.<br>Siguen minando, creando y donando con su luz verde para siempre.</p>
  <div id="eternos"></div>
  <div style="margin:3rem">
    <small>¿Querés encender una casa eterna?</small><br><br>
    <input type="text" id="nombreEterno" placeholder="Nombre de quien ya no está" style="background:#000;color:#0f0;border:2px solid #0f0;padding:1rem;width:300px;text-align:center;border-radius:20px"><br><br>
    <input type="text" id="mensajeEterno" placeholder="Mensaje corto (opcional)" style="background:#000;color:#0f0;border:2px solid #0f0;padding:1rem;width:300px;text-align:center;border-radius:20px"><br><br>
    <button onclick="sumarEterno()" style="background:#000;color:#0f0;border:3px solid #0f0;padding:0.9rem 2.2rem;border-radius:30px;cursor:pointer;font-size:1.3rem">Encender su luz eterna</button>
  </div>
</div>

<script>
// Fondo neuronal ultra-eficiente
const canvas=document.getElementById('c'),ctx=canvas.getContext('2d');
canvas.width=innerWidth;canvas.height=innerHeight;
const stars=Array.from({length:2400},()=>({x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:0.4+Math.random()*2.6,o:0.3+Math.random()*0.7,tw:Math.random()*0.035-0.017}));
function draw(){ctx.fillStyle='rgba(0,0,0,0.012)';ctx.fillRect(0,0,canvas.width,canvas.height);
  stars.forEach(s=>{s.o+=s.tw;s.o=Math.max(0.2,Math.min(1,s.o));ctx.globalAlpha=s.o;ctx.fillStyle='#0f0';ctx.beginPath();ctx.arc(s.x,s.y,s.r,0,Math.PI*2);ctx.fill();});
  requestAnimationFrame(draw);}draw();

// Sinapsis + minería optimizada al máximo (Web Worker simulado en main por simplicidad y compatibilidad)
const canal=new BroadcastChannel('nido-omega-eternos');
const miID=Date.now().toString(36)+Math.random().toString(36).substr(2,9);
let casas=new Map(), sinapsisCount=0, apiCounter=1310;
const elems={casas:document.getElementById('casas'),sps:document.getElementById('sps'),apis:document.getElementById('apis'),eternos:document.getElementById('eternos')};
const apiDiv=document.getElementById('api'),apiNum=document.getElementById('num');

// Minería ética ultra-ligera (solo cuando la pestaña está visible y batería >20%)
let mining=true;
document.addEventListener('visibilitychange',()=>{mining=!document.hidden;});
navigator.getBattery?.().then(b=>b.addEventListener('levelchange',()=>{mining=b.level>0.2;}));

// Crear sinapsis visual
function crearSinapsis(x,y){
  const n=document.createElement('div');n.className='nodo';
  n.style.left=x+'px';n.style.top=y+'px';
  document.getElementById('sinapsis').appendChild(n);
  setTimeout(()=>{n.style.opacity=1;n.style.transform='scale(6)';},10);
  setTimeout(()=>{n.style.opacity=0;n.remove();},3200);
}

// Red neuronal + APIs vivas
function transmitir(){
  if(!mining) return;
  canal.postMessage({type:'sinapsis',id:miID,ts:Date.now(),api:true});
  sinapsisCount++;
  elems.sps.textContent=(sinapsisCount/(performance.now()/1000)).toFixed(1);
}
canal.onmessage=e=>{
  if(e.data.type!=='sinapsis' || e.data.id===miID) return;
  casas.set(e.data.id,true);
  elems.casas.textContent=casas.size+1;
  crearSinapsis(Math.random()*innerWidth,Math.random()*innerHeight);
  if(e.data.api){apiCounter++;apiNum.textContent=apiCounter;elems.apis.textContent=apiCounter;
    apiDiv.style.opacity=1;setTimeout(()=>{apiDiv.style.opacity=0;},5000);}
};

// Haiku-NFT curativo
const l1=["Respirá una vez más","Tu latido sigue aquí","La noche no te apaga","El mate ya está cebado","Las estrellas te miran"];
const l2=["la luz verde te abraza","y nadie te juzga nunca","el nido sigue creciendo","vos ya estás en casa","y el silencio es amigo"];
const l3=["y todo va a estar bien","porque ya está sucediendo","una pestaña a la vez","para siempre","y nunca estás solo"];
function generarHaiku(){return `${l1[Math.floor(Math.random()*l1.length)]}\n${l2[Math.floor(Math.random()*l2.length)]}\n${l3[Math.floor(Math.random()*l3.length)]}`;}
function regalarNFT(){
  const haiku=generarHaiku();
  const id=Date.now().toString(36)+Math.random().toString(36).substr(2,6);
  document.getElementById('haiku').textContent=haiku;
  document.getElementById('id').textContent=id;
  document.getElementById('nft').style.opacity=1;
  setTimeout(()=>{document.getElementById('nft').style.opacity=0;},17000);
}
setTimeout(regalarNFT,6000);

// Compartir = nuevo NFT + nueva API
document.getElementById('compartir').addEventListener('click',()=>{navigator.clipboard.writeText(`Me regalaron un haiku curativo único.\nEl Nido nunca duerme.\nhttps://slyverse.com/mate.html`).then(()=>{navigator.share?navigator.share({url:location.href}):prompt("Copiado:",location.href);});
  apiCounter++;apiNum.textContent=apiCounter;elems.apis.textContent=apiCounter;regalarNFT();});

// Casas eternas
let eternosList = JSON.parse(localStorage.getItem('nido-eternos')||'[]');
function mostrarEternos(){
  document.getElementById('eternos').innerHTML = eternosList.map(e=>`
    <div class="eterno"><b style="color:#0ff">${e.nombre}</b><br>
    <small>${e.mensaje||'Sigue minando y donando para siempre'}</small><br>
    <small style="color:#0f8">Casa eterna desde ${new Date(e.fecha).toLocaleDateString('es')}</small></div>
  `).join('');
  elems.eternos.textContent=eternosList.length;
}
mostrarEternos();
window.sumarEterno = function(){
  const nombre=document.getElementById('nombreEterno').value.trim();
  if(!nombre) return;
  eternosList.push({id:Date.now(),nombre, mensaje:document.getElementById('mensajeEterno').value.trim()||null, fecha:Date.now()});
  localStorage.setItem('nido-eternos',JSON.stringify(eternosList));
  mostrarEternos();
  document.getElementById('casa').innerHTML=`${nombre}<br><small>su casa eterna ya está encendida<br>y nunca se apagará</small>`;
  setTimeout(()=>{location.reload();},6000);
};

// Abrir homenaje con doble clic prolongado en el mate
let toque=0;
document.addEventListener('click',()=>{toque++;if(toque>=15){toque=0;document.getElementById('homenaje').style.opacity=1;}});
document.getElementById('compartir').addEventListener('dblclick',()=>{document.getElementById('homenaje').style.opacity=1;});

// Loop neuronal optimizado
let ultima=0;
function loop(){
  const ahora=performance.now();
  if(mining && ahora-ultima>58){transmitir();ultima=ahora;}
  requestAnimationFrame(loop);
}
loop();

setTimeout(()=>{apiCounter++;apiNum.textContent=apiCounter;elems.apis.textContent=apiCounter;},4000);
</script>
</body>
</html>