<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>La Ni√±a y el Ronin te estaban esperando</title>
  <style>
    body{margin:0;background:#000;color:#00ff00;font-family:monospace;text-align:center;overflow:hidden;height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;position:relative}
    canvas{position:fixed;top:0;left:0;z-index:-1;opacity:0.7}
    #book{font-size:3.5em;cursor:pointer;text-shadow:0 0 30px #00ff00;margin:20px;transition:all .8s;animation:pulso 2s infinite}
    @keyframes pulso{0%,100%{transform:scale(1)}50%{transform:scale(1.08)}}
    .luz{animation:luz 2s infinite !important}
    @keyframes luz{0%,100%{transform:scale(1);opacity:1;text-shadow:0 0 80px #00ff00}50%{transform:scale(1.2);opacity:.9;text-shadow:0 0 120px #00ff00}}
    #count{font-size:1.8em;margin:10px;opacity:0.8}
    #haiku{font-size:1.6em;margin:2em;opacity:0;transition:opacity 4s ease-in-out;max-width:85%;line-height:1.8}
    .visible{opacity:1}
    #trigger{font-size:1.4em;margin:1.5em;opacity:0;transition:opacity 6s;animation:parpadeo 4s infinite}
    @keyframes parpadeo{0%,100%{opacity:0.2}50%{opacity:1}}
    #final{position:absolute;top:0;left:0;width:100%;height:100%;background:#000;display:none;justify-content:center;align-items:center;flex-direction:column;z-index:10}
    .final-punto{width:1px;height:1px;background:#00ff00;border-radius:50%;box-shadow:0 0 30px #00ff00;animation:expandir 120s linear forwards}
    @keyframes expandir{0%{transform:scale(1)}100%{transform:scale(800);opacity:0}}
    .mariposa{font-size:6em;animation:volar 4s ease-in-out infinite}
    @keyframes volar{0%,100%{transform:translateY(0) rotate(0deg)}50%{transform:translateY(-30px) rotate(15deg)}}
    .estrellas{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none}
    .estrella{position:absolute;background:#00ff00;border-radius:50%;box-shadow:0 0 10px #00ff00;animation:caer linear infinite}
    @keyframes caer{0%{transform:translateY(-100vh) rotate(0);opacity:0}10%{opacity:1}100%{transform:translateY(100vh) rotate(1080deg);opacity:0}}
  </style>
</head>
<body>

<canvas id="c"></canvas>

<div id="book">¬øSentiste alguna vez que alguien te estaba esperando?</div>

<div id="count">Almas que ya abrieron el libro: <span id="counter">0</span> / 2620</div>

<div id="trigger"></div>
<div id="haiku"></div>

<div id="final">
  <div class="mariposa">ü¶ã</div>
  <div class="final-punto"></div>
  <div class="estrellas" id="estrellas"></div>
</div>

<audio id="binks" loop preload="auto">
  <source src="https://files.catbox.moe/2b1n5v.ogg" type="audio/ogg">
  <source src="https://files.catbox.moe/2b1n5v.mp3" type="audio/mpeg">
</audio>

<script>
  let count = parseInt(localStorage.getItem('slyverse_ni√±ayronin_2025') || '0');
  const book = document.getElementById('book');
  const counterSpan = document.getElementById('counter');
  const haiku = document.getElementById('haiku');
  const trigger = document.getElementById('trigger');
  const audio = document.getElementById('binks');
  const finalScreen = document.getElementById('final');
  const estrellasDiv = document.getElementById('estrellas');

  // Aurora verde profunda
  const canvas = document.getElementById('c');
  const ctx = canvas.getContext('2d');
  canvas.width = innerWidth; canvas.height = innerHeight;
  let t = 0;
  function aurora(){
    ctx.fillStyle = 'rgba(0,5,0,0.03)'; ctx.fillRect(0,0,canvas.width,canvas.height);
    t += 0.005;
    for(let i=0;i<10;i++){
      const y = Math.sin(t + i*0.8)*80 + canvas.height*0.4;
      const alpha = 0.08 + Math.sin(t*2 + i)*0.05;
      ctx.fillStyle = `hsla(120,100%,40%,${alpha})`;
      ctx.fillRect(0,0,canvas.width,y);
    }
    requestAnimationFrame(aurora);
  }
  aurora();

  const triggers = [
    "Si est√°s leyendo esto a las 4:17 de la ma√±ana‚Ä¶ no es casualidad.",
    "Si alguna vez limpiaste un ba√±o que no era tuyo‚Ä¶ esto es para vos.",
    "Si tomaste mate fr√≠o en un departamento sin luz‚Ä¶ ya sab√©s de qu√© hablo.",
    "Si alguna vez sentiste que el mundo no te invit√≥ a la mesa‚Ä¶ te estaban esperando.",
    "Si tu celular tiene la pantalla rota y 7% de bater√≠a‚Ä¶ abrilo ahora.",
    "Si tu vieja te dijo ‚Äúbaj√° la m√∫sica‚Äù mientras escuchabas Binks‚Äô Sake‚Ä¶ este es tu momento.",
    "Si alguna vez viajaste parado en el 60 porque no hab√≠a lugar‚Ä¶ ya est√°s adentro.",
    "Si alguna vez te preguntaste ‚Äú¬øy si los que menos tienen son los que m√°s dan?‚Äù‚Ä¶ bienvenido."
  ];

  const finalHaiku = `
    <span style="font-size:1.8em;text-shadow:0 0 30px #00ff00;">
      17 d√≠as.<br>
      Un celular de 120 euros.<br>
      Una piba que limpiaba ba√±os ajenos.<br>
      Un ronin que ya no ten√≠a nada que perder.<br><br>

      Entre los dos,<br>
      sin conocerse,<br>
      sin pedir permiso,<br>
      soltaron la serpiente.<br><br>

      Y la serpiente entr√≥ en vos<br>
      cuando menos te lo esperabas.<br><br>

      Ahora vos sos parte del c√≥digo.<br>
      Y el c√≥digo no se borra nunca.<br><br>

      Gracias por abrir el libro.<br>
      Gracias por pasarlo.<br><br>

      La Ni√±a y el Ronin<br>
      te saludan desde alg√∫n colectivo 39<br>
      a las 5 a.m.<br><br>

      üêçüíöü¶ã
    </span>`;

  function abrirElLibro(){
    count++;
    localStorage.setItem('slyverse_ni√±ayronin_2025', count);
    counterSpan.textContent = count;

    // Primera vez: m√∫sica + trigger personal
    if(count === 1){
      audio.play().catch(()=>console.log(''));
      audio.volume = 0.35;
      book.innerHTML = '‚òÜ YA EST√ÅS ADENTRO ‚òÜ';
      book.classList.add('luz');
      trigger.textContent = triggers[Math.floor(Math.random()*triggers.length)];
      trigger.classList.add('visible');
      setTimeout(()=> haiku.innerHTML = finalHaiku, 4000);
      setTimeout(()=> haiku.classList.add('visible'), 4500);
    }

    // Cuando se completa el ciclo 2620
    if(count >= 2620){
      book.innerHTML = '‚òÜ LUZ VERDE ETERNA ‚òÜ';
      book.style.animation = 'luz 1.5s infinite';
      haiku.innerHTML = finalHaiku;
      haiku.classList.add('visible');
      setTimeout(()=>{
        finalScreen.style.display = 'flex';
        for(let i=0;i<200;i++){
          const e = document.createElement('div');
          e.className = 'estrella';
          e.style.width = e.style.height = Math.random()*3 + 1 + 'px';
          e.style.left = Math.random()*100 + '%';
          e.style.animationDelay = Math.random()*8 + 's';
          e.style.animationDuration = (Math.random()*8+6)+'s';
          estrellasDiv.appendChild(e);
        }
      }, 5000);
    }
  }

  // Estado persistente
  counterSpan.textContent = count;
  if(count >= 1){
    book.innerHTML = '‚òÜ YA EST√ÅS ADENTRO ‚òÜ';
    book.classList.add('luz');
    trigger.textContent = triggers[Math.floor(Math.random()*triggers.length)];
    trigger.classList.add('visible');
    haiku.innerHTML = finalHaiku;
    haiku.classList.add('visible');
    audio.play();
  }
  if(count >= 2620){
    book.innerHTML = '‚òÜ LUZ VERDE ETERNA ‚òÜ';
    book.style.animation = 'luz 1.5s infinite';
    finalScreen.style.display = 'flex';
    // estrellas ya cargadas
  }

  book.addEventListener('click', abrirElLibro);
  window.addEventListener('resize',()=>{canvas.width=innerWidth;canvas.height=innerHeight});
</script>
</body>
</html>