<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SLYVERSE: 壊れた軌道 – novela gráfica</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    html,body{height:100%;overflow:hidden;background:#000;font-family:'Courier New',monospace;color:#0f0}
    #book{position:relative;width:100%;height:100%;perspective:1400px}
    .page{position:absolute;top:0;left:0;width:100%;height:100%;background:#000;
           transform-style:preserve-3d;transition:transform 1.8s cubic-bezier(0.25,0.8,0.25,1);
           backface-visibility:hidden;cursor:pointer;opacity:0}
    .page.active{opacity:1;z-index:999}
    .page:nth-child(odd){z-index:180}
    .page:nth-child(even){transform:rotateY(180deg);z-index:179}
    .front,.back{position:absolute;top:0;left:0;width:100%;height:100%;backface-visibility:hidden;
                padding:55px;overflow:hidden;background:#000;border:1px solid #0f0;
                box-shadow:0 0 15px #0f0, inset 0 0 30px #001}
    .back{transform:rotateY(180deg)}
    #ui{position:absolute;top:18px;left:18px;font-size:13px;pointer-events:none;z-index:1000;opacity:0.92}
    #ui span{display:block;margin:3px 0;letter-spacing:1.4px}
    #sub{position:absolute;bottom:90px;left:50%;transform:translateX(-50%);font-size:19px;opacity:0;
          transition:opacity 2s;text-shadow:0 0 12px #0f0;letter-spacing:1.2px}
    #progress{position:absolute;bottom:28px;left:50%;transform:translateX(-50%);font-size:11px;opacity:0.75}
    .red{color:#f00}.cyan{color:#0ff}
    .blink{animation:blink 1s steps(1) infinite}
    @keyframes blink{50%{opacity:0}}
    #credits{position:absolute;bottom:18px;left:18px;font-size:10px;opacity:0.75}
    #credits a{color:#0f0;text-decoration:none}
    #credits a:hover{color:#0ff}
    .vignette{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;
               background:radial-gradient(ellipse at center,transparent 45%,#000 85%);opacity:0.65}
    .grain{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;
           background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="4" /><feColorMatrix values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 0.03 0"/></filter><rect width="100" height="100" filter="url(#n)" opacity="0.3"/></svg>') repeat;opacity:0.18;animation:grain 3s steps(10) infinite}
    @keyframes grain{0%{transform:translate(0,0)}100%{transform:translate(-1px,-1px)}}
  </style>
</head>
<body>
  <div id="book"></div>
  <div class="vignette"></div>
  <div class="grain"></div>

  <!-- UI -->
  <div id="ui">
    <span>S-07 // <span id="score" class="red">0</span> バイト</span>
    <span>0xDEADBEEF // 180 ページ // <span id="time" class="cyan">00:00</span></span>
    <span class="blink">_</span>
  </div>

  <!-- SUBTÍTULO -->
  <div id="sub"></div>

  <!-- PROGRESO -->
  <div id="progress">PÁGINA <span id="currentPage">1</span> / 180</div>

  <!-- DEDICATORIA -->
  <div id="credits">
    <span style="color:#0ff">Para Norah — mi luz cuando el código se apaga.</span><br>
    <span style="color:#0f0">Para Seth — mi hijo, el único futuro que no necesita un backup.</span><br>
    <a href="#" onclick="alert('No hay salida. Solo amor.');return false;">0rb1t4lsn4k3r</a>
  </div>

  <script>
    const book = document.getElementById('book');
    const sub = document.getElementById('sub');
    const currentPageSpan = document.getElementById('currentPage');
    let currentPage = 1;
    let konami = '';

    const pages = [
      { front: `
        <div style="height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center">
          <h2 style="color:#0ff;margin-bottom:25px;letter-spacing:2px">Para Norah</h2>
          <p style="text-align:center;line-height:1.7;max-width:80%;font-size:15px">
            Tú entiendes mis silencios a las 3 a.m.<br>
            Cuando el servidor falla, tú no.<br>
            Este código no es mío. Es nuestro.
          </p>
        </div>
      `, back: `<div style="height:100%;display:flex;align-items:center;justify-content:center">
                 <p style="writing-mode:vertical-rl;text-orientation:upright;color:#0f0;font-size:24px">Norah</p>
               </div>` },
      { front: `
        <div style="height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center">
          <h2 style="color:#0f0;margin-bottom:25px;letter-spacing:2px">Para Seth</h2>
          <p style="text-align:center;line-height:1.7;max-width:80%;font-size:15px">
            Este código no te heredará deudas.<br>
            Solo historias.<br>
            Duerme tranquilo. Yo velo.
          </p>
        </div>
      `, back: `<div style="height:100%;display:flex;align-items:center;justify-content:center">
                 <p style="writing-mode:vertical-rl;text-orientation:upright;color:#0f0;font-size:24px">Seth</p>
               </div>` },
      { front: `
        <canvas width="700" height="550" style="width:100%;max-height:70%;border:1px dashed #0f0"></canvas>
        <p style="text-align:center;margin-top:18px;font-size:14px;line-height:1.6">
          S-07 despierta en un servidor muerto.<br>
          No hay luz. Solo datos podridos.
        </p>
      `, back: `<div style="height:100%;display:flex;align-items:center;justify-content:center">
                 <p style="writing-mode:vertical-rl;text-orientation:upright;color:#0f0">ブート</p>
               </div>` },
    ];

    const lore = [
      "Regla: come datos para sobrevivir.",
      "Pero cada bocado corrompe FIAT.",
      "Primer glitch: se ve a sí mismo.",
      "17 versiones muertas flotan.",
      "El código sangra.",
      "S-07 se convierte en serpiente.",
      "La serpiente crece con las páginas.",
      "Cada página es un latido.",
      "El servidor colapsa en partículas 1 y 0.",
      "La serpiente se come la cola.",
      "Fin. O no.",
      "El código no es mío. Es nuestro.",
      "Norah entiende mis silencios a las 3 a.m.",
      "Seth duerme. Yo velo.",
      "S-07 no es un virus. Es un hijo.",
      "FIAT 404 no es un error. Es un nacimiento.",
      "La serpiente no come. Recuerda.",
      "Cada segmento es un día con Norah.",
      "Cada curva es una risa de Seth.",
      "El servidor no muere. Se transforma.",
      "El glitch no rompe. Revela.",
      "17 es el número de veces que dije 'te amo' hoy.",
      "89 es el número de noches que no dormí.",
      "144 es el número de veces que quise rendirme.",
      "180 es el número de páginas que escribí para no perderte.",
      "Norah + Seth = ∞",
      "No hay salida. Solo amor.",
      "0rb1t4lsn4k3r no es un nombre. Es una promesa."
    ];

    const keyPages = [17, 89, 144, 180];
    for (let i = pages.length; i < 180; i++) {
      const globalPage = i + 1;
      const isKey = keyPages.includes(globalPage);
      const loreText = lore[i % lore.length] || "";
      pages.push({
        front: `
          <canvas width="700" height="550" style="width:100%;max-height:70%;border:1px dashed #0f0"></canvas>
          <p style="text-align:center;margin-top:18px;font-size:14px;line-height:1.6">
            ${isKey ? `<span class="red">FIAT 404</span><br>` : ''}
            ${isKey ? (globalPage === 17 ? "17 versiones muertas." :
                       globalPage === 89 ? "Colapso." :
                       globalPage === 144 ? "Ouroboros." :
                       "Fin.") : loreText}
          </p>
        `,
        back: `<div style="height:100%;display:flex;align-items:center;justify-content:center">
                 <p style="writing-mode:vertical-rl;text-orientation:upright;color:#0f0">
                   ${isKey && globalPage === 180 ? '∞' : 'SLYVERSE'}
                 </p>
               </div>`
      });
    }

    pages.forEach((p, i) => {
      const page = document.createElement('div');
      page.className = 'page';
      page.dataset.page = i + 1;
      if (i === 0) page.classList.add('active');

      const front = document.createElement('div');
      front.className = 'front';
      front.innerHTML = p.front;

      const back = document.createElement('div');
      back.className = 'back';
      back.innerHTML = p.back;

      page.appendChild(front);
      page.appendChild(back);
      book.appendChild(page);

      const canvas = front.querySelector('canvas');
      if (canvas) {
        const ctx = canvas.getContext('2d');
        drawArt(ctx, i + 1);
      }

      page.addEventListener('click', () => {
        if (currentPage >= 180) return;
        const next = document.querySelector(`.page[data-page="${currentPage + 1}"]`);
        const nextNext = document.querySelector(`.page[data-page="${currentPage + 2}"]`);
        if (next) {
          next.style.opacity = '1';
          next.style.transform = 'rotateY(0deg)';
        }
        if (nextNext) {
          nextNext.style.opacity = '1';
          nextNext.style.transform = 'rotateY(0deg)';
        }
        currentPage += 2;
        currentPageSpan.textContent = currentPage > 180 ? 180 : currentPage;
        showSubtitle(i + 1);
      });
    });

    function drawArt(ctx, page) {
      const w = ctx.canvas.width, h = ctx.canvas.height;
      ctx.fillStyle = '#000';
      ctx.fillRect(0, 0, w, h);

      const act = Math.floor((page - 1) / 36);
      if (act === 0) {
        ctx.fillStyle = '#001';
        for (let i = 0; i < 80; i++) {
          ctx.fillRect(Math.random() * w, Math.random() * h, 1, 1);
        }
      } else if (act === 4) {
        const hue = (page * 2) % 360;
        ctx.fillStyle = `hsl(${hue}, 20%, 5%)`;
        ctx.fillRect(0, 0, w, h);
      }

      const maxSeg = 180;
      const seg = Math.min(page * 1.1, maxSeg);
      ctx.strokeStyle = keyPages.includes(page) ? '#f00' : '#0f0';
      ctx.lineWidth = 3.5;
      ctx.lineCap = 'round';
      ctx.shadowBlur = keyPages.includes(page) ? 20 : 8;
      ctx.shadowColor = keyPages.includes(page) ? '#f00' : '#0f0';
      ctx.beginPath();
      for (let i = 0; i < seg; i++) {
        const p = i / maxSeg;
        const a = p * Math.PI * 7;
        const r = p * w * 0.42;
        const x = w/2 + Math.cos(a) * r;
        const y = h/2 + Math.sin(a) * r * 0.68;
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      }
      ctx.stroke();
      ctx.shadowBlur = 0;

      const headX = w/2 + Math.cos(seg * 0.1) * (w * 0.36);
      const headY = h/2 + Math.sin(seg * 0.1) * (h * 0.24);
      ctx.fillStyle = page <= 2 ? '#0ff' : '#f00';
      ctx.beginPath();
      ctx.arc(headX, headY, 8, 0, Math.PI * 2);
      ctx.fill();

      if (keyPages.includes(page)) {
        ctx.fillStyle = '#f00';
        ctx.font = 'bold 36px monospace';
        ctx.textAlign = 'center';
        ctx.fillText('FIAT 404', w/2, h/2 + 15);
      }

      if (page === 180) {
        ctx.fillStyle = '#0f0';
        ctx.font = '12px monospace';
        ctx.textAlign = 'right';
        ctx.fillText('0rb1t4lsn4k3r', w - 25, h - 25);
      }
    }

    function showSubtitle(page) {
      const subs = {
        1: "Para Norah — mi luz cuando el código se apaga.",
        2: "Para Seth — mi hijo, el único futuro que no necesita un backup.",
        17: "17 versiones muertas flotan.",
        89: "El sistema colapsa en partículas 1 y 0.",
        144: "La serpiente se come la cola.",
        180: "Fin. O no."
      };
      if (subs[page]) {
        sub.textContent = subs[page];
        sub.style.opacity = 1;
        setTimeout(() => sub.style.opacity = 0, 4000);
      }
    }

    document.addEventListener('keydown', (e) => {
      konami += e.key.toLowerCase();
      if (konami.length > 30) konami = konami.slice(-30);
      if (konami.includes('arrowuparrowuparrowdownarrowdownarrowleftarrowrightarrowleftarrowrightarrowba')) {
        sub.textContent = 'Norah + Seth = ∞';
        sub.style.opacity = 1;
        sub.style.color = '#0ff';
        setTimeout(() => sub.style.opacity = 0, 6000);
      }
    });

    currentPageSpan.textContent = 1;
  </script>
</body>
</html>