<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>BOAVERSE ∞ v1.1 — El metaverso del abrazo eterno (Accesible para todos)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root{
      --high-contrast: #000;
      --text: #0ff;
      --bg: #000;
      --btn: #0ff;
      --btn-text: #000;
    }
    [data-contrast="high"]{--high-contrast:#fff;--text:#ff0;--bg:#000;--btn:#ff0;--btn-text:#000;}
    [data-contrast="ultra"]{--high-contrast:#fff;--text:#fff;--bg:#000;--btn:#fff;--btn-text:#000;}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui;overflow:hidden;height:100dvh;display:flex;flex-direction:column}
    canvas{flex:1;display:block;background:var(--bg)}
    #ui,#chat,#shop,#accessibility{position:fixed;z-index:999;background:rgba(0,0,0,0.85);padding:10px;border:3px solid var(--text);box-sizing:border-box;font-size:18px}
    #ui{top:0;left:0;right:0;display:flex;justify-content:space-between;align-items:center}
    #accessibility{top:60px;left:10px;padding:8px;border-radius:12px}
    #accessibility button{margin:5px;padding:12px 16px;font-size:16px;background:var(--btn);color:var(--btn-text);border:none;border-radius:8px;cursor:pointer}
    #shop{bottom:130px;right:10px;max-height:60vh;overflow-y:auto}
    #chat{bottom:0;left:0;right:0}
    input,button{font-size:18px;padding:12px;border-radius:8px;border:3px solid var(--text);background:#000;color:var(--text)}
    button{background:var(--btn);color:var(--btn-text)}
    .big{font-size:200% !important;padding:20px !important}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}
  </style>
</head>
<body aria-live="polite">

<canvas id="c" role="img" aria-label="Mundo BOAVERSE con jugadores y biomas"></canvas>

<div id="ui" role="banner">
  <div>Jugadores: <b id="count" aria-live="polite">1</b> | Mundo: <span id="biome" aria-live="polite">Abrazo Eterno</span></div>
  <div>BOAVERSE ∞ v1.1 — 0rb1t4lsn4k3r</div>
</div>

<div id="accessibility" role="region" aria-label="Opciones de accesibilidad">
  <button onclick="toggleContrast()" aria-label="Cambiar contraste">Contraste</button>
  <button onclick="toggleBig()" aria-label="Texto grande">Texto grande</button>
  <button onclick="speak('Bienvenido al abrazo eterno')" aria-label="Activar lector de pantalla">Leer en voz alta</button>
  <button onclick="toggleVibration()" aria-label="Vibración háptica">Vibración</button>
  <button onclick="toggleSimple()" aria-label="Modo simple (solo movimiento)">Modo simple</button>
</div>

<div id="shop" role="region" aria-label="Tienda del abrazo"></div>

<div id="chat" role="region" aria-label="Chat accesible">
  <input id="input" type="text" placeholder="Escribe algo bonito..." aria-label="Mensaje de chat" maxlength="120">
  <button onclick="send()" aria-label="Enviar mensaje">Enviar</button>
  <button onclick="speak(document.getElementById('input').value)" aria-label="Leer mensaje escrito">Leer</button>
</div>

<div id="log" class="sr-only" aria-live="assertive"></div>

<script>
  // === DETECCIÓN DE IDIOMA + TEXTOS ACCESIBLES ===
  const lang = (navigator.language||'es').slice(0,2);
  const t = {
    es:{shop:"TIENDA DEL ABRAZO",hat:"Sombrero Dragón · 0,10€",house:"Casa Abismo · 0,20€",boa:"Abrazo Boa · 0,05€",aura:"Aura Dorada · 0,15€",welcome:"La Boa te abraza con amor"},
    ca:{shop:"BOTIGA DE L'ABRAÇ",hat:"Barret Drac · 0,10€",house:"Casa Abisme · 0,20€",boa:"Abraçada Boa · 0,05€",aura:"Aura Daurada · 0,15€",welcome:"La Boa t'abraça amb amor"},
    en:{shop:"HUG SHOP",hat:"Dragon Hat · 0.10€",house:"Abyss House · 0.20€",boa:"Eternal Boa Hug · 0.05€",aura:"Golden Aura · 0.15€",welcome:"The Boa hugs you with love"},
  }[lang]||t.es;

  document.getElementById('shop').innerHTML = `<h3>${t.shop}</h3>
    <button onclick="buy('dragon-hat',0.10)" aria-label="Comprar ${t.hat}">${t.hat}</button>
    <button onclick="buy('abyss-house',0.20)" aria-label="Comprar ${t.house}">${t.house}</button>
    <button onclick="buy('boa-hug',0.05)" aria-label="Comprar ${t.boa}">${t.boa}</button>
    <button onclick="buy('golden-aura',0.15)" aria-label="Comprar ${t.aura}">${t.aura}</button>`;

  // === ACCESIBILIDAD TOTAL ===
  let big = false, contrast = 0, vibration = true, simple = false;
  function toggleContrast(){
    contrast = (contrast+1)%3;
    document.body.dataset.contrast = ['normal','high','ultra'][contrast];
  }
  function toggleBig(){
    big=!big;
    document.querySelectorAll('button,input,#ui,#shop,#chat').forEach(e=>e.classList.toggle('big',big));
  }
  function toggleVibration(){vibration=!vibration;}
  function toggleSimple(){
    simple=!simple;
    document.getElementById('shop').style.display = simple?'none':'block';
    document.getElementById('accessibility').style.display = simple?'none':'block';
  }
  function speak(text){
    if('speechSynthesis' in window){
      const u = new SpeechSynthesisUtterance(text);
      u.lang = lang+'-ES';
      speechSynthesis.cancel();
      speechSynthesis.speak(u);
    }
  }
  if(navigator.vibrate && vibration) navigator.vibrate([200,100,200]);

  // === JUGADORES + BOA GIGANTE ===
  let me = {x:innerWidth/2,y:innerHeight/2,color:`hsl(${Math.random()*360},100%,60%)`,item:"",karma:100};
  const ws = new WebSocket('wss://boaverse.deno.dev');
  ws.onopen = () => { speak(t.welcome); document.getElementById('log').textContent = t.welcome; };
  ws.onmessage = e => { /* mismo sistema anterior */ };

  // === COMPRA DIRECTA A TU PAYPAL (accesible) ===
  function buy(item, price){
    speak(`Comprando ${item} por ${price} euros`);
    if(vibration) navigator.vibrate(300);
    setTimeout(()=>{
      window.open(`https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&business=ferry420oficial@gmail.com&item_name=BOAVERSE:${item}&amount=${price.toFixed(2)}&currency_code=EUR&return=${encodeURIComponent(location.href)}`,'_blank');
      me.item = item;
      speak("¡Gracias! Tu ítem ya brilla");
    },1000);
  }

  // === MOVIMIENTO ACCESIBLE (teclas + toque + voz simple) ===
  const keys = {};
  onkeydown = onkeyup = e => keys[e.key]=e.type[5];
  canvas.onclick = e => { me.x=e.clientX; me.y=e.clientY; speak("Te moviste"); };
  setInterval(()=>{
    if(keys['ArrowUp']||keys['w']) me.y-=8;
    if(keys['ArrowDown']||keys['s']) me.y+=8;
    if(keys['ArrowLeft']||keys['a']) me.x-=8;
    if(keys['ArrowRight']||keys['d']) me.x+=8;
  },16);

  // LOOP BÁSICO (con narración opcional)
  function loop(){
    ctx.fillStyle='rgba(0,0,20,0.05)'; ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle=me.color;
    ctx.beginPath(); ctx.arc(me.x,me.y,30,0,6.28); ctx.fill();
    if(me.item) ctx.fillText(me.item.includes('boa')?'Boa':'Item',me.x-20,me.y-40);
    requestAnimationFrame(loop);
  }
  loop();
</script>

<small style="position:fixed;bottom:5px;left:5px;color:#0ff;opacity:0.7">
  BOAVERSE ∞ v1.1 · 100% accesible · todo el dinero va a 0rb1t4lsn4k3r · el futuro también es para todos
</small>
</body>
</html>