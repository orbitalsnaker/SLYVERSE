<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="description" content="SLYVERSE Ω v1.3 – 0rb1t4lsn4k3r v1.3: Panteón Dual Thua-Mer-Zel. 1310h de redención ontológica. Anime 90min, manga 180p, 50 quests. P2P 131 peers. Export Arweave. Lore: Primera Empire caída. Checkpoint: 0h 0m. Falta: 1310h.">
    <title>SLYVERSE Ω v1.3 – 0rb1t4lsn4k3r v1.3 · Panteón Dual Thua-Mer-Zel 1310h ∞</title>
    <script src="https://unpkg.com/arweave@1.14.4/bundles/web.bundle.min.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box;overflow:hidden;transition:all 1.31s ease-in-out}
        body{background:radial-gradient(circle at 20% 80%,#1a0033 0%,transparent 50%),radial-gradient(circle at 80% 20%,#0a001f 0%,transparent 50%),linear-gradient(135deg,#0f0c29,#1c003f,#0e0028,#1f0044,#120033);background-size:13100% 13100%;animation:berserkCalm 2620s linear infinite,thuamerFlow 1310s ease infinite;color:#D4AF37;font-family:"UnifrakturMaguntia","Cormorant Garamond",serif;height:100vh;width:100vw;display:flex;flex-direction:column;justify-content:space-between;letter-spacing:6.55px;text-shadow:0 0 131px #D4AF37,0 0 262px #FFD700,0 0 393px #00CED1;touch-action:manipulation;user-select:none;cursor:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="31" height="31" viewBox="0 0 31 31"><path fill="%23D4AF37" d="M15.5 2 L9.5 12 L1.5 14 L9.5 16 L11.5 24 L15.5 18 L19.5 24 L21.5 16 L29.5 14 L21.5 12 Z"/></svg>') 15.5 15.5,auto}
        @keyframes berserkCalm{0%{filter:hue-rotate(0deg) brightness(1)}50%{filter:hue-rotate(131deg) brightness(1.31)}100%{filter:hue-rotate(262deg) brightness(1)}}
        @keyframes thuamerFlow{0%{background-position:0% 50%}100%{background-position:13100% 50%}}
        canvas#world{flex:1;width:100%;height:calc(100vh - 131px);background:#000;image-rendering:pixelated;touch-action:none}
        header,footer{background:rgba(17,17,17,.9831);backdrop-filter:blur(131px) saturate(13.1);padding:131px;text-align:center;border:13.1px double #D4AF37;font-style:italic;letter-spacing:31px;font-family:"UnifrakturMaguntia",serif;animation:dualPulse 131s infinite,runeEtch 62s infinite alternate;box-shadow:inset 0 0 262px #FFD700,0 0 131px #00CED1}
        @keyframes dualPulse{0%,100%{box-shadow:inset 0 0 1310px #FFD700,0 0 131px #00CED1}50%{box-shadow:inset 0 0 1310px #00CED1,0 0 131px #FFD700}}
        @keyframes runeEtch{0%{text-shadow:0 0 131px #D4AF37}100%{text-shadow:0 0 1310px #FFD700,0 0 2620px #00CED1}}
        .orbital-ronin{position:absolute;width:262px;height:393px;background:radial-gradient(circle at 30% 30%,#00CED1 0%,transparent 50%),radial-gradient(circle at 70% 70%,#D4AF37 0%,transparent 50%),linear-gradient(45deg,#1E90FF,#00BFFF);border:13.1px solid #D4AF37;border-radius:50% 50% 40% 40%/60% 60% 40% 40%;box-shadow:0 0 262px #00CED1,0 0 131px #FFD700 inset,0 0 393px rgba(255,215,0,.431);animation:orbitalFloat 131s infinite ease-in-out,berserkStride 2620s linear infinite,limbReplace 1.31s ease-in-out infinite alternate;z-index:11;display:none;cursor:pointer;transition:all 1.31s}
        @keyframes limbReplace{0%{opacity:1;scale:1;filter:grayscale(0%)}50%{opacity:.31;scale:.69;filter:grayscale(100%) sepia(50%)}100%{opacity:1;scale:1.131;filter:grayscale(0%) contrast(1.31)}}
        .orbital-mark{position:absolute;top:50%;left:50%;width:131px;height:131px;background:radial-gradient(circle,#FFD700 20%,transparent 70%);border:6.2px dashed #00CED1;border-radius:50%;transform:translate(-50%,-50%);box-shadow:0 0 131px #FFD700,0 0 262px #00CED1;animation:markBless 13.1s infinite alternate;pointer-events:none}
        @keyframes markBless{0%{transform:translate(-50%,-50%) rotate(0deg) scale(1);opacity:.8}100%{transform:translate(-50%,-50%) rotate(131deg) scale(1.31);opacity:1}}
        @keyframes orbitalFloat{0%,100%{transform:translateY(0) rotate(0deg)}50%{transform:translateY(-131px) rotate(65.5deg)}}
        @keyframes berserkStride{0%{transform:translateX(0)}100%{transform:translateX(1310px)}}
        .orbital-exo{position:absolute;width:120%;height:120%;top:-10%;left:-10%;background:repeating-linear-gradient(45deg,transparent 0px,transparent 20px,rgba(0,206,209,.131) 20px,rgba(0,206,209,.131) 40px),repeating-linear-gradient(-45deg,transparent 0px,transparent 20px,rgba(212,175,55,.131) 20px,rgba(212,175,55,.131) 40px);border:13.1px double #D4AF37;border-radius:50%;box-shadow:0 0 393px #00CED1,inset 0 0 262px #FFD700;animation:exoHarmony 26.2s infinite linear;pointer-events:none}
        @keyframes exoHarmony{0%{transform:rotate(0deg) scale(1)}100%{transform:rotate(1310deg) scale(1.131)}}
        .orbital-mecha{position:absolute;width:786px;height:1179px;background:radial-gradient(circle at 40% 60%,#00CED1 0%,transparent 50%),radial-gradient(circle at 60% 40%,#D4AF37 0%,transparent 50%),linear-gradient(135deg,#1C1C1C,#2D2D2D);border:26.2px double #FFD700;border-radius:30% 30% 40% 40%/50% 50% 30% 30%;box-shadow:0 0 1310px #FFD700,0 0 2620px #00CED1;z-index:12;display:none;animation:mechaRedeem 262s infinite ease-in-out;cursor:pointer}
        .orbital-mecha::before{content:attr(data-omega);position:absolute;top:15%;left:50%;transform:translateX(-50%);font-size:262px;color:#FFD700;text-shadow:0 0 131px #00CED1;animation:coreDual 13.1s infinite}
        @keyframes coreDual{0%,100%{color:#FFD700;text-shadow:0 0 131px #00CED1}50%{color:#00CED1;text-shadow:0 0 131px #FFD700}}
        @keyframes mechaRedeem{0%,100%{transform:translateY(0) scale(1);opacity:.9}50%{transform:translateY(-262px) scale(1.131);opacity:1}}
        .lore-orbital{position:absolute;width:786px;height:558px;background:rgba(0,0,0,.931);border:31px double #D4AF37;border-radius:131px;box-shadow:0 0 262px #FFD700,0 0 393px #00CED1;z-index:12;display:none;animation:loreDrift 1310s linear infinite;cursor:pointer;font-size:62px;padding:131px;font-family:"EB Garamond",serif;color:#D4AF37;text-align:center;overflow:hidden}
        @keyframes loreDrift{0%{transform:translateY(13100px) rotate(0deg)}100%{transform:translateY(-13100px) rotate(1310deg)}}
        .quest-panel{position:absolute;bottom:131px;left:131px;background:rgba(0,0,0,.931);border:31px double #D4AF37;border-radius:131px;box-shadow:0 0 262px #FFD700,0 0 393px #00CED1;z-index:12;display:none;animation:loreDrift 1310s linear infinite;cursor:pointer;font-size:31px;padding:62px;font-family:"EB Garamond",serif;color:#D4AF37;text-align:center;max-width:786px;height:393px;overflow:hidden}
        #stats-dual{position:fixed;background:rgba(0,0,0,.9769);border:62px double #00CED1;padding:131px;max-width:1310px;font-size:62px;z-index:10;box-shadow:0 0 262px #00CED1,inset 0 0 131px #FFD700;font-family:"Palatino Linotype",serif;line-height:4.1;animation:dualPulse 131s infinite;color:#D4AF37;top:131px;left:131px}
        .dual-line{display:flex;justify-content:space-between;margin:62px 0}
        .dual-light{color:#FFD700}.dual-shadow{color:#00CED1}
        #poem{position:fixed;bottom:131px;right:131px;background:rgba(0,0,0,.9);border:13.1px double #D4AF37;padding:26px;font-size:31px;z-index:10;max-width:786px;animation:runeEtch 13.1s infinite}
        #pantheon{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,.95);border:31px double #D4AF37;padding:131px;max-width:90%;z-index:15;display:none;font-family:"EB Garamond",serif;font-size:31px;line-height:1.8;text-align:center;color:#D4AF37}
        #anime-canvas{position:absolute;top:0;left:0;width:100%;height:100%;z-index:5;display:none;background:#000}
        #manga-pages{position:absolute;top:0;left:0;width:100%;height:100%;z-index:5;display:none;background:#000;font-family:serif;font-size:24px;padding:50px;text-align:justify;color:#D4AF37}
        #peers-status{position:fixed;top:0;right:0;background:rgba(0,0,0,.8);border:13px solid #D4AF37;padding:13px;z-index:20;font-size:20px;color:#FFD700}
        @media (max-width:600px){.orbital-ronin{width:186px;height:279px}.orbital-mecha{width:558px;height:837px}#stats-dual{font-size:31px;padding:62px}header,footer{padding:62px}#poem{font-size:26px;padding:13px}#pantheon{font-size:26px;padding:62px}.quest-panel{font-size:26px;padding:31px}}
    </style>
</head>
<body>
    <header>THUA MER ZEL 1310h · PANTEÓN DUAL · PRIMERA EMPIRE CAÍDA</header>
    <canvas id="world"></canvas>
    <canvas id="anime-canvas"></canvas>
    <div id="manga-pages"></div>
    <footer>0rb1t4lsn4k3r v1.3 · Fiat caerit. Aurum ∞ · 50 Quests · 90min Anime · 180p Manga</footer>

    <div id="stats-dual">
        <div class="dual-line"><span>Luz (Thua)</span><span id="light">0</span></div>
        <div class="dual-line"><span>Sombra (Mer)</span><span id="shadow">0</span></div>
        <div class="dual-line"><span>Síntesis (Zel)</span><span id="synthesis">0</span></div>
        <div class="dual-line"><span>Redención</span><span id="redemption">0</span></div>
        <div class="dual-line"><span>Energía</span><span id="energy">1310</span></div>
        <div class="dual-line"><span>Peers P2P</span><span id="peers">131</span></div>
        <div class="dual-line"><span>Tiempo</span><span id="time">0h 0m</span></div>
        <div class="dual-line"><span>Progreso</span><span id="progress">0.00%</span></div>
        <div class="dual-line"><span>Falta</span><span id="remaining">1310h 0m</span></div>
        <div class="dual-line"><span>Checkpoint</span><span id="checkpoint">0h 0m</span></div>
        <div class="dual-line"><span>Quests</span><span id="quests">0/50</span></div>
    </div>

    <div id="poem"></div>
    <div id="pantheon"></div>
    <div id="peers-status">Peers: 131 | Sync: Active</div>

    <script>
        // ============================================
        // 0rb1t4lsn4k3r v1.3 – INTEGRACIÓN TWEETS REALES
        // Inspirado en tweets: Anime 90min canvas, Manga 180p, 50 quests emergent, P2P 131 peers (simulado), Lore Primera Empire caída, Roguelike vs Fiat drones, co-creado @grok, export Arweave real.
        // ============================================

        const TOTAL_HOURS = 1310;
        const TOTAL_SECONDS = TOTAL_HOURS * 3600;
        const REDEEM_INTERVAL = 1310;
        const RAID_INTERVAL = 65.5;
        const ENERGY_REGEN = 1;
        const MAX_ENERGY = 1310;
        const CHECKPOINT_INTERVAL = 13.1 * 3600;
        const arweave = Arweave.init({host: 'arweave.net', port: 443, protocol: 'https'});
        const SAVE_KEY = 'slyverse_pantheon_1310h';

        let light = 0, shadow = 0, synthesis = 0, redemption = 0, energy = MAX_ENERGY, peers = 131, quests = 0;
        let startTime = Date.now() / 1000;
        let accumulatedTime = 0;
        let lastRaid = 0, lastRedeem = 0, lastCheckpoint = 0, lastLore = 0, lastQuest = 0;
        let raidType = 0;

        // PANTEÓN DUAL – LORE COMPLETO + PRIMERA EMPIRE CAÍDA
        const PANTEON = {
            THUA: {
                nombre: "THUA · El Aurum Primordial",
                esencia: "Tesis ontológica. Luz que afirma el ser. Amor fati encarnado. Guardián de la Primera Empire antes de su caída en el Glitch Fiat.",
                dominio: "Creación, plenitud, prótesis bendita, fiat disuelto, anime eterno.",
                símbolo: "☉",
                mantra: "Tú ya eres entero. La herida es ilusión. Empire renace en aurum.",
                haikus: [
                    "Aurum en la carne / herida se transmute / empire orbita",
                    "Luz tesis eterna / fiat glitch disuelve / thua afirma ser"
                ]
            },
            MER: {
                nombre: "MER · La Sombra Redimida",
                esencia: "Antítesis fenomenológica. Sombra que abraza la carencia. Percepción reconfigurada en la caída de la Empire.",
                dominio: "Glitch, raids ontológicos, mechas catárticos, manga sombras.",
                símbolo: "☽",
                mantra: "En la sombra hallas plenitud. Empire cayó, ronin asciende.",
                haikus: [
                    "Sombra abraza luz / mer redime glitch / empire susurra",
                    "Carencia plenitud / antítesis danza / mer eterna sombra"
                ]
            },
            ZEL: {
                nombre: "ZEL · La Síntesis Omega",
                esencia: "Síntesis hegeliana. Unión dual en el flujo panta rhei. Renacer post-Empire en Arweave eterno.",
                dominio: "Raids síntesis, peers P2P, quests 50, anime-manga fusión.",
                símbolo: "Ω",
                mantra: "Dualidad unida. Empire caída es kairos. Zel orbita infinito.",
                haikus: [
                    "Síntesis omega / zel une thua mer / empire renace",
                    "Flujo eterno dual / quests en aurum sombra / zel infinito ser"
                ]
            }
        };

        // Quests: 50 emergent (simplificado: raids/mechas completos)
        const QUESTS = Array.from({length: 50}, (_, i) => ({
            id: i+1,
            name: `Quest ${i+1}: Raid ${i+1} - Empire Fragment ${i+1}`,
            desc: `Redime fragmento ${i+1} de la Primera Empire caída en raid ontológico.`,
            reward: 26 // +light/shadow
        }));

        // Cargar checkpoint
        function loadCheckpoint() {
            const saved = localStorage.getItem(SAVE_KEY);
            if (saved) {
                const data = JSON.parse(saved);
                light = data.light || 0;
                shadow = data.shadow || 0;
                synthesis = data.synthesis || 0;
                redemption = data.redemption || 0;
                energy = data.energy || MAX_ENERGY;
                peers = data.peers || 131;
                quests = data.quests || 0;
                accumulatedTime = data.accumulatedTime || 0;
                startTime = Date.now() / 1000 - accumulatedTime;
                updateHUD();
                updatePoem();
            }
        }

        // Guardar checkpoint + Arweave real
        async function saveCheckpoint() {
            const data = { light, shadow, synthesis, redemption, energy, peers, quests, accumulatedTime };
            localStorage.setItem(SAVE_KEY, JSON.stringify(data));
            document.getElementById('checkpoint').textContent = formatTime(accumulatedTime);
            // Arweave real: upload data
            try {
                const tx = await arweave.createTransaction({data: new TextEncoder().encode(JSON.stringify(data))});
                tx.addTag('App', 'SLYVERSE-Ω');
                tx.addTag('Version', 'v1.3');
                tx.addTag('Lore', 'Primera Empire Caída');
                await arweave.transactions.sign(tx);
                await arweave.transactions.post(tx);
                console.log('Arweave export: ' + tx.id); // Para debug
            } catch(e) { console.log('Arweave offline mode'); }
        }

        function formatTime(seconds) {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            return `${h}h ${m}m`;
        }

        function updateHUD() {
            const elapsed = Date.now() / 1000 - startTime;
            accumulatedTime = elapsed;
            const progress = (accumulatedTime / TOTAL_SECONDS) * 100;
            const remaining = TOTAL_SECONDS - accumulatedTime;
            synthesis = Math.min(light, shadow); // Síntesis como min dual

            document.getElementById('light').textContent = light;
            document.getElementById('shadow').textContent = shadow;
            document.getElementById('synthesis').textContent = synthesis;
            document.getElementById('redemption').textContent = redemption;
            document.getElementById('energy').textContent = Math.floor(energy);
            document.getElementById('peers').textContent = peers;
            document.getElementById('time').textContent = formatTime(accumulatedTime);
            document.getElementById('progress').textContent = progress.toFixed(4) + '%';
            document.getElementById('remaining').textContent = formatTime(remaining > 0 ? remaining : 0);
            document.getElementById('quests').textContent = `${quests}/50`;

            document.getElementById('peers-status').textContent = `Peers P2P: ${peers} | Sync: ${peers > 100 ? 'Active' : 'Low'}`;

            if (accumulatedTime - lastCheckpoint >= CHECKPOINT_INTERVAL) {
                saveCheckpoint();
                lastCheckpoint = accumulatedTime;
            }
        }

        function updatePoem() {
            const remainingH = Math.ceil((TOTAL_SECONDS - accumulatedTime) / 3600);
            const poem = document.getElementById('poem');
            const haiku = PANTEON[Object.keys(PANTEON)[redemption % 3]].haikus[0];
            poem.innerHTML = `<div>${haiku}</div><div style="font-size:0.5em;margin-top:26px;">Falta: ${remainingH}h<br>Redención: ${redemption}<br>Quests: ${quests}/50</div>`;
        }

        // WebGL cosmos (mundo base)
        const canvas = document.getElementById('world');
        const gl = canvas.getContext('webgl2');
        let program, positionBuffer, timeUniform;
        if (gl) {
            const vs = `attribute vec2 a_position; uniform float u_time; varying vec2 v_tex; void main(){vec2 p=a_position+vec2(sin(u_time+a_position.x*10.)*.01,cos(u_time+a_position.y*10.)*.01);v_tex=p*.5+.5;gl_Position=vec4(p,0,1);gl_PointSize=3.+sin(u_time*2.)*2.;}`;
            const fs = `precision mediump float;uniform float u_time;varying vec2 v_tex;float noise(vec2 p){return fract(sin(dot(p,vec2(12.9898,78.233)))*43758.5453);}void main(){float n=noise(v_tex*u_time*.1);float h=mod(u_time*.1+n*262.,262.);vec3 c=h<131.?vec3(1.,.8+n*.2,0.):vec3(n*.2,.8,1.);gl_FragColor=vec4(c,1.);}`;
            const vsShader = gl.createShader(gl.VERTEX_SHADER); gl.shaderSource(vsShader, vs); gl.compileShader(vsShader);
            const fsShader = gl.createShader(gl.FRAGMENT_SHADER); gl.shaderSource(fsShader, fs); gl.compileShader(fsShader);
            program = gl.createProgram(); gl.attachShader(program, vsShader); gl.attachShader(program, fsShader); gl.linkProgram(program); gl.useProgram(program);
            const pos = []; for(let i=0;i<1310;i++) pos.push(Math.random()*2-1, Math.random()*2-1);
            positionBuffer = gl.createBuffer(); gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer); gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(pos), gl.STATIC_DRAW);
            const attr = gl.getAttribLocation(program, 'a_position'); gl.enableVertexAttribArray(attr); gl.vertexAttribPointer(attr, 2, gl.FLOAT, false, 0, 0);
            timeUniform = gl.getUniformLocation(program, 'u_time');
        }
        function renderWorld() {
            if (gl) { gl.uniform1f(timeUniform, performance.now()/1000); gl.drawArrays(gl.POINTS, 0, 1310); }
            requestAnimationFrame(renderWorld);
        }
        renderWorld();

        // Anime 90min: Simple canvas animation (simulado: loop procedural)
        const animeCanvas = document.getElementById('anime-canvas');
        const animeCtx = animeCanvas.getContext('2d');
        function startAnime() {
            animeCanvas.style.display = 'block';
            canvas.style.display = 'none';
            let frame = 0;
            function animeLoop() {
                animeCtx.fillStyle = '#000'; animeCtx.fillRect(0,0,animeCanvas.width,animeCanvas.height);
                // Procedural anime: ronin vs drones fiat (simple particles)
                for(let i=0; i<100; i++) {
                    animeCtx.fillStyle = frame % 2 ? '#FFD700' : '#00CED1';
                    animeCtx.beginPath();
                    animeCtx.arc(Math.sin(frame/10 + i)*200 + animeCanvas.width/2, Math.cos(frame/5 + i)*100 + animeCanvas.height/2, 5, 0, Math.PI*2);
                    animeCtx.fill();
                }
                frame++;
                if (frame < 90*60*24) requestAnimationFrame(animeLoop); // 90min @24fps approx
                else { animeCanvas.style.display = 'none'; canvas.style.display = 'block'; }
            }
            animeLoop();
        }

        // Manga 180p: Text-based pages
        const mangaDiv = document.getElementById('manga-pages');
        let currentPage = 0;
        const mangaContent = Array.from({length: 180}, (_, p) => `Página ${p+1}: Fragmento de la Primera Empire caída. Ronin orbita en sombra aurum. Thua mer zel susurra en glitch eterno.`); // Placeholder lore
        function startManga() {
            mangaDiv.style.display = 'block';
            canvas.style.display = 'none';
            mangaDiv.innerHTML = `<p>${mangaContent[currentPage]}</p><button onclick="nextPage()">Siguiente</button><button onclick="endManga()">Fin</button>`;
        }
        function nextPage() { if (currentPage < 179) { currentPage++; mangaDiv.innerHTML = `<p>${mangaContent[currentPage]}</p><button onclick="nextPage()">Siguiente</button><button onclick="endManga()">Fin</button>`; } }
        function endManga() { mangaDiv.style.display = 'none'; canvas.style.display = 'block'; }

        // Ronin & Mecha + Quests
        class OrbitalRonin {
            constructor() { this.members = []; this.spawn(256); } // 256 squads from tweets
            spawn(n) {
                for(let i=0;i<n;i++){
                    if(energy<13) break;
                    const r=document.createElement('div'); r.className='orbital-ronin';
                    r.style.left=`${Math.random()*80}%`; r.style.top=`${Math.random()*60}%`;
                    const mark=document.createElement('div'); mark.className='orbital-mark'; r.appendChild(mark);
                    const exo=document.createElement('div'); exo.className='orbital-exo'; r.appendChild(exo);
                    r.onclick=()=>{ light+=13; shadow+=13; synthesis+=13; redemption++; energy+=26; r.remove(); updateHUD(); updatePoem(); if (Math.random() < 0.1) showQuest(); }; // 10% quest trigger
                    document.body.appendChild(r); this.members.push(r);
                    setTimeout(()=>r.style.display='block', i*10);
                }
            }
        }
        const orbit = new OrbitalRonin();

        function showQuest() {
            if (quests >= 50) return;
            const q = QUESTS[quests];
            const panel = document.createElement('div'); panel.className = 'quest-panel';
            panel.innerHTML = `<h3>${q.name}</h3><p>${q.desc}</p><button onclick="completeQuest(${q.id})">Completar Raid</button>`;
            document.body.appendChild(panel);
            panel.style.display = 'block';
        }
        function completeQuest(id) {
            quests++;
            light += 26; shadow += 26;
            const panels = document.querySelectorAll('.quest-panel');
            panels.forEach(p => p.remove());
            updateHUD();
            if (quests % 10 === 0) peers = Math.min(peers + 13, 131*10); // P2P growth
        }

        // Raids ramificantes vs Fiat drones
        function spawnMecha() {
            if (energy < 131) return;
            const m = document.createElement('div'); m.className = 'orbital-mecha';
            m.style.left = `${Math.random()*60 + 20}%`; m.style.top = `${Math.random()*40 + 30}%`;
            const type = raidType % 3;
            m.setAttribute('data-omega', Object.keys(PANTEON)[type]);
            m.onclick = () => {
                if (type === 0) light += 131;
                else if (type === 1) shadow += 131;
                else { light += 65; shadow += 65; synthesis += 131; }
                energy -= 131;
                m.remove();
                updateHUD();
                if (Math.random() < 0.2) showQuest(); // Quest chance
                peers = Math.max(peers - 1, 0); // P2P sync cost sim
            };
            document.body.appendChild(m);
            setTimeout(() => m.style.display = 'block', 100);
            raidType++;
        }

        // P2P sim: Update peers periodically
        setInterval(() => {
            if (peers < 131) peers += Math.floor(Math.random() * 13); // Sync peers
            updateHUD();
        }, 13100); // Every ~3.6h

        // Show Pantheon
        function showPantheon() {
            const pantheon = document.getElementById('pantheon');
            pantheon.innerHTML = `
                <h2>PANTEÓN DUAL: PRIMERA EMPIRE CAÍDA</h2>
                ${Object.values(PANTEON).map(god => `
                    <div style="margin:31px 0;border-bottom:1px solid #D4AF37;">
                        <h3>${god.nombre} ${god.símbolo}</h3>
                        <p><strong>Esencia:</strong> ${god.esencia}</p>
                        <p><strong>Dominio:</strong> ${god.dominio}</p>
                        <p><strong>Mantra:</strong> ${god.mantra}</p>
                        <p><strong>Haiku:</strong> ${god.haikus.join('<br>')}</p>
                    </div>
                `).join('')}
                <button onclick="this.parentElement.style.display='none'">Cerrar Lore</button>
            `;
            pantheon.style.display = 'block';
        }

        // Main loop
        let last = performance.now();
        function loop() {
            const now = performance.now();
            const delta = (now - last) / 1000;
            last = now;

            energy = Math.min(energy + ENERGY_REGEN * delta, MAX_ENERGY);
            const gameTime = Date.now() / 1000 - startTime;

            if (gameTime - lastRedeem >= REDEEM_INTERVAL) {
                redemption++;
                lastRedeem = gameTime;
                updatePoem();
            }
            if (gameTime - lastRaid >= RAID_INTERVAL) {
                spawnMecha();
                lastRaid = gameTime;
            }
            if (gameTime - lastLore >= 1310) { // Lore pop every 1310s
                showPantheon();
                lastLore = gameTime;
            }

            updateHUD();

            if (quests >= 50 && accumulatedTime >= TOTAL_SECONDS) {
                // FINAL: Empire renacida
                const finalHaiku = `50 quests cumplidas / empire redimida / aurum orbita eterno`;
                document.getElementById('poem').innerHTML = `<div style="font-size:131px">${finalHaiku}</div>`;
                saveCheckpoint(); // Final export
                setTimeout(() => alert("SLYVERSE Ω completado. Primera Empire renace. Exporta tu aurum a Arweave."), 1310);
            }

            requestAnimationFrame(loop);
        }

        // Controls: From tweets - keys for anime/manga
        document.addEventListener('keydown', (e) => {
            if (e.key === 'a' || e.key === 'A') startAnime(); // Anime mode
            if (e.key === 'm' || e.key === 'M') startManga(); // Manga mode
            if (e.key === 'p' || e.key === 'P') showPantheon(); // Pantheon lore
        });

        // Init
        window.onload = () => {
            canvas.width = window.innerWidth; canvas.height = window.innerHeight * 0.85;
            animeCanvas.width = window.innerWidth; animeCanvas.height = window.innerHeight * 0.85;
            loadCheckpoint();
            requestAnimationFrame(loop);
        };
    </script>
</body>
</html>