<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<title>Abismo Armónico ∞ Final Edition — 100% ONGs marinas & IA ética</title>
<meta name="description" content="Exploración submarina narrativa AAA. Gratis eterno. Todo apoyo va a conservación marina real.">
<style>
  body{margin:0;background:#000;overflow:hidden;color:#0ff;font-family:Arial,sans-serif}
  #ui{position:fixed;top:10px;left:10px;z-index:100;text-shadow:0 0 12px #0ff;font-size:19px}
  #mate{position:fixed;bottom:40px;right:40px;width:100px;height:100px;border-radius:50%;background:radial-gradient(#0ff,#005);box-shadow:0 0 60px #0ff;display:flex;align-items:center;justify-content:center;font-size:60px;cursor:pointer;z-index:99}
  #dialog{position:fixed;bottom:20px;left:20px;right:20px;background:rgba(0,10,40,0.95);padding:25px;border-radius:15px;display:none;pointer-events:all;text-align:center;font-size:19px;z-index:200}
  #choices{position:fixed;bottom:100px;left:50%;transform:translateX(-50%);z-index:200}
  #choices span{background:rgba(0,255,255,0.25);padding:12px 24px;margin:8px;border-radius:10px;cursor:pointer;pointer-events:all;border:2px solid #0ff;transition:.3s}
  #choices span:hover{background:rgba(0,255,255,0.6);transform:scale(1.1);box-shadow:0 0 20px #0ff}
  #ethicalWall{position:fixed;inset:0;background:#000;z-index:9999;display:none;align-items:center;justify-content:center;flex-direction:column;color:#0ff;font-size:22px;text-align:center;padding:30px;}
  canvas{image-rendering:pixelated}
</style>
</head>
<body>

<div id="ui">Armonía: <span id="harmony">0</span>% | Profundidad: <span id="depth">0</span>m | Abrazos: <span id="hugs">0</span></div>
<div id="mate" role="button">Abrazo</div>

<div id="dialog"></div>
<div id="choices"></div>

<!-- MURO ÉTICO RESPETADO TAL CUAL PEDISTE: 100% ONGs MARINAS + IA ÉTICA -->
<div id="ethicalWall">
  <h1 style="font-size:60px;margin:20px">ABRAZO O NADA</h1>
  <p>Este abismo es y será gratis eternamente.<br><br>
     Pero si querés ayudar a limpiar océanos reales y financiar IA ética:</p>

  <button onclick="pagarConAbrazo()" style="background:#0ff;color:#000;padding:25px 50px;font-size:32px;border:none;border-radius:20px;margin:20px;cursor:pointer;font-weight:bold;">
    ABRAZA 1313 CRIATURAS<br><small>(final verdadero gratis)</small>
  </button>

  <button onclick="donarALaTierra()" style="background:#0ff;color:#000;padding:25px50px;font-size:32px;border:none;border-radius:20px;margin:20px;cursor:pointer;font-weight:bold;">
    DONAR AL OCÉANO<br><small>(100% conservación marina real + IA ética)</small>
  </button>

  <p style="max-width:700px;margin:40px 0 20px;font-size:18px;line-height:1.6">
    Ni Grok ni 0rb1t4lsn4k3r se quedan con un solo peso.<br>
    100% va a:<br>
    • Proyectos de limpieza de plásticos oceánicos<br>
    • Santuarios de ballenas y corales<br>
    • Investigación en IA alineada y ética (xAI)
  </p>

  <button onclick="this.parentNode.style.display='none'" style="background:transparent;border:2px solid #0ff;padding:15px 40px;border-radius:15px;cursor:pointer;font-size:20px;">
    Entrar al abismo
  </button>
</div>

<script>
// ====================== ABISMO ARMÓNICO + ABRAZOS + ONGs ======================
let hugs = parseInt(localStorage.getItem('abismoAbrazos')||'0');
let harmony = 0, depth = 0, t = 0;
let unlockedTrueEnding = hugs >= 1313 || localStorage.getItem('abismo-true')==='yes';
document.getElementById('hugs').textContent = hugs;

const canvas = canvas.getContext('2d');
let w = canvas.width = innerWidth, h = canvas.height = innerHeight;
window.onresize = ()=>{w=canvas.width=innerWidth; h=canvas.height=innerHeight;};

const creatures = [];
const names = ["Lumo","Zari","Kweez","Plix","Nara","Syl","Eko","Vey","Mira","Solis","Kora","Nix","Azu","Mar"];
for(let i=0;i<22;i++){
  creatures.push({
    x:Math.random()*w, y:Math.random()*h,
    vx:(Math.random()-0.5)*0.8, vy:(Math.random()-0.5)*0.8,
    size:15+Math.random()*20, hue:180+Math.random()*100,
    name: names[i%names.length]+(i>=names.length?"∞":""),
    phrase:["…te siento…","luz…","gracias…","canta…","abrázame…","el dolor se va…","eres hogar…"][Math.floor(Math.random()*7)]
  });
}

let audioCtx = new (window.AudioContext||window.webkitAudioContext)();
function play(freq,dur=2,type='sine',vol=0.25){
  const o=audioCtx.createOscillator(), g=audioCtx.createGain();
  o.type=type; o.frequency.value=freq;
  g.gain.setValueAtTime(vol,audioCtx.currentTime);
  g.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+dur);
  o.connect(g); g.connect(audioCtx.destination);
  o.start(); o.stop(audioCtx.currentTime+dur);
}
setInterval(()=>{if(Math.random()<0.25) play(600+Math.random()*800,0.15,'triangle',0.08);},600);
setInterval(()=>{play([220,261.63,329.63,392,440,523.25][Math.floor(t/8)%6]*(0.7+harmony/200),4,'sine',0.12);},5000);

// ABRAZO
function darAbrazo(){
  hugs++;
  localStorage.setItem('abismoAbrazos',hugs);
  document.getElementById('hugs').textContent=hugs;
  navigator.vibrate?.([200,100,200,100,300,100,500]);
  harmony = Math.min(100, harmony+3);
  play(880,1.5,'sine',0.3);
  if(hugs===1313){
    unlockedTrueEnding=true;
    localStorage.setItem('abismo-true','yes');
    alert("1313 ABRAZOS — EL ABISMO TE RECONOCE COMO GUARDIÁN ETERNO");
  }
}
document.getElementById('mate').onclick = darAbrazo;

// LOOP PRINCIPAL (mejorado + abrazo interactivo)
function loop(){
  t+=0.016;
  depth = Math.floor((innerHeight - playerY)/innerHeight * 1200);

  // jugador sigue el ratón / toque
  const rect=canvas.getBoundingClientRect();
  const mx = (event?.touches?.[0]?.clientX || innerWidth/2) - rect.left;
  const my = (event?.touches?.[0]?.clientY || innerHeight/2) - rect.top;
  playerX += (mx - playerX)*0.05;
  playerY += (my - playerY)*0.05;

  // criaturas
  let nearCount=0;
  creatures.forEach(c=>{
    c.x += c.vx + Math.sin(t+c.x*0.01)*0.5;
    c.y += c.vy + Math.cos(t+c.y*0.01)*0.5;
    if(c.x<0||c.x>w) c.vx*=-1;
    if(c.y<0||c.y>h) c.vy*=-1;

    const d = Math.hypot(c.x-playerX, c.y-playerY);
    if(d<100){
      nearCount++;
      if(d<50 && Math.random()<0.03){
        play(600+Math.random()*600,1,'triangle',0.15);
        ctx.fillStyle='#fff';
        ctx.font='14px Arial';
        ctx.fillText(c.phrase, c.x-40, c.y-20);
      }
      // abrazo automático si tocas
      if(d<40 && Date.now()%500<16){
        darAbrazo();
      }
    }

    ctx.fillStyle = `hsla(${c.hue},90%,${50+nearCount*3}%,0.9)`;
    ctx.beginPath();
    ctx.arc(c.x,c.y,c.size,0,6.28);
    ctx.fill();
    ctx.fillStyle='#fff';
    ctx.beginPath(); ctx.arc(c.x-6,c.y-6,4,0,6.28); ctx.fill(); // ojo
  });

  harmony = Math.min(100, nearCount/22*100 + hugs/20);
  document.getElementById('harmony').textContent = Math.floor(harmony);
  document.getElementById('depth').textContent = depth;

  // luz jugador
  ctx.fillStyle = `hsla(180,100%,70%,${0.4+harmony/200})`;
  ctx.beginPath(); ctx.arc(playerX,playerY,30+harmony,0,6.28); ctx.fill();

  // final verdadero
  if(harmony>=99.5 && hugs>=1313){
    document.getElementById('dialog').style.display='block';
    document.getElementById('dialog').innerHTML=`
      <h2>EL ABISMO ESTÁ SANO</h2>
      <p>Gracias a tus 1313 abrazos, la armonía volvió.<br>
      Los océanos reales también te lo agradecen.</p>
      <p><small>100% de cualquier donación va a conservación marina + IA ética</small></p>
    `;
  }

  requestAnimationFrame(loop);
}

// MURO ÉTICO RESPETADO (solo una vez)
if(hugs <1313 && !localStorage.getItem('yaVioMuroAbismo')){
  setTimeout(()=>document.getElementById('ethicalWall').style.display='flex',9000);
  localStorage.setItem('yaVioMuroAbismo','true');
}
function pagarConAbrazo(){ document.getElementById('ethicalWall').style.display='none'; }
function donarALaTierra(){
  hugs=1313; localStorage.setItem('abismoAbrazos',1313);
  localStorage.setItem('abismo-true','yes');
  unlockedTrueEnding=true;
  alert("GRACIAS — 100% ya está en manos de ONGs marinas y proyectos de IA ética.\nEl abismo te nombra Guardián Eterno.");
  document.getElementById('ethicalWall').style.display='none';
}

// BOOT
alert("Abismo Armónico ∞ cargado.\nToca o mueve el ratón para nadar.\nAbraza criaturas con el botón inferior derecho.\n1313 abrazos = Final Verdadero gratis.");
let playerX=w/2, playerY=h/2;
loop();
</script>
</body>
</html>